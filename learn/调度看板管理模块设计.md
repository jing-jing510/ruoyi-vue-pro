# 调度看板管理模块设计

## 1. 模块概述

调度看板管理模块是选煤厂生产管理系统的核心展示模块，通过各类管理看板展示生产数据、实时报警事件以及工作任务等信息，使管理状况一目了然。该模块结合选煤厂的实际生产情况和管理流程，利用虚拟化的"看板"技术，对生产数据、实时报警事件以及工作任务等任务和信息进行组织和整合，并直观的展现给企业相关人员。

## 2. 功能需求分析

根据合同功能模块要求，调度看板管理模块应包含：

### 2.1 生产看板
- 实时生产数据展示
- 产量完成情况
- 设备运行状态
- 生产计划执行情况
- 质量指标监控

### 2.2 任务看板
- 生产任务分配
- 任务执行进度
- 任务完成情况
- 任务优先级管理
- 任务状态跟踪

### 2.3 报警看板
- 实时报警信息
- 报警级别分类
- 报警处理状态
- 报警历史记录
- 报警统计分析

## 3. 数据库设计

### 3.1 看板配置表 (coal_dashboard_config) - 单表
```sql
DROP TABLE IF EXISTS `coal_dashboard_config`;
CREATE TABLE `coal_dashboard_config` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '看板配置ID',
    `dashboard_name` VARCHAR(100) NOT NULL COMMENT '看板名称',
    `dashboard_type` TINYINT NOT NULL COMMENT '看板类型：1生产看板 2任务看板 3报警看板',
    `dashboard_code` VARCHAR(50) NOT NULL COMMENT '看板编码',
    `dashboard_title` VARCHAR(200) NOT NULL COMMENT '看板标题',
    `dashboard_description` TEXT COMMENT '看板描述',
    `layout_config` JSON COMMENT '布局配置（JSON格式）',
    `widget_config` JSON COMMENT '组件配置（JSON格式）',
    `refresh_interval` INT NOT NULL DEFAULT 30 COMMENT '刷新间隔（秒）',
    `auto_refresh` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否自动刷新：1是 0否',
    `is_public` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否公开：1是 0否',
    `sort_order` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_dashboard_code` (`dashboard_code`, `deleted`) USING BTREE,
    INDEX `idx_dashboard_type` (`dashboard_type`) USING BTREE,
    INDEX `idx_status` (`status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '看板配置表';
```

### 3.2 看板组件表 (coal_dashboard_widget) - 单表
```sql
DROP TABLE IF EXISTS `coal_dashboard_widget`;
CREATE TABLE `coal_dashboard_widget` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '组件ID',
    `widget_name` VARCHAR(100) NOT NULL COMMENT '组件名称',
    `widget_type` TINYINT NOT NULL COMMENT '组件类型：1图表 2表格 3指标 4文本 5图片',
    `widget_code` VARCHAR(50) NOT NULL COMMENT '组件编码',
    `widget_title` VARCHAR(200) NOT NULL COMMENT '组件标题',
    `widget_description` TEXT COMMENT '组件描述',
    `data_source_type` TINYINT NOT NULL COMMENT '数据源类型：1API接口 2SQL查询 3静态数据',
    `data_source_config` JSON COMMENT '数据源配置（JSON格式）',
    `display_config` JSON COMMENT '显示配置（JSON格式）',
    `chart_config` JSON COMMENT '图表配置（JSON格式）',
    `refresh_interval` INT NOT NULL DEFAULT 60 COMMENT '刷新间隔（秒）',
    `cache_duration` INT NOT NULL DEFAULT 300 COMMENT '缓存时长（秒）',
    `sort_order` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_widget_code` (`widget_code`, `deleted`) USING BTREE,
    INDEX `idx_widget_type` (`widget_type`) USING BTREE,
    INDEX `idx_status` (`status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '看板组件表';
```

### 3.3 看板布局表 (coal_dashboard_layout) - 单表
```sql
DROP TABLE IF EXISTS `coal_dashboard_layout`;
CREATE TABLE `coal_dashboard_layout` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '布局ID',
    `dashboard_id` BIGINT NOT NULL COMMENT '看板ID',
    `widget_id` BIGINT NOT NULL COMMENT '组件ID',
    `layout_position` VARCHAR(20) NOT NULL COMMENT '布局位置（如：1,1表示第1行第1列）',
    `layout_size` VARCHAR(20) NOT NULL COMMENT '布局大小（如：2x2表示2行2列）',
    `layout_config` JSON COMMENT '布局配置（JSON格式）',
    `sort_order` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_dashboard` (`dashboard_id`) USING BTREE,
    INDEX `idx_widget` (`widget_id`) USING BTREE,
    INDEX `idx_status` (`status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '看板布局表';
```

### 3.4 看板数据缓存表 (coal_dashboard_cache) - 单表
```sql
DROP TABLE IF EXISTS `coal_dashboard_cache`;
CREATE TABLE `coal_dashboard_cache` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '缓存ID',
    `cache_key` VARCHAR(200) NOT NULL COMMENT '缓存键',
    `cache_data` LONGTEXT COMMENT '缓存数据（JSON格式）',
    `cache_type` TINYINT NOT NULL COMMENT '缓存类型：1看板数据 2组件数据 3统计数据',
    `expire_time` DATETIME NOT NULL COMMENT '过期时间',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_cache_key` (`cache_key`) USING BTREE,
    INDEX `idx_expire_time` (`expire_time`) USING BTREE,
    INDEX `idx_cache_type` (`cache_type`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '看板数据缓存表';
```

### 3.5 看板访问记录表 (coal_dashboard_access_log) - 单表
```sql
DROP TABLE IF EXISTS `coal_dashboard_access_log`;
CREATE TABLE `coal_dashboard_access_log` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '访问记录ID',
    `dashboard_id` BIGINT NOT NULL COMMENT '看板ID',
    `user_id` BIGINT NOT NULL COMMENT '用户ID',
    `access_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '访问时间',
    `access_duration` INT DEFAULT NULL COMMENT '访问时长（秒）',
    `access_ip` VARCHAR(50) DEFAULT NULL COMMENT '访问IP',
    `user_agent` VARCHAR(500) DEFAULT NULL COMMENT '用户代理',
    `access_type` TINYINT NOT NULL DEFAULT 1 COMMENT '访问类型：1查看 2编辑 3导出',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_dashboard` (`dashboard_id`) USING BTREE,
    INDEX `idx_user` (`user_id`) USING BTREE,
    INDEX `idx_access_time` (`access_time`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '看板访问记录表';
```

## 4. 字典配置

### 4.1 看板类型字典
```sql
-- 看板类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('看板类型', 'dashboard_type', 0, '看板类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '生产看板', '1', 'dashboard_type', 0, '1', NOW(), '1', NOW()),
(2, '任务看板', '2', 'dashboard_type', 0, '1', NOW(), '1', NOW()),
(3, '报警看板', '3', 'dashboard_type', 0, '1', NOW(), '1', NOW());
```

### 4.2 组件类型字典
```sql
-- 组件类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('组件类型', 'widget_type', 0, '组件类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '图表', '1', 'widget_type', 0, '1', NOW(), '1', NOW()),
(2, '表格', '2', 'widget_type', 0, '1', NOW(), '1', NOW()),
(3, '指标', '3', 'widget_type', 0, '1', NOW(), '1', NOW()),
(4, '文本', '4', 'widget_type', 0, '1', NOW(), '1', NOW()),
(5, '图片', '5', 'widget_type', 0, '1', NOW(), '1', NOW());
```

### 4.3 数据源类型字典
```sql
-- 数据源类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('数据源类型', 'data_source_type', 0, '数据源类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, 'API接口', '1', 'data_source_type', 0, '1', NOW(), '1', NOW()),
(2, 'SQL查询', '2', 'data_source_type', 0, '1', NOW(), '1', NOW()),
(3, '静态数据', '3', 'data_source_type', 0, '1', NOW(), '1', NOW());
```

## 5. 业务逻辑设计

### 5.1 看板管理流程
1. **看板创建**：管理员创建看板 → 配置看板基本信息 → 选择看板类型 → 设置布局参数
2. **组件配置**：添加组件 → 配置数据源 → 设置显示样式 → 调整组件位置
3. **权限设置**：设置访问权限 → 分配用户角色 → 配置公开范围
4. **发布使用**：测试看板功能 → 发布看板 → 用户访问使用

### 5.2 数据更新流程
1. **数据采集**：定时任务采集数据 → 数据预处理 → 数据验证
2. **缓存更新**：更新缓存数据 → 设置过期时间 → 清理过期缓存
3. **实时推送**：WebSocket推送更新 → 前端自动刷新 → 用户实时查看

### 5.3 访问控制流程
1. **权限验证**：用户登录验证 → 角色权限检查 → 看板访问权限验证
2. **访问记录**：记录访问日志 → 统计访问数据 → 分析用户行为
3. **性能监控**：监控访问性能 → 优化响应速度 → 提升用户体验

## 6. 技术实现要点

### 6.1 前端技术
- **Vue 3 + TypeScript**：现代化前端框架
- **Element Plus**：UI组件库
- **ECharts**：图表展示
- **WebSocket**：实时数据推送
- **Grid Layout**：响应式布局

### 6.2 后端技术
- **Spring Boot**：后端框架
- **MyBatis-Plus**：数据访问层
- **Redis**：数据缓存
- **WebSocket**：实时通信
- **定时任务**：数据更新

### 6.3 数据库设计
- **MySQL 8.0+**：主数据库
- **JSON字段**：存储配置信息
- **索引优化**：提升查询性能
- **缓存策略**：减少数据库压力

## 7. 测试数据

### 7.1 看板配置测试数据
```sql
-- 生产看板
INSERT INTO `coal_dashboard_config` (`dashboard_name`, `dashboard_type`, `dashboard_code`, `dashboard_title`, `dashboard_description`, `refresh_interval`, `auto_refresh`, `is_public`, `sort_order`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
('生产看板', 1, 'PRODUCTION_DASHBOARD', '生产看板', '实时展示生产数据、产量完成情况、设备运行状态等', 30, 1, 1, 1, 1, '1', NOW(), '1', NOW(), 0, 0);

-- 任务看板
INSERT INTO `coal_dashboard_config` (`dashboard_name`, `dashboard_type`, `dashboard_code`, `dashboard_title`, `dashboard_description`, `refresh_interval`, `auto_refresh`, `is_public`, `sort_order`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
('任务看板', 2, 'TASK_DASHBOARD', '任务看板', '展示生产任务分配、执行进度、完成情况等', 60, 1, 1, 2, 1, '1', NOW(), '1', NOW(), 0, 0);

-- 报警看板
INSERT INTO `coal_dashboard_config` (`dashboard_name`, `dashboard_type`, `dashboard_code`, `dashboard_title`, `dashboard_description`, `refresh_interval`, `auto_refresh`, `is_public`, `sort_order`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
('报警看板', 3, 'ALERT_DASHBOARD', '报警看板', '实时展示报警信息、处理状态、统计分析等', 10, 1, 1, 3, 1, '1', NOW(), '1', NOW(), 0, 0);
```

### 7.2 组件配置测试数据
```sql
-- 生产指标组件
INSERT INTO `coal_dashboard_widget` (`widget_name`, `widget_type`, `widget_code`, `widget_title`, `widget_description`, `data_source_type`, `refresh_interval`, `cache_duration`, `sort_order`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
('生产指标', 3, 'PRODUCTION_INDICATORS', '生产指标', '展示当日产量、完成率、设备运行率等关键指标', 1, 30, 300, 1, 1, '1', NOW(), '1', NOW(), 0, 0);

-- 产量趋势图
INSERT INTO `coal_dashboard_widget` (`widget_name`, `widget_type`, `widget_code`, `widget_title`, `widget_description`, `data_source_type`, `refresh_interval`, `cache_duration`, `sort_order`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
('产量趋势图', 1, 'PRODUCTION_TREND_CHART', '产量趋势图', '展示近7天产量变化趋势', 1, 60, 600, 2, 1, '1', NOW(), '1', NOW(), 0, 0);

-- 设备状态表
INSERT INTO `coal_dashboard_widget` (`widget_name`, `widget_type`, `widget_code`, `widget_title`, `widget_description`, `data_source_type`, `refresh_interval`, `cache_duration`, `sort_order`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
('设备状态表', 2, 'EQUIPMENT_STATUS_TABLE', '设备状态表', '展示主要设备运行状态', 1, 30, 300, 3, 1, '1', NOW(), '1', NOW(), 0, 0);
```

## 8. 总结

调度看板管理模块是选煤厂生产管理系统的核心展示模块，通过灵活的看板配置和组件管理，为不同角色的用户提供个性化的数据展示界面。该模块采用现代化的技术架构，支持实时数据更新、响应式布局和权限控制，能够有效提升生产管理的可视化水平和决策效率。
