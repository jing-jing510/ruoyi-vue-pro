# 煤质管理模块设计文档

**设计时间**: 2025年9月10日  
**框架**: 芋道开源框架 (ruoyi-vue-pro)  
**模块**: 煤质管理 (Coal Quality Management)

---

## 📋 模块概述

### 业务需求
根据合同功能模块要求，煤质管理模块包含：
1. **生产过程检测** - 快灰、快水、快浮、班灰数据录入和展示
2. **质量统计** - 按时间、班次、系统、产品多维度质量分析
3. **检化验管理** - 从原材料到产成品的全程质量控制
4. **质量预警** - 基于历史数据的质量问题预警机制

### 技术方案
- **表结构**: 4个核心表 + 1个关联表
- **生成方式**: 芋道代码生成器 (单表CRUD)
- **功能范围**: 先实现基础CRUD，后扩展业务逻辑

---

## 🗄️ 数据库表设计

### 表结构分类说明
- **单表**: `coal_quality_item`、`coal_quality_standard`、`coal_quality_alert`
- **主子表**: `coal_quality_inspection`(主表) + `coal_quality_data`(子表)
- **树表**: 暂无（煤质管理不需要树形结构）

### 1. 质量检测项目表 (coal_quality_item) - 【单表】

```sql
DROP TABLE IF EXISTS `coal_quality_item`;
CREATE TABLE `coal_quality_item` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '检测项目ID',
    `item_code` VARCHAR(50) NOT NULL COMMENT '检测项目编码',
    `item_name` VARCHAR(100) NOT NULL COMMENT '检测项目名称',
    `item_type` TINYINT NOT NULL COMMENT '检测类型：1快灰 2快水 3快浮 4班灰 5其他',
    `unit` VARCHAR(20) NOT NULL COMMENT '计量单位',
    `detection_method` VARCHAR(100) DEFAULT NULL COMMENT '检测方法',
    `equipment_required` VARCHAR(200) DEFAULT NULL COMMENT '所需设备',
    `standard_value` DECIMAL(10,4) DEFAULT NULL COMMENT '标准值',
    `max_value` DECIMAL(10,4) DEFAULT NULL COMMENT '最大允许值',
    `min_value` DECIMAL(10,4) DEFAULT NULL COMMENT '最小允许值',
    `warning_upper_limit` DECIMAL(10,4) DEFAULT NULL COMMENT '预警上限',
    `warning_lower_limit` DECIMAL(10,4) DEFAULT NULL COMMENT '预警下限',
    `precision_digits` TINYINT DEFAULT 2 COMMENT '精度位数',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '显示顺序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_item_code` (`item_code`, `deleted`) USING BTREE,
    INDEX `idx_item_type` (`item_type`) USING BTREE,
    INDEX `idx_status` (`status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '质量检测项目表';
```

### 2. 质量检测记录表 (coal_quality_inspection) - 【主表】

```sql
DROP TABLE IF EXISTS `coal_quality_inspection`;
CREATE TABLE `coal_quality_inspection` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '检测记录ID',
    `inspection_code` VARCHAR(50) NOT NULL COMMENT '检测编号',
    `inspection_date` DATETIME NOT NULL COMMENT '检测时间',
    `shift_id` BIGINT DEFAULT NULL COMMENT '班次ID',
    `inspector_id` BIGINT NOT NULL COMMENT '检测人员ID',
    `inspector_name` VARCHAR(50) NOT NULL COMMENT '检测人员姓名',
    `product_type` TINYINT NOT NULL COMMENT '产品类型：1原煤 2精煤 3中煤 4煤泥 5矸石',
    `product_specification` VARCHAR(100) DEFAULT NULL COMMENT '产品规格（如：末煤、粒煤、大块等）',
    `sampling_location` VARCHAR(100) NOT NULL COMMENT '采样地点',
    `sampling_method` TINYINT NOT NULL COMMENT '采样方法：1人工采样 2自动采样 3混合采样',
    `sample_code` VARCHAR(50) DEFAULT NULL COMMENT '样品编号',
    `detection_type` TINYINT NOT NULL COMMENT '检测类型：1快速检测 2常规检测 3仲裁检测',
    `system_location` VARCHAR(100) DEFAULT NULL COMMENT '系统位置（如：主洗系统、浮选系统）',
    `batch_number` VARCHAR(50) DEFAULT NULL COMMENT '批次号',
    `inspection_status` TINYINT NOT NULL DEFAULT 1 COMMENT '检测状态：1检测中 2已完成 3异常 4作废',
    `reviewer_id` BIGINT DEFAULT NULL COMMENT '审核人员ID',
    `reviewer_name` VARCHAR(50) DEFAULT NULL COMMENT '审核人员姓名',
    `review_time` DATETIME DEFAULT NULL COMMENT '审核时间',
    `review_status` TINYINT NOT NULL DEFAULT 0 COMMENT '审核状态：0待审核 1审核通过 2审核不通过',
    `review_remark` VARCHAR(500) DEFAULT NULL COMMENT '审核备注',
    `temperature` DECIMAL(5,2) DEFAULT NULL COMMENT '环境温度(℃)',
    `humidity` DECIMAL(5,2) DEFAULT NULL COMMENT '环境湿度(%)',
    `weather_condition` VARCHAR(50) DEFAULT NULL COMMENT '天气情况',
    `remark` TEXT COMMENT '备注信息',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_inspection_code` (`inspection_code`, `deleted`) USING BTREE,
    INDEX `idx_inspection_date` (`inspection_date`) USING BTREE,
    INDEX `idx_shift_id` (`shift_id`) USING BTREE,
    INDEX `idx_inspector` (`inspector_id`) USING BTREE,
    INDEX `idx_product_type` (`product_type`) USING BTREE,
    INDEX `idx_detection_type` (`detection_type`) USING BTREE,
    INDEX `idx_inspection_status` (`inspection_status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '质量检测记录表';
```

### 3. 质量检测数据表 (coal_quality_data) - 【子表】

```sql
DROP TABLE IF EXISTS `coal_quality_data`;
CREATE TABLE `coal_quality_data` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '检测数据ID',
    `inspection_id` BIGINT NOT NULL COMMENT '检测记录ID',
    `quality_item_id` BIGINT NOT NULL COMMENT '检测项目ID',
    `quality_item_code` VARCHAR(50) NOT NULL COMMENT '检测项目编码',
    `quality_item_name` VARCHAR(100) NOT NULL COMMENT '检测项目名称',
    `measured_value` DECIMAL(10,4) NOT NULL COMMENT '检测值',
    `unit` VARCHAR(20) NOT NULL COMMENT '计量单位',
    `standard_value` DECIMAL(10,4) DEFAULT NULL COMMENT '标准值',
    `deviation` DECIMAL(10,4) DEFAULT NULL COMMENT '偏差值',
    `deviation_rate` DECIMAL(5,2) DEFAULT NULL COMMENT '偏差率(%)',
    `is_qualified` TINYINT NOT NULL DEFAULT 1 COMMENT '是否合格：0不合格 1合格 2待判定',
    `detection_method` VARCHAR(100) DEFAULT NULL COMMENT '检测方法',
    `detection_equipment` VARCHAR(100) DEFAULT NULL COMMENT '检测设备',
    `detection_time` DATETIME NOT NULL COMMENT '检测时间',
    `operator_id` BIGINT DEFAULT NULL COMMENT '操作员ID',
    `operator_name` VARCHAR(50) DEFAULT NULL COMMENT '操作员姓名',
    `retest_count` TINYINT DEFAULT 0 COMMENT '复检次数',
    `is_retest` TINYINT NOT NULL DEFAULT 0 COMMENT '是否复检：0否 1是',
    `original_value` DECIMAL(10,4) DEFAULT NULL COMMENT '原始检测值（复检时记录）',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_inspection_id` (`inspection_id`) USING BTREE,
    INDEX `idx_quality_item` (`quality_item_id`) USING BTREE,
    INDEX `idx_detection_time` (`detection_time`) USING BTREE,
    INDEX `idx_is_qualified` (`is_qualified`) USING BTREE,
    INDEX `idx_is_retest` (`is_retest`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '质量检测数据表';
```

### 4. 质量标准表 (coal_quality_standard) - 【单表】

```sql
DROP TABLE IF EXISTS `coal_quality_standard`;
CREATE TABLE `coal_quality_standard` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '质量标准ID',
    `standard_code` VARCHAR(50) NOT NULL COMMENT '标准编码',
    `standard_name` VARCHAR(100) NOT NULL COMMENT '标准名称',
    `product_type` TINYINT NOT NULL COMMENT '产品类型：1原煤 2精煤 3中煤 4煤泥 5矸石',
    `product_specification` VARCHAR(100) DEFAULT NULL COMMENT '产品规格',
    `quality_item_id` BIGINT NOT NULL COMMENT '检测项目ID',
    `standard_value` DECIMAL(10,4) NOT NULL COMMENT '标准值',
    `max_value` DECIMAL(10,4) DEFAULT NULL COMMENT '最大允许值',
    `min_value` DECIMAL(10,4) DEFAULT NULL COMMENT '最小允许值',
    `tolerance` DECIMAL(10,4) DEFAULT NULL COMMENT '允许公差',
    `standard_type` TINYINT NOT NULL COMMENT '标准类型：1国家标准 2行业标准 3企业标准 4客户要求',
    `standard_source` VARCHAR(200) DEFAULT NULL COMMENT '标准来源（如：GB/T标准号）',
    `effective_date` DATE NOT NULL COMMENT '生效日期',
    `expiry_date` DATE DEFAULT NULL COMMENT '失效日期',
    `version` VARCHAR(20) DEFAULT '1.0' COMMENT '版本号',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `approver_id` BIGINT DEFAULT NULL COMMENT '审批人ID',
    `approve_time` DATETIME DEFAULT NULL COMMENT '审批时间',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_standard_code` (`standard_code`, `deleted`) USING BTREE,
    INDEX `idx_product_type` (`product_type`) USING BTREE,
    INDEX `idx_quality_item` (`quality_item_id`) USING BTREE,
    INDEX `idx_standard_type` (`standard_type`) USING BTREE,
    INDEX `idx_effective_date` (`effective_date`) USING BTREE,
    INDEX `idx_status` (`status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '质量标准表';
```

### 5. 质量预警记录表 (coal_quality_alert) - 【单表】

```sql
DROP TABLE IF EXISTS `coal_quality_alert`;
CREATE TABLE `coal_quality_alert` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '预警记录ID',
    `alert_code` VARCHAR(50) NOT NULL COMMENT '预警编号',
    `alert_type` TINYINT NOT NULL COMMENT '预警类型：1超标预警 2趋势预警 3质量波动 4标准变更',
    `alert_level` TINYINT NOT NULL COMMENT '预警级别：1提醒 2警告 3严重 4紧急',
    `quality_item_id` BIGINT NOT NULL COMMENT '检测项目ID',
    `inspection_id` BIGINT DEFAULT NULL COMMENT '关联检测记录ID',
    `product_type` TINYINT NOT NULL COMMENT '产品类型：1原煤 2精煤 3中煤 4煤泥 5矸石',
    `measured_value` DECIMAL(10,4) DEFAULT NULL COMMENT '检测值',
    `standard_value` DECIMAL(10,4) DEFAULT NULL COMMENT '标准值',
    `threshold_value` DECIMAL(10,4) DEFAULT NULL COMMENT '预警阈值',
    `deviation` DECIMAL(10,4) DEFAULT NULL COMMENT '偏差值',
    `alert_message` VARCHAR(500) NOT NULL COMMENT '预警信息',
    `alert_time` DATETIME NOT NULL COMMENT '预警时间',
    `alert_status` TINYINT NOT NULL DEFAULT 1 COMMENT '预警状态：1待处理 2处理中 3已处理 4已忽略',
    `handler_id` BIGINT DEFAULT NULL COMMENT '处理人ID',
    `handler_name` VARCHAR(50) DEFAULT NULL COMMENT '处理人姓名',
    `handle_time` DATETIME DEFAULT NULL COMMENT '处理时间',
    `handle_method` VARCHAR(500) DEFAULT NULL COMMENT '处理措施',
    `handle_result` VARCHAR(500) DEFAULT NULL COMMENT '处理结果',
    `is_auto_alert` TINYINT NOT NULL DEFAULT 1 COMMENT '是否自动预警：0手动 1自动',
    `notification_sent` TINYINT NOT NULL DEFAULT 0 COMMENT '是否已发送通知：0否 1是',
    `notification_time` DATETIME DEFAULT NULL COMMENT '通知发送时间',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_alert_code` (`alert_code`, `deleted`) USING BTREE,
    INDEX `idx_alert_type` (`alert_type`) USING BTREE,
    INDEX `idx_alert_level` (`alert_level`) USING BTREE,
    INDEX `idx_quality_item` (`quality_item_id`) USING BTREE,
    INDEX `idx_inspection_id` (`inspection_id`) USING BTREE,
    INDEX `idx_alert_time` (`alert_time`) USING BTREE,
    INDEX `idx_alert_status` (`alert_status`) USING BTREE,
    INDEX `idx_product_type` (`product_type`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '质量预警记录表';
```

---

## 📚 字典数据配置

### 字典类型 (system_dict_type)

```sql
-- 1. 煤质检测项目类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质检测项目类型', 'coal_quality_item_type', 0, '煤质检测项目类型', '1', NOW(), '1', NOW(), 0);

-- 2. 煤质产品类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质产品类型', 'coal_quality_product_type', 0, '煤质管理产品类型', '1', NOW(), '1', NOW(), 0);

-- 3. 煤质采样方法字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质采样方法', 'coal_quality_sampling_method', 0, '煤质检测采样方法', '1', NOW(), '1', NOW(), 0);

-- 4. 煤质检测类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质检测类型', 'coal_quality_detection_type', 0, '煤质检测类型', '1', NOW(), '1', NOW(), 0);

-- 5. 煤质检测状态字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质检测状态', 'coal_quality_inspection_status', 0, '煤质检测状态', '1', NOW(), '1', NOW(), 0);

-- 6. 煤质审核状态字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质审核状态', 'coal_quality_review_status', 0, '煤质检测审核状态', '1', NOW(), '1', NOW(), 0);

-- 7. 煤质合格状态字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质合格状态', 'coal_quality_qualified', 0, '煤质检测合格状态', '1', NOW(), '1', NOW(), 0);

-- 8. 煤质标准类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质标准类型', 'coal_quality_standard_type', 0, '煤质标准类型', '1', NOW(), '1', NOW(), 0);

-- 9. 煤质预警类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质预警类型', 'coal_quality_alert_type', 0, '煤质预警类型', '1', NOW(), '1', NOW(), 0);

-- 10. 煤质预警级别字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质预警级别', 'coal_quality_alert_level', 0, '煤质预警级别', '1', NOW(), '1', NOW(), 0);

-- 11. 煤质预警状态字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质预警状态', 'coal_quality_alert_status', 0, '煤质预警状态', '1', NOW(), '1', NOW(), 0);

-- 12. 煤质性能评级字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质性能评级', 'coal_quality_performance_rating', 0, '煤质检测数据性能评级', '1', NOW(), '1', NOW(), 0);

-- 13. 煤质产品规格字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质产品规格', 'coal_quality_product_spec', 0, '煤质产品规格（如：末煤、粒煤、大块等）', '1', NOW(), '1', NOW(), 0);

-- 14. 煤质是否复检字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质是否复检', 'coal_quality_recheck', 0, '煤质检测是否复检', '1', NOW(), '1', NOW(), 0);

-- 15. 煤质标准状态字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质标准状态', 'coal_quality_standard_status', 0, '煤质标准状态', '1', NOW(), '1', NOW(), 0);

-- 16. 煤质是否自动预警字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质是否自动预警', 'coal_quality_auto_alert', 0, '煤质是否自动预警', '1', NOW(), '1', NOW(), 0);

-- 17. 煤质是否已发送通知字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('煤质是否已发送通知', 'coal_quality_notification_sent', 0, '煤质是否已发送通知', '1', NOW(), '1', NOW(), 0);
```

### 字典数据 (system_dict_data)

```sql
-- 1. 煤质检测项目类型
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '快灰', '1', 'coal_quality_item_type', 0, '1', NOW(), '1', NOW()),
(2, '快水', '2', 'coal_quality_item_type', 0, '1', NOW(), '1', NOW()),
(3, '快浮', '3', 'coal_quality_item_type', 0, '1', NOW(), '1', NOW()),
(4, '班灰', '4', 'coal_quality_item_type', 0, '1', NOW(), '1', NOW()),
(5, '其他', '5', 'coal_quality_item_type', 0, '1', NOW(), '1', NOW());

-- 2. 煤质产品类型
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '原煤', '1', 'coal_quality_product_type', 0, '1', NOW(), '1', NOW()),
(2, '精煤', '2', 'coal_quality_product_type', 0, '1', NOW(), '1', NOW()),
(3, '中煤', '3', 'coal_quality_product_type', 0, '1', NOW(), '1', NOW()),
(4, '煤泥', '4', 'coal_quality_product_type', 0, '1', NOW(), '1', NOW()),
(5, '矸石', '5', 'coal_quality_product_type', 0, '1', NOW(), '1', NOW());

-- 3. 煤质采样方法
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '人工采样', '1', 'coal_quality_sampling_method', 0, '1', NOW(), '1', NOW()),
(2, '自动采样', '2', 'coal_quality_sampling_method', 0, '1', NOW(), '1', NOW()),
(3, '混合采样', '3', 'coal_quality_sampling_method', 0, '1', NOW(), '1', NOW());

-- 4. 煤质检测类型
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '快速检测', '1', 'coal_quality_detection_type', 0, '1', NOW(), '1', NOW()),
(2, '常规检测', '2', 'coal_quality_detection_type', 0, '1', NOW(), '1', NOW()),
(3, '仲裁检测', '3', 'coal_quality_detection_type', 0, '1', NOW(), '1', NOW());

-- 5. 煤质检测状态
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '检测中', '1', 'coal_quality_inspection_status', 0, '1', NOW(), '1', NOW()),
(2, '已完成', '2', 'coal_quality_inspection_status', 0, '1', NOW(), '1', NOW()),
(3, '异常', '3', 'coal_quality_inspection_status', 0, '1', NOW(), '1', NOW()),
(4, '作废', '4', 'coal_quality_inspection_status', 0, '1', NOW(), '1', NOW());

-- 6. 煤质审核状态
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待审核', '0', 'coal_quality_review_status', 0, '1', NOW(), '1', NOW()),
(2, '审核通过', '1', 'coal_quality_review_status', 0, '1', NOW(), '1', NOW()),
(3, '审核不通过', '2', 'coal_quality_review_status', 0, '1', NOW(), '1', NOW());

-- 7. 煤质合格状态
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '不合格', '0', 'coal_quality_qualified', 0, '1', NOW(), '1', NOW()),
(2, '合格', '1', 'coal_quality_qualified', 0, '1', NOW(), '1', NOW()),
(3, '待判定', '2', 'coal_quality_qualified', 0, '1', NOW(), '1', NOW());

-- 8. 煤质标准类型
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '国家标准', '1', 'coal_quality_standard_type', 0, '1', NOW(), '1', NOW()),
(2, '行业标准', '2', 'coal_quality_standard_type', 0, '1', NOW(), '1', NOW()),
(3, '企业标准', '3', 'coal_quality_standard_type', 0, '1', NOW(), '1', NOW()),
(4, '客户要求', '4', 'coal_quality_standard_type', 0, '1', NOW(), '1', NOW());

-- 9. 煤质预警类型
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '超标预警', '1', 'coal_quality_alert_type', 0, '1', NOW(), '1', NOW()),
(2, '趋势预警', '2', 'coal_quality_alert_type', 0, '1', NOW(), '1', NOW()),
(3, '质量波动', '3', 'coal_quality_alert_type', 0, '1', NOW(), '1', NOW()),
(4, '标准变更', '4', 'coal_quality_alert_type', 0, '1', NOW(), '1', NOW());

-- 10. 煤质预警级别
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '提醒', '1', 'coal_quality_alert_level', 0, '1', NOW(), '1', NOW()),
(2, '警告', '2', 'coal_quality_alert_level', 0, '1', NOW(), '1', NOW()),
(3, '严重', '3', 'coal_quality_alert_level', 0, '1', NOW(), '1', NOW()),
(4, '紧急', '4', 'coal_quality_alert_level', 0, '1', NOW(), '1', NOW());

-- 11. 煤质预警状态
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待处理', '1', 'coal_quality_alert_status', 0, '1', NOW(), '1', NOW()),
(2, '处理中', '2', 'coal_quality_alert_status', 0, '1', NOW(), '1', NOW()),
(3, '已处理', '3', 'coal_quality_alert_status', 0, '1', NOW(), '1', NOW()),
(4, '已忽略', '4', 'coal_quality_alert_status', 0, '1', NOW(), '1', NOW());

-- 12. 煤质性能评级
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '优秀', '1', 'coal_quality_performance_rating', 0, '1', NOW(), '1', NOW()),
(2, '良好', '2', 'coal_quality_performance_rating', 0, '1', NOW(), '1', NOW()),
(3, '一般', '3', 'coal_quality_performance_rating', 0, '1', NOW(), '1', NOW()),
(4, '较差', '4', 'coal_quality_performance_rating', 0, '1', NOW(), '1', NOW()),
(5, '故障', '5', 'coal_quality_performance_rating', 0, '1', NOW(), '1', NOW());

-- 13. 煤质产品规格
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '末煤', '1', 'coal_quality_product_spec', 0, '1', NOW(), '1', NOW()),
(2, '粒煤', '2', 'coal_quality_product_spec', 0, '1', NOW(), '1', NOW()),
(3, '大块', '3', 'coal_quality_product_spec', 0, '1', NOW(), '1', NOW()),
(4, '小块', '4', 'coal_quality_product_spec', 0, '1', NOW(), '1', NOW()),
(5, '籽煤', '5', 'coal_quality_product_spec', 0, '1', NOW(), '1', NOW()),
(6, '沫煤', '6', 'coal_quality_product_spec', 0, '1', NOW(), '1', NOW());

-- 14. 煤质是否复检
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '否', '0', 'coal_quality_recheck', 0, '1', NOW(), '1', NOW()),
(2, '是', '1', 'coal_quality_recheck', 0, '1', NOW(), '1', NOW());

-- 15. 煤质标准状态
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '草稿', '0', 'coal_quality_standard_status', 0, '1', NOW(), '1', NOW()),
(2, '启用', '1', 'coal_quality_standard_status', 0, '1', NOW(), '1', NOW()),
(3, '停用', '2', 'coal_quality_standard_status', 0, '1', NOW(), '1', NOW()),
(4, '已归档', '3', 'coal_quality_standard_status', 0, '1', NOW(), '1', NOW());

-- 16. 煤质是否自动预警
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '手动', '0', 'coal_quality_auto_alert', 0, '1', NOW(), '1', NOW()),
(2, '自动', '1', 'coal_quality_auto_alert', 0, '1', NOW(), '1', NOW());

-- 17. 煤质是否已发送通知
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '否', '0', 'coal_quality_notification_sent', 0, '1', NOW(), '1', NOW()),
(2, '是', '1', 'coal_quality_notification_sent', 0, '1', NOW(), '1', NOW());
```

---

## 🛠️ 代码生成器配置

### 生成顺序（按表类型和依赖关系）

#### 第一步：单表生成
1. **coal_quality_item** (质量检测项目表) - 【单表】
2. **coal_quality_standard** (质量标准表) - 【单表】  
3. **coal_quality_alert** (质量预警记录表) - 【单表】

#### 第二步：主子表生成
4. **coal_quality_inspection** (主表) + **coal_quality_data** (子表) - 【主子表】

### 代码生成器设置

#### 单表配置
```
表类型: 单表
模块名: coal
业务名: qualityItem / qualityStandard / qualityAlert
业务描述: 质量检测项目 / 质量标准 / 质量预警
类名: QualityItem / QualityStandard / QualityAlert
作者: 京京
包路径: cn.iocoder.yudao.module.coal
```

#### 主子表配置
```
表类型: 主子表
模块名: coal
业务名: qualityInspection
业务描述: 质量检测记录
主表: coal_quality_inspection
子表: coal_quality_data
主表类名: QualityInspection
子表类名: QualityData
关联字段: inspection_id
作者: 京京
包路径: cn.iocoder.yudao.module.coal
```

### 字段特殊配置

#### coal_quality_item 表【单表】
- `item_type`: 字典 `coal_quality_item_type`
- `status`: 字典 `common_status`

#### coal_quality_inspection 表【主表】  
- `shift_id`: 关联 `coal_shift_system` 表
- `product_type`: 字典 `coal_quality_product_type`
- `sampling_method`: 字典 `coal_quality_sampling_method`
- `detection_type`: 字典 `coal_quality_detection_type`
- `inspection_status`: 字典 `coal_quality_inspection_status`
- `review_status`: 字典 `coal_quality_review_status`

#### coal_quality_data 表【子表】
- `quality_item_id`: 关联 `coal_quality_item` 表
- `inspection_id`: 关联 `coal_quality_inspection` 表（主子表关联字段）
- `is_qualified`: 字典 `coal_quality_qualified`
- `performance_rating`: 字典 `coal_quality_performance_rating`

#### coal_quality_standard 表【单表】
- `product_type`: 字典 `coal_quality_product_type`
- `quality_item_id`: 关联 `coal_quality_item` 表
- `standard_type`: 字典 `coal_quality_standard_type`

#### coal_quality_alert 表【单表】
- `alert_type`: 字典 `coal_quality_alert_type`
- `alert_level`: 字典 `coal_quality_alert_level`
- `product_type`: 字典 `coal_quality_product_type`
- `quality_item_id`: 关联 `coal_quality_item` 表
- `inspection_id`: 关联 `coal_quality_inspection` 表
- `alert_status`: 字典 `coal_quality_alert_status`

---

## 📝 基础测试数据

### 检测项目测试数据

```sql
-- 质量检测项目基础数据
INSERT INTO `coal_quality_item` (`item_code`, `item_name`, `item_type`, `unit`, `detection_method`, `standard_value`, `max_value`, `min_value`, `warning_upper_limit`, `warning_lower_limit`, `sort`, `status`, `creator`, `create_time`) VALUES
('QI001', '灰分', 1, '%', 'GB/T 212-2008', 10.00, 15.00, 5.00, 12.00, 6.00, 1, 1, '1', NOW()),
('QI002', '水分', 2, '%', 'GB/T 211-2017', 8.00, 12.00, 3.00, 10.00, 4.00, 2, 1, '1', NOW()),
('QI003', '浮沉密度', 3, 'kg/L', 'GB/T 478-2008', 1.50, 2.00, 1.30, 1.80, 1.35, 3, 1, '1', NOW()),
('QI004', '挥发分', 4, '%', 'GB/T 212-2008', 25.00, 35.00, 15.00, 30.00, 18.00, 4, 1, '1', NOW()),
('QI005', '硫分', 5, '%', 'GB/T 214-2007', 0.50, 1.00, 0.20, 0.80, 0.30, 5, 1, '1', NOW());
```

---

## 🎯 实施步骤

### 第一阶段：基础CRUD实现

#### 步骤1：数据库准备
1. ✅ 执行数据库表创建SQL（5个表）
2. ✅ 执行字典数据配置SQL（12个字典类型，52个字典数据）
3. ✅ 插入基础测试数据（检测项目等）

#### 步骤2：代码生成（按顺序）
1. ✅ **单表生成**：
   - `coal_quality_item` (质量检测项目表)
   - `coal_quality_standard` (质量标准表)  
   - `coal_quality_alert` (质量预警记录表)

2. ✅ **主子表生成**：
   - 主表：`coal_quality_inspection` (质量检测记录表)
   - 子表：`coal_quality_data` (质量检测数据表)
   - 关联字段：`inspection_id`

#### 步骤3：代码集成
1. ✅ 导入生成的后端代码到 `yudao-module-coal`
2. ✅ 导入生成的前端代码到 `yudao-ui-admin-vue3`
3. ✅ 配置菜单和权限
4. ✅ 验证基本增删改查功能

### 第二阶段：业务逻辑扩展（后续开发）
1. 🔄 主子表联动：检测记录与检测数据的业务关联
2. 🔄 质量判定：基于质量标准的自动合格判定
3. 🔄 预警机制：超标自动预警和通知推送
4. 🔄 统计分析：质量统计报表和趋势图表
5. 🔄 系统集成：与生产日报、班次数据的深度关联

---

## ✅ 总结

这个煤质管理模块设计严格按照芋道代码生成器规范设计，包含：

### 📊 表结构设计
- **3个单表**：检测项目、质量标准、质量预警
- **1个主子表**：检测记录(主) + 检测数据(子)
- **0个树表**：煤质管理不需要层级结构

### 🗂️ 字典配置完整
- **12个字典类型**：覆盖所有枚举字段
- **52个字典数据项**：满足业务需求
- **关联关系清晰**：表间关系明确

### 🎯 业务功能覆盖
1. **生产过程检测** - 检测项目配置 + 检测记录管理
2. **质量统计** - 检测数据多维度分析
3. **检化验管理** - 质量标准全程控制
4. **质量预警** - 异常预警监控

### 🚀 技术规范
- ✅ 严格遵循芋道框架标准
- ✅ 支持多租户架构
- ✅ 完整的索引设计
- ✅ 预留扩展字段

### 📋 实施建议
1. **先完成基础CRUD**：按单表→主子表顺序生成代码
2. **验证功能完整性**：确保增删改查正常工作
3. **再扩展业务逻辑**：实现质量判定、预警机制等高级功能

这个设计为后续的质量管理业务提供了坚实的数据基础，可以直接使用芋道代码生成器开始开发！
