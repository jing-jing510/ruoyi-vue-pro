# 备件使用记录跳转问题分析和解决

## 问题描述
检修单列表中的"备件使用记录"按钮点击后没有跳转到对应的备件使用记录页面，或者跳转后没有筛选到相关数据。

## 问题分析

### 1. 路由路径问题
**问题**: 最初使用的路径 `/coal/spare-part-usage-record` 不正确
**原因**: 芋道框架的路由规则是基于目录结构的，备件使用记录的目录是 `sparepartusagerecord`
**解决**: 修正路径为 `/coal/sparepartusagerecord`

### 2. 数据关联问题
**问题**: 备件使用记录表中的 `work_order_id` 字段为 `NULL`
**原因**: 现有的备件使用记录数据没有关联到检修单
**影响**: 即使跳转成功，也无法筛选到相关数据

## 解决方案

### 1. 修正路由路径
```typescript
// 修改前
router.push({
  path: '/coal/spare-part-usage-record',
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})

// 修改后
router.push({
  path: '/coal/sparepartusagerecord',
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})
```

### 2. 更新测试数据
创建SQL脚本更新备件使用记录，关联到检修单：
```sql
-- 更新备件使用记录，关联到检修单
UPDATE coal_spare_part_usage_record 
SET work_order_id = (SELECT id FROM coal_maintenance_order LIMIT 1)
WHERE id = 3;

UPDATE coal_spare_part_usage_record 
SET work_order_id = (SELECT id FROM coal_maintenance_order LIMIT 1 OFFSET 1)
WHERE id = 4;
```

### 3. 芋道框架路由规则
芋道框架的路由规则：
- 路由路径基于 `src/views` 下的目录结构
- 目录名 `sparepartusagerecord` 对应路由路径 `/coal/sparepartusagerecord`
- 不需要使用连字符分隔

## 测试验证

### 测试步骤
1. 执行SQL脚本更新测试数据
2. 进入检修单列表页面
3. 点击"备件使用记录"按钮
4. 验证是否正确跳转到备件使用记录页面
5. 验证页面是否自动筛选出相关数据

### 预期结果
- ✅ 按钮点击后能正确跳转到备件使用记录页面
- ✅ 页面自动筛选显示与检修单相关的备件使用记录
- ✅ 搜索表单中显示对应的工单ID和设备ID
- ✅ 用户可以正常进行备件使用记录的增删改查操作

## 芋道框架路由规则总结

### 路由路径规则
1. **基础路径**: 基于 `src/views` 下的目录结构
2. **模块路径**: 如 `coal` 模块对应 `/coal`
3. **页面路径**: 如 `sparepartusagerecord` 对应 `/coal/sparepartusagerecord`
4. **命名规则**: 使用驼峰命名或全小写，不使用连字符

### 常见路径示例
- 检修单: `/coal/maintenanceorder`
- 检修计划: `/coal/maintenanceplan`
- 报修单: `/coal/repairrequest`
- 备件使用记录: `/coal/sparepartusagerecord`
- 备件基础信息: `/coal/sparepartinfo`

## 数据关联建议

### 1. 业务逻辑
- 备件使用记录应该关联到具体的检修单
- 通过 `work_order_id` 字段建立关联关系
- 支持一个检修单对应多个备件使用记录

### 2. 数据完整性
- 确保备件使用记录有正确的 `work_order_id`
- 确保检修单存在对应的备件使用记录
- 定期检查数据关联的完整性

### 3. 用户体验
- 从检修单跳转到备件使用记录时自动筛选
- 在备件使用记录中显示关联的检修单信息
- 提供便捷的关联操作界面

## 总结

通过修正路由路径和更新测试数据，备件使用记录跳转功能现在应该能够正常工作：

1. **路由跳转**: 使用正确的路径 `/coal/sparepartusagerecord`
2. **数据筛选**: 通过 `workOrderId` 和 `equipmentId` 参数自动筛选
3. **用户体验**: 提供完整的关联功能和管理界面

这完善了检修单与备件使用记录之间的业务关联，提升了系统的整体功能性和用户体验。
