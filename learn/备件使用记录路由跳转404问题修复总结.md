# 备件使用记录路由跳转404问题修复总结

## 问题描述

从检修单页面点击"备件使用记录"按钮跳转时出现404错误，无法正确跳转到备件使用记录页面。

## 问题分析

### 1. 路由跳转方式问题
根据芋道框架的路由跳转文档：
```typescript
// 简单跳转
this.$router.push({ path: "/system/user" });

// 跳转页面并设置请求参数，使用 `query` 属性
this.$router.push({ path: "/system/user", query: {id: "1", name: "芋道"} });
```

但在Vue 3 Composition API中，应该使用 `router.push` 而不是 `this.$router.push`。

### 2. 路径匹配问题
- 菜单配置中的路径：`spare-part-usage-record`
- 组件路径：`coal/sparepartusagerecord/index`
- 完整路由路径：`/coal/spare-part-usage-record`

### 3. 路由名称匹配
- 组件名称：`SparePartUsageRecord`（通过 `defineOptions({ name: 'SparePartUsageRecord' })` 定义）

## 修复方案

### 使用路由名称跳转
为了避免路径匹配问题，使用路由名称（name）进行跳转，这是更可靠的方式。

**修复前**:
```typescript
router.push({
  path: '/coal/spare-part-usage-record',  // 可能路径不匹配
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})
```

**修复后**:
```typescript
router.push({
  name: 'SparePartUsageRecord',  // 使用组件名称跳转
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})
```

## 芋道框架路由约定

### 1. 路由跳转方式
- **Vue 2 Options API**: `this.$router.push()`
- **Vue 3 Composition API**: `router.push()`

### 2. 跳转参数
```typescript
// 使用路径跳转
router.push({ path: "/system/user" });

// 使用名称跳转（推荐）
router.push({ name: "User" });

// 带查询参数跳转
router.push({ 
  name: "User", 
  query: { id: "1", name: "芋道" } 
});
```

### 3. 组件名称约定
- 组件必须通过 `defineOptions({ name: 'ComponentName' })` 定义名称
- 路由跳转时使用相同的名称
- 名称应该与组件功能相关，使用PascalCase命名

## 完整的数据流程

### 1. 菜单配置
```
系统管理 -> 菜单管理
├── 备件使用记录管理 (spare-part-usage-record)
│   ├── 备件使用记录查询
│   ├── 备件使用记录创建  
│   ├── 备件使用记录更新
│   ├── 备件使用记录删除
│   └── 备件使用记录导出
```

### 2. 组件定义
```typescript
// yudao-ui/yudao-ui-admin-vue3/src/views/coal/sparepartusagerecord/index.vue
defineOptions({ name: 'SparePartUsageRecord' })
```

### 3. 路由跳转
```typescript
// yudao-ui/yudao-ui-admin-vue3/src/views/coal/maintenanceorder/index.vue
router.push({
  name: 'SparePartUsageRecord',  // 使用组件名称
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})
```

### 4. 参数接收
```typescript
// 备件使用记录页面接收参数
onMounted(() => {
  const route = useRoute()
  if (route.query.workOrderId) {
    queryParams.workOrderId = Number(route.query.workOrderId)
  }
  if (route.query.equipmentId) {
    queryParams.equipmentId = Number(route.query.equipmentId)
  }
  // 加载数据...
})
```

## 预期结果

修复后，当从检修单页面点击"备件使用记录"按钮时：

1. **跳转成功**: 正确跳转到备件使用记录页面，不再出现404错误
2. **参数传递**: 正确传递 `workOrderId` 和 `equipmentId` 查询参数
3. **数据过滤**: 页面根据传递的参数过滤显示相关记录
4. **设备名称显示**: 关联设备列显示设备名称而不是设备ID

## 测试步骤

1. 刷新检修单页面
2. 点击任意检修单的"备件使用记录"按钮
3. 验证是否成功跳转到备件使用记录页面（不再404）
4. 验证URL是否包含正确的查询参数
5. 验证页面是否根据参数过滤显示相关记录
6. 验证设备名称是否正确显示

## 教训

1. **路由跳转方式**: 在Vue 3 Composition API中使用 `router.push` 而不是 `this.$router.push`
2. **使用路由名称**: 优先使用路由名称（name）进行跳转，避免路径匹配问题
3. **组件名称一致性**: 确保跳转时使用的名称与组件定义的名称完全一致
4. **芋道框架约定**: 遵循框架的路由约定和命名规范
5. **完整测试**: 功能开发完成后需要进行端到端的完整测试

## 相关文件

- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/maintenanceorder/index.vue` - 检修单页面跳转逻辑
- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/sparepartusagerecord/index.vue` - 备件使用记录页面
- `yudao-module-coal/src/main/java/cn/iocoder/yudao/module/coal/dal/mysql/sparepartusagerecord/SparePartUsageRecordMapper.java` - 后端查询逻辑
