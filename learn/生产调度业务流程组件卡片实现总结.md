# 生产调度业务流程组件卡片实现总结

## 业务逻辑分析

根据合同功能模块要求和开发大纲，生产调度模块包含以下核心业务流程：

### 📋 生产调度业务流程

```
生产计划 → 班制与班次设置 → 排班管理 → 生产日报
    ↓           ↓               ↓          ↓
年度计划     生产班制        人员安排     现场填报
月度计划     倒班设置        替班管理     产量统计
日计划       班次时间        审批流程     质量记录
班计划       岗位配置        工作状态     运行数据
```

### 🔄 业务逻辑详解

#### 1. **生产计划管理**
- **功能**: 宏观性排产，支持年/月/日/班计划层级管理
- **数据结构**: 树表结构，支持计划拆分和调整
- **业务特点**:
  - 年度计划可拆分为月度计划
  - 月度计划可细分到日计划、班计划
  - 支持产量、质量、进度调整
  - 包含入洗原煤量、精煤产量、中煤产量、煤泥产量、矸石产量
  - 各产品灰分指标管理

#### 2. **班制与班次设置**
- **功能**: 开放性班次设置，支持倒班和值班
- **数据结构**: 树表结构，班制-班次层级管理
- **业务特点**:
  - 可指定生产班制
  - 设置班次开始/结束时间
  - 支持不同班次类型
  - 灵活的班制配置

#### 3. **排班管理**
- **功能**: 日常排班、人员安排、替班管理
- **数据结构**: 主子表结构，排班-人员安排
- **业务特点**:
  - 按日期进行排班
  - 关联班制和班次
  - 人员岗位分配
  - 班组长指定
  - 替班原因记录
  - 审批流程管理

#### 4. **生产日报**
- **功能**: 现场生产数据记录和统计
- **数据内容**: 详细的生产运行数据
- **业务特点**:
  - 按班次记录生产数据
  - 产量数据（入洗量、产出量）
  - 质量数据（灰分、水分）
  - 运行数据（时间、效率）
  - 设备状态和故障记录
  - 能源消耗记录

## 组件实现特性

### 🎨 可视化流程图

#### 1. **垂直流程布局**
- **起始节点**: 生产计划（蓝色主题）
- **过程节点**: 班制设置、排班管理（橙色主题）
- **结束节点**: 生产日报（绿色主题）
- **连接箭头**: 清晰的流程方向指示

#### 2. **节点状态展示**
- **生产计划**: 年度计划数、月度计划数
- **班制设置**: 生产班制数量
- **排班管理**: 今日排班、待审批数量
- **生产日报**: 今日填报、缺失填报数量

### 📊 实时数据统计

#### 1. **生产调度统计**
- **生产天数**: 本月实际生产天数
- **月度产量**: 本月累计产量统计
- **在岗人员**: 当前在岗人员数量
- **计划完成率**: 产量完成情况百分比

#### 2. **今日生产概览**
- **入洗原煤**: 今日入洗原煤量统计
- **精煤产量**: 今日精煤产出量统计
- **运行时间**: 今日有效运行时间

#### 3. **数据来源分析**
```typescript
// 并行获取各模块统计数据
const [
  productionPlanResponse,      // 生产计划总数
  dailyReportResponse,         // 生产日报总数
  shiftSystemResponse,         // 班制班次列表
  scheduleResponse            // 排班管理总数
] = await Promise.all([...])

// 专项统计查询
yearlyPlanResponse,          // 年度计划数
monthlyPlanResponse,         // 月度计划数
todayScheduleResponse,       // 今日排班数
pendingApprovalResponse,     // 待审批数
todayReportResponse,         // 今日日报数
monthlyReportResponse        // 本月日报数据
```

### 🚀 快速操作入口

#### 1. **功能按钮**
- **生产计划**: 跳转到生产计划管理
- **排班管理**: 跳转到排班管理页面
- **填写日报**: 跳转到生产日报填写
- **班制设置**: 跳转到班制班次设置

#### 2. **路由跳转**
```typescript
// 使用组件名称跳转（与设备维护模块一致）
const goToProductionPlan = () => {
  router.push({ name: 'ProductionPlan' })
}

const goToProductionDailyReport = () => {
  router.push({ name: 'ProductionDailyReport' })
}

const goToShiftSystem = () => {
  router.push({ name: 'ShiftSystem' })
}

const goToSchedule = () => {
  router.push({ name: 'Schedule' })
}
```

## 技术实现细节

### 🔧 数据处理逻辑

#### 1. **统计计算**
```typescript
// 月度产量统计
const monthlyOutput = monthlyReports.reduce(
  (sum, report) => sum + (report.rawCoalInput || 0), 0
)

// 精煤产量统计
const monthlyCleanCoal = monthlyReports.reduce((sum, report) => 
  sum + (report.blockCleanCoalOutput || 0) + (report.fineCleanCoalOutput || 0), 0
)

// 今日运行时间计算
const todayOperatingHours = todayReports.reduce((sum, report) => 
  sum + (report.effectiveFeedingTime || 0), 0
) / 60 // 转换为小时
```

#### 2. **日期处理**
```typescript
// 获取当前年月
const currentYear = new Date().getFullYear()
const currentMonth = new Date().getMonth() + 1

// 今日日期
const today = new Date().toISOString().split('T')[0]

// 月份起止日期
const monthStart = new Date(currentYear, currentMonth - 1, 1).toISOString().split('T')[0]
const monthEnd = new Date(currentYear, currentMonth, 0).toISOString().split('T')[0]
```

#### 3. **缺失数据检测**
```typescript
// 计算缺失填报数量
missingReportCount: Math.max(0, 
  (todayScheduleResponse.total || 0) - (todayReportResponse.total || 0)
)
```

### 📱 响应式设计

#### 1. **自适应布局**
- 支持移动端适配
- 灵活的网格系统
- 统一的视觉风格

#### 2. **组件复用**
- 与设备维护流程卡片保持一致的设计语言
- 统一的状态标签样式
- 相同的交互模式

## 业务价值分析

### 📈 管理效益

#### 1. **生产计划可视化**
- 快速了解计划制定情况
- 直观展示计划层级结构
- 实时跟踪计划执行进度

#### 2. **人员调度优化**
- 清晰的排班状态展示
- 及时发现排班问题
- 高效的审批流程管理

#### 3. **生产数据监控**
- 实时生产数据展示
- 快速发现异常情况
- 数据驱动决策支持

### 🎯 操作便利性

#### 1. **一站式概览**
- 核心业务数据集中展示
- 减少页面跳转操作
- 提升工作效率

#### 2. **快速响应**
- 自动刷新机制
- 实时数据更新
- 及时问题预警

## 系统集成性

### 🔗 与其他模块关联

#### 1. **设备管理模块**
- 生产日报中的设备状态记录
- 设备故障对生产的影响分析
- 设备维护计划与生产计划协调

#### 2. **煤质管理模块**
- 生产日报中的质量数据
- 灰分、水分等指标记录
- 质量目标与生产计划对接

#### 3. **安全管理模块**
- 班组安全责任人设置
- 安全检查与排班结合
- 事故记录与生产影响分析

## 未来扩展方向

### 🚀 功能增强

#### 1. **智能分析**
- 生产效率分析
- 人员工作量分析
- 设备利用率统计

#### 2. **预测功能**
- 产量预测模型
- 人员需求预测
- 设备维护提醒

#### 3. **移动端支持**
- 现场数据录入
- 移动审批功能
- 实时消息推送

## 相关文件

- `yudao-ui/yudao-ui-admin-vue3/src/components/ProductionScheduleBusinessFlowCard.vue` - 生产调度业务流程组件
- `yudao-ui/yudao-ui-admin-vue3/src/views/Home/Index.vue` - 首页集成
- `yudao-ui/yudao-ui-admin-vue3/src/api/coal/productionplan/index.ts` - 生产计划API
- `yudao-ui/yudao-ui-admin-vue3/src/api/coal/productiondailyreport/index.ts` - 生产日报API
- `yudao-ui/yudao-ui-admin-vue3/src/api/coal/shiftsystem/index.ts` - 班制班次API
- `yudao-ui/yudao-ui-admin-vue3/src/api/coal/schedule/index.ts` - 排班管理API
- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/productionplan/index.vue` - 生产计划页面
- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/productiondailyreport/index.vue` - 生产日报页面
- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/shiftsystem/index.vue` - 班制班次页面
- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/schedule/index.vue` - 排班管理页面
