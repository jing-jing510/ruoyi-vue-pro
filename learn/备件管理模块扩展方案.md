# 备件管理模块扩展方案

## 🎯 方案概述

基于芋道开源框架的ERP模块，通过扩展和定制化开发，实现选煤厂备件管理功能。本方案充分利用现有ERP模块的成熟架构，大幅减少开发工作量，提高系统稳定性和可维护性。

## 📊 方案优势

### 1. **开发效率提升**
- 复用现有ERP模块80%的代码
- 减少开发时间从2-3周缩短到1周
- 降低测试和维护成本

### 2. **功能完整性**
- ERP模块已包含完整的库存管理功能
- 支持多仓库、多单位、多业务类型
- 具备完善的出入库流程

### 3. **架构稳定性**
- 基于成熟的ERP架构设计
- 经过大量项目验证的代码质量
- 支持高并发和大数据量

### 4. **扩展性强**
- 可以轻松扩展备件特有功能
- 为后续采购、财务模块奠定基础
- 支持多租户和权限管理

## 🗄️ 数据库设计

### 1. **复用ERP核心表结构**

#### 1.1 产品分类表 (erp_product_category) - 树表结构
```sql
-- 直接使用ERP产品分类表，用于备件分类管理
-- 实际表结构：
CREATE TABLE `erp_product_category` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '分类编号',
  `parent_id` bigint NOT NULL DEFAULT '0' COMMENT '父分类编号',
  `name` varchar(255) NOT NULL COMMENT '分类名称',
  `code` varchar(255) NOT NULL COMMENT '分类编码',
  `sort` int NOT NULL DEFAULT '0' COMMENT '分类排序',
  `status` tinyint NOT NULL DEFAULT '0' COMMENT '开启状态',
  `creator` varchar(64) DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  `tenant_id` bigint NOT NULL DEFAULT '0' COMMENT '租户编号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ERP 产品分类';
```

#### 1.2 产品信息表 (erp_product) - 主表
```sql
-- 扩展ERP产品表，添加备件特有字段
-- 实际表结构：
CREATE TABLE `erp_product` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '产品编号',
  `name` varchar(255) NOT NULL COMMENT '产品名称',
  `bar_code` varchar(255) DEFAULT NULL COMMENT '产品条码',
  `category_id` bigint NOT NULL COMMENT '产品分类编号',
  `unit_id` bigint NOT NULL COMMENT '单位编号',
  `status` tinyint NOT NULL DEFAULT '0' COMMENT '产品状态',
  `standard` varchar(255) DEFAULT NULL COMMENT '产品规格',
  `remark` varchar(500) DEFAULT NULL COMMENT '产品备注',
  `expiry_day` int DEFAULT NULL COMMENT '保质期天数',
  `weight` decimal(10,2) DEFAULT NULL COMMENT '基础重量（kg）',
  `purchase_price` decimal(10,2) DEFAULT NULL COMMENT '采购价格，单位：元',
  `sale_price` decimal(10,2) DEFAULT NULL COMMENT '销售价格，单位：元',
  `min_price` decimal(10,2) DEFAULT NULL COMMENT '最低价格，单位：元',
  `creator` varchar(64) DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  `tenant_id` bigint NOT NULL DEFAULT '0' COMMENT '租户编号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ERP 产品';

-- 添加备件特有字段
ALTER TABLE erp_product ADD COLUMN equipment_id BIGINT COMMENT '关联设备ID (关联coal_equipment_info.id)';
ALTER TABLE erp_product ADD COLUMN spare_part_type TINYINT COMMENT '备件类型：1易损件 2关键件 3标准件';
ALTER TABLE erp_product ADD COLUMN min_stock DECIMAL(10,2) COMMENT '最低库存预警数量';
ALTER TABLE erp_product ADD COLUMN max_stock DECIMAL(10,2) COMMENT '最高库存数量';
ALTER TABLE erp_product ADD COLUMN safety_stock DECIMAL(10,2) COMMENT '安全库存数量';
ALTER TABLE erp_product ADD COLUMN supplier_id BIGINT COMMENT '主要供应商ID (关联erp_supplier.id)';
ALTER TABLE erp_product ADD COLUMN replacement_cycle INT COMMENT '更换周期(天)';
ALTER TABLE erp_product ADD COLUMN last_replacement_date DATE COMMENT '最后更换日期';
ALTER TABLE erp_product ADD COLUMN next_replacement_date DATE COMMENT '下次更换日期';
```

#### 1.3 产品单位表 (erp_product_unit)
```sql
-- 直接使用ERP产品单位表，用于备件单位管理
-- 实际表结构：
CREATE TABLE `erp_product_unit` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '单位编号',
  `name` varchar(255) NOT NULL COMMENT '单位名字',
  `status` tinyint NOT NULL DEFAULT '0' COMMENT '单位状态',
  `creator` varchar(64) DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  `tenant_id` bigint NOT NULL DEFAULT '0' COMMENT '租户编号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ERP 产品单位';
```

#### 1.4 仓库管理表 (erp_warehouse)
```sql
-- 直接使用ERP仓库表，用于备件仓库管理
-- 实际表结构：
CREATE TABLE `erp_warehouse` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '仓库编号',
  `name` varchar(255) NOT NULL COMMENT '仓库名称',
  `address` varchar(255) DEFAULT NULL COMMENT '仓库地址',
  `sort` bigint DEFAULT NULL COMMENT '排序',
  `remark` varchar(500) DEFAULT NULL COMMENT '备注',
  `principal` varchar(255) DEFAULT NULL COMMENT '负责人',
  `warehouse_price` decimal(10,2) DEFAULT NULL COMMENT '仓储费，单位：元',
  `truckage_price` decimal(10,2) DEFAULT NULL COMMENT '搬运费，单位：元',
  `status` tinyint NOT NULL DEFAULT '0' COMMENT '开启状态',
  `default_status` bit(1) DEFAULT NULL COMMENT '是否默认',
  `creator` varchar(64) DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  `tenant_id` bigint NOT NULL DEFAULT '0' COMMENT '租户编号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ERP 仓库';
```

#### 1.5 库存表 (erp_stock)
```sql
-- 直接使用ERP库存表，用于备件库存管理
-- 实际表结构：
CREATE TABLE `erp_stock` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '编号',
  `product_id` bigint NOT NULL COMMENT '产品编号',
  `warehouse_id` bigint NOT NULL COMMENT '仓库编号',
  `count` decimal(10,2) NOT NULL COMMENT '库存数量',
  `creator` varchar(64) DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  `tenant_id` bigint NOT NULL DEFAULT '0' COMMENT '租户编号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ERP 产品库存';
```

#### 1.6 库存记录表 (erp_stock_record)
```sql
-- 直接使用ERP库存记录表，用于备件出入库记录
-- 实际表结构：
CREATE TABLE `erp_stock_record` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '编号',
  `product_id` bigint NOT NULL COMMENT '产品编号',
  `warehouse_id` bigint NOT NULL COMMENT '仓库编号',
  `count` decimal(10,2) NOT NULL COMMENT '出入库数量',
  `total_count` decimal(10,2) NOT NULL COMMENT '总库存量',
  `biz_type` int NOT NULL COMMENT '业务类型',
  `biz_id` bigint NOT NULL COMMENT '业务编号',
  `biz_item_id` bigint DEFAULT NULL COMMENT '业务项编号',
  `biz_no` varchar(255) NOT NULL COMMENT '业务单号',
  `creator` varchar(64) DEFAULT '' COMMENT '创建者',
  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) DEFAULT '' COMMENT '更新者',
  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` bit(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
  `tenant_id` bigint NOT NULL DEFAULT '0' COMMENT '租户编号',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ERP 产品库存明细';
```

### 2. **新增备件特有表**

#### 2.1 备件设备关联表 (coal_spare_part_equipment)
```sql
DROP TABLE IF EXISTS `coal_spare_part_equipment`;
CREATE TABLE `coal_spare_part_equipment` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关联ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID (关联erp_product.id)',
    `equipment_id` BIGINT NOT NULL COMMENT '设备ID (关联coal_equipment_info.id)',
    `usage_count` INT NOT NULL DEFAULT 0 COMMENT '使用数量',
    `is_required` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否必需：1是 0否',
    `remark` VARCHAR(500) NULL COMMENT '备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_equipment` (`equipment_id`) USING BTREE,
    UNIQUE KEY `uk_spare_equipment` (`spare_part_id`, `equipment_id`, `deleted`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件设备关联表';
```

#### 2.2 备件预警记录表 (coal_spare_part_alert)
```sql
DROP TABLE IF EXISTS `coal_spare_part_alert`;
CREATE TABLE `coal_spare_part_alert` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '预警ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID (关联erp_product.id)',
    `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID (关联erp_warehouse.id)',
    `alert_type` TINYINT NOT NULL COMMENT '预警类型：1库存不足 2库存过多 3到期提醒 4更换提醒',
    `current_stock` DECIMAL(10,2) NOT NULL COMMENT '当前库存',
    `threshold_value` DECIMAL(10,2) NOT NULL COMMENT '阈值',
    `alert_level` TINYINT NOT NULL DEFAULT 1 COMMENT '预警级别：1低 2中 3高',
    `alert_status` TINYINT NOT NULL DEFAULT 1 COMMENT '预警状态：1待处理 2已处理 3已忽略',
    `alert_message` VARCHAR(500) NOT NULL COMMENT '预警信息',
    `handler_id` BIGINT NULL COMMENT '处理人ID',
    `handle_time` DATETIME NULL COMMENT '处理时间',
    `handle_remark` VARCHAR(500) NULL COMMENT '处理备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_warehouse` (`warehouse_id`) USING BTREE,
    INDEX `idx_alert_type` (`alert_type`) USING BTREE,
    INDEX `idx_alert_status` (`alert_status`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件预警记录表';
```

## 📋 字典数据配置

### 1. **复用ERP现有字典**

#### 1.1 ERP审核状态字典 (erp_audit_status)
```sql
-- ERP审核状态字典已存在，用于备件审批流程
-- 包含：待审核、审核通过、审核不通过等状态
```

#### 1.2 ERP库存记录业务类型字典 (erp_stock_record_biz_type)
```sql
-- ERP库存记录业务类型字典已存在，包含：
-- 其它入库(10)、其它出库(20)、调拨入库(30)、调拨出库(32)
-- 盘盈入库(40)、盘亏出库(42)、销售出库(50)、销售退货入库(60)
-- 采购入库(70)、采购退货出库(80) 等
```

### 2. **新增备件特有字典**

#### 2.1 备件类型字典
```sql
-- 备件类型
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('备件类型', 'spare_part_type', 0, '备件类型分类', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '易损件', '1', 'spare_part_type', 0, '1', NOW(), '1', NOW()),
(2, '关键件', '2', 'spare_part_type', 0, '1', NOW(), '1', NOW()),
(3, '标准件', '3', 'spare_part_type', 0, '1', NOW(), '1', NOW());
```

#### 2.2 预警类型字典
```sql
-- 预警类型
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('预警类型', 'alert_type', 0, '备件预警类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '库存不足', '1', 'alert_type', 0, '1', NOW(), '1', NOW()),
(2, '库存过多', '2', 'alert_type', 0, '1', NOW(), '1', NOW()),
(3, '到期提醒', '3', 'alert_type', 0, '1', NOW(), '1', NOW()),
(4, '更换提醒', '4', 'alert_type', 0, '1', NOW(), '1', NOW());
```

#### 2.3 预警级别字典
```sql
-- 预警级别
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('预警级别', 'alert_level', 0, '备件预警级别', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '低', '1', 'alert_level', 0, '1', NOW(), '1', NOW()),
(2, '中', '2', 'alert_level', 0, '1', NOW(), '1', NOW()),
(3, '高', '3', 'alert_level', 0, '1', NOW(), '1', NOW());
```

#### 2.4 预警状态字典
```sql
-- 预警状态
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('预警状态', 'alert_status', 0, '备件预警状态', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待处理', '1', 'alert_status', 0, '1', NOW(), '1', NOW()),
(2, '已处理', '2', 'alert_status', 0, '1', NOW(), '1', NOW()),
(3, '已忽略', '3', 'alert_status', 0, '1', NOW(), '1', NOW());
```

### 3. **前端字典配置更新**

在 `src/utils/dict.ts` 中添加备件相关字典：
```typescript
export const DICT_TYPE = {
  // ... 现有字典
  ERP_AUDIT_STATUS = 'erp_audit_status', // ERP 审批状态
  ERP_STOCK_RECORD_BIZ_TYPE = 'erp_stock_record_biz_type', // 库存明细的业务类型
  
  // 备件管理新增字典
  SPARE_PART_TYPE = 'spare_part_type', // 备件类型
  ALERT_TYPE = 'alert_type', // 预警类型
  ALERT_LEVEL = 'alert_level', // 预警级别
  ALERT_STATUS = 'alert_status', // 预警状态
} as const;
```

## 🚀 实施步骤

### 第一阶段：数据库扩展 (1天)

#### 1.1 执行SQL脚本
```bash
# 1. 扩展erp_product表
mysql -u root -p ruoyi-vue-pro < sql/extend_erp_product.sql

# 2. 创建备件特有表
mysql -u root -p ruoyi-vue-pro < sql/coal_spare_part_tables.sql

# 3. 插入字典数据
mysql -u root -p ruoyi-vue-pro < sql/spare_part_dict_data.sql
```

#### 1.2 验证数据库结构
```sql
-- 验证表结构
DESCRIBE erp_product;
DESCRIBE coal_spare_part_equipment;
DESCRIBE coal_spare_part_alert;

-- 验证字典数据
SELECT * FROM system_dict_type WHERE type LIKE '%spare_part%' OR type LIKE '%alert%';
```

### 第二阶段：后端代码扩展 (2-3天)

#### 2.1 扩展ERP Product实体类
```java
// 在ErpProductDO中添加备件特有字段
@TableField("equipment_id")
private Long equipmentId;

@TableField("spare_part_type")
private Integer sparePartType;

@TableField("min_stock")
private BigDecimal minStock;

@TableField("max_stock")
private BigDecimal maxStock;

@TableField("safety_stock")
private BigDecimal safetyStock;

@TableField("supplier_id")
private Long supplierId;

@TableField("replacement_cycle")
private Integer replacementCycle;

@TableField("last_replacement_date")
private LocalDate lastReplacementDate;

@TableField("next_replacement_date")
private LocalDate nextReplacementDate;
```

#### 2.2 创建备件特有Service接口
```java
// CoalSparePartEquipmentService.java
public interface CoalSparePartEquipmentService {
    void createSparePartEquipment(Long sparePartId, Long equipmentId, Integer usageCount);
    void deleteSparePartEquipment(Long sparePartId, Long equipmentId);
    List<CoalSparePartEquipmentDO> getSparePartEquipments(Long sparePartId);
    List<CoalSparePartEquipmentDO> getEquipmentSpareParts(Long equipmentId);
}

// CoalSparePartAlertService.java
public interface CoalSparePartAlertService {
    void createAlert(Long sparePartId, Long warehouseId, Integer alertType, BigDecimal currentStock, BigDecimal thresholdValue);
    void handleAlert(Long alertId, Long handlerId, String handleRemark);
    List<CoalSparePartAlertDO> getPendingAlerts();
    void checkStockAlerts(); // 定时检查库存预警
}
```

#### 2.3 扩展ERP Product Service
```java
// 在ErpProductServiceImpl中添加备件特有方法
public List<ErpProductDO> getSparePartsByEquipment(Long equipmentId) {
    // 根据设备ID查询关联的备件
}

public List<ErpProductDO> getLowStockSpareParts() {
    // 查询库存不足的备件
}

public void updateSparePartStock(Long productId, BigDecimal count) {
    // 更新备件库存并检查预警
}
```


### 第三阶段：前端页面扩展 (2-3天)

#### 3.1 扩展ERP产品管理页面
```typescript
// 在src/views/erp/product/product/index.vue中添加备件特有功能
// 1. 添加备件类型筛选 (spare_part_type)
// 2. 添加设备关联显示 (equipment_id)
// 3. 添加库存预警显示 (min_stock, max_stock, safety_stock)
// 4. 添加备件特有字段编辑 (replacement_cycle, last_replacement_date, next_replacement_date)
```

#### 3.2 创建备件管理专用页面
```typescript
// src/views/coal/sparepart/index.vue - 备件管理主页
// src/views/coal/sparepart/SparePartForm.vue - 备件表单
// src/views/coal/sparepart/components/EquipmentRelation.vue - 设备关联组件
// src/views/coal/sparepart/components/StockAlert.vue - 库存预警组件
// src/views/coal/sparepart/components/SparePartStock.vue - 库存管理组件
```

#### 3.3 扩展字典配置
```typescript
// 在src/utils/dict.ts中添加备件相关字典
export const DICT_TYPE = {
  // ... 现有字典
  ERP_AUDIT_STATUS = 'erp_audit_status', // ERP 审批状态
  ERP_STOCK_RECORD_BIZ_TYPE = 'erp_stock_record_biz_type', // 库存明细的业务类型
  
  // 备件管理新增字典
  SPARE_PART_TYPE = 'spare_part_type', // 备件类型
  ALERT_TYPE = 'alert_type', // 预警类型
  ALERT_LEVEL = 'alert_level', // 预警级别
  ALERT_STATUS = 'alert_status', // 预警状态
} as const;
```

#### 3.4 复用ERP现有页面
```typescript
// 直接使用ERP现有页面，添加备件特有功能：
// 1. src/views/erp/product/product/index.vue - 产品管理页面
// 2. src/views/erp/product/category/index.vue - 产品分类页面
// 3. src/views/erp/stock/stock/index.vue - 库存管理页面
// 4. src/views/erp/stock/in/index.vue - 入库管理页面
// 5. src/views/erp/stock/out/index.vue - 出库管理页面
// 6. src/views/erp/warehouse/index.vue - 仓库管理页面
```

### 第四阶段：功能测试 (1天)

#### 4.1 单元测试
```java
// 测试备件设备关联功能
// 测试库存预警功能
// 测试备件CRUD操作
```

#### 4.2 集成测试
```bash
# 测试备件管理完整流程
# 测试库存预警机制
# 测试设备关联功能
```

## 📝 测试数据

### 1. **备件分类测试数据**
```sql
-- 备件分类 (基于ERP产品分类表结构)
INSERT INTO `erp_product_category` (`id`, `parent_id`, `name`, `code`, `sort`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
(1, 0, '机械备件', 'MECHANICAL', 1, 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(2, 1, '轴承类', 'BEARING', 1, 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(3, 1, '密封件', 'SEAL', 2, 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(4, 0, '电气备件', 'ELECTRICAL', 2, 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(5, 4, '电机备件', 'MOTOR', 1, 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(6, 4, '控制备件', 'CONTROL', 2, 0, 'admin', NOW(), 'admin', NOW(), 0, 1);
```

### 2. **产品单位测试数据**
```sql
-- 产品单位 (基于ERP产品单位表结构)
INSERT INTO `erp_product_unit` (`id`, `name`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
(1, '个', 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(2, '套', 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(3, '台', 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(4, '米', 0, 'admin', NOW(), 'admin', NOW(), 0, 1),
(5, '公斤', 0, 'admin', NOW(), 'admin', NOW(), 0, 1);
```

### 3. **备件信息测试数据**
```sql
-- 备件信息 (基于ERP产品表结构，添加备件特有字段)
INSERT INTO `erp_product` (`id`, `name`, `bar_code`, `category_id`, `unit_id`, `status`, `standard`, `remark`, `expiry_day`, `weight`, `purchase_price`, `sale_price`, `min_price`, `equipment_id`, `spare_part_type`, `min_stock`, `max_stock`, `safety_stock`, `supplier_id`, `replacement_cycle`, `last_replacement_date`, `next_replacement_date`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
(1, '深沟球轴承6205', 'SP001', 2, 1, 0, '6205-2RS', '深沟球轴承，用于皮带机', 0, 0.50, 120.00, 150.00, 100.00, 1, 1, 10.00, 100.00, 20.00, 1, 365, '2024-01-01', '2025-01-01', 'admin', NOW(), 'admin', NOW(), 0, 1),
(2, 'O型密封圈', 'SP002', 3, 1, 0, 'O-50x3', 'O型密封圈，用于液压系统', 0, 0.01, 5.00, 8.00, 3.00, 2, 1, 50.00, 500.00, 100.00, 1, 180, '2024-06-01', '2024-12-01', 'admin', NOW(), 'admin', NOW(), 0, 1),
(3, '电机碳刷', 'SP003', 5, 1, 0, '25x12x8', '电机碳刷，用于电机维护', 0, 0.02, 25.00, 35.00, 20.00, 3, 2, 20.00, 200.00, 50.00, 1, 90, '2024-03-01', '2024-06-01', 'admin', NOW(), 'admin', NOW(), 0, 1);
```

### 4. **仓库测试数据**
```sql
-- 仓库信息 (基于ERP仓库表结构)
INSERT INTO `erp_warehouse` (`id`, `name`, `address`, `sort`, `remark`, `principal`, `warehouse_price`, `truckage_price`, `status`, `default_status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
(1, '主仓库', '选煤厂主仓库', 1, '主要备件仓库', '张仓库', 0.00, 0.00, 0, 1, 'admin', NOW(), 'admin', NOW(), 0, 1),
(2, '车间仓库', '车间备件仓库', 2, '车间临时仓库', '李仓库', 0.00, 0.00, 0, 0, 'admin', NOW(), 'admin', NOW(), 0, 1);
```

### 5. **库存测试数据**
```sql
-- 库存信息 (基于ERP库存表结构)
INSERT INTO `erp_stock` (`id`, `product_id`, `warehouse_id`, `count`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
(1, 1, 1, 15.00, 'admin', NOW(), 'admin', NOW(), 0, 1),
(2, 2, 1, 80.00, 'admin', NOW(), 'admin', NOW(), 0, 1),
(3, 3, 1, 25.00, 'admin', NOW(), 'admin', NOW(), 0, 1);
```

### 6. **备件设备关联测试数据**
```sql
-- 备件设备关联 (基于新增的备件设备关联表)
INSERT INTO `coal_spare_part_equipment` (`id`, `spare_part_id`, `equipment_id`, `usage_count`, `is_required`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
(1, 1, 1, 2, 1, '皮带机主轴承', 'admin', NOW(), 'admin', NOW(), 0, 1),
(2, 2, 2, 4, 1, '液压系统密封', 'admin', NOW(), 'admin', NOW(), 0, 1),
(3, 3, 3, 1, 1, '电机维护备件', 'admin', NOW(), 'admin', NOW(), 0, 1);
```

## 🔧 核心功能实现

### 1. **库存预警机制**
```java
@Component
public class SparePartAlertScheduler {
    
    @Scheduled(cron = "0 0 8 * * ?") // 每天8点检查
    public void checkStockAlerts() {
        // 1. 检查库存不足预警
        // 2. 检查库存过多预警
        // 3. 检查到期提醒
        // 4. 检查更换提醒
    }
}
```

### 2. **设备关联管理**
```java
@Service
public class CoalSparePartEquipmentServiceImpl implements CoalSparePartEquipmentService {
    
    public void createSparePartEquipment(Long sparePartId, Long equipmentId, Integer usageCount) {
        // 创建备件设备关联关系
    }
    
    public List<CoalSparePartEquipmentDO> getEquipmentSpareParts(Long equipmentId) {
        // 根据设备ID查询关联的备件列表
    }
}
```

### 3. **库存管理扩展**
```java
@Service
public class CoalSparePartStockService {
    
    public void updateStock(Long productId, Long warehouseId, BigDecimal count) {
        // 1. 更新库存数量
        // 2. 记录库存变动
        // 3. 检查预警条件
        // 4. 生成预警记录
    }
}
```

## 📊 预期效果

### 1. **功能完整性**
- ✅ 备件分类管理（树表结构）
- ✅ 备件档案管理（扩展ERP产品）
- ✅ 库存管理（复用ERP库存）
- ✅ 出入库管理（复用ERP出入库）
- ✅ 库存预警（新增功能）
- ✅ 设备关联（新增功能）

### 2. **开发效率**
- 开发时间：从2-3周缩短到1周
- 代码复用率：80%以上
- 测试工作量：减少60%

### 3. **系统稳定性**
- 基于成熟的ERP架构
- 经过大量项目验证
- 支持高并发和大数据量

## 🎯 后续扩展

### 1. **采购管理集成**
- 备件采购计划
- 供应商管理
- 采购订单管理

### 2. **财务模块集成**
- 备件成本核算
- 库存价值统计
- 采购费用管理

### 3. **移动端支持**
- 备件扫码查询
- 库存盘点
- 预警推送

## 📋 总结

### 🎯 **方案核心优势**

1. **基于实际ERP模块** - 完全基于你已加载的ERP系统，确保兼容性和稳定性
2. **最大化代码复用** - 复用80%的ERP代码，减少开发工作量
3. **完整功能覆盖** - 包含备件分类、库存管理、出入库、预警等完整功能
4. **扩展性强** - 为后续采购、财务模块奠定基础

### 📊 **实际表结构优势**

- **erp_product_category** - 树表结构，完美支持备件分类
- **erp_product** - 丰富的产品字段，只需添加备件特有字段
- **erp_stock** - 完整的库存管理功能
- **erp_stock_record** - 详细的出入库记录
- **erp_warehouse** - 多仓库管理支持

### 🚀 **实施建议**

1. **立即开始** - 按照4个阶段逐步实施
2. **先扩展数据库** - 添加备件特有字段和表
3. **复用ERP页面** - 直接使用现有ERP管理页面
4. **逐步定制** - 根据需求逐步添加备件特有功能

### ⏰ **预期效果**

- **开发时间**：从2-3周缩短到1周
- **功能完整性**：100%满足备件管理需求
- **系统稳定性**：基于成熟的ERP架构
- **后续扩展**：为采购、财务模块奠定基础

**建议立即开始实施此方案，预计1周内完成备件管理模块的开发。**
