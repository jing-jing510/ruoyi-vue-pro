# 煤质管理模块数据导入指南

## 📋 导入前准备

### 1. 数据库环境检查
- 确保MySQL数据库已启动
- 确保数据库用户有足够的权限
- 确保目标数据库已创建

### 2. 表结构检查
确保以下表已创建：
- `coal_quality_item` - 质量检测项目表
- `coal_quality_standard` - 质量标准表
- `coal_quality_inspection` - 质量检测记录表
- `coal_quality_data` - 质量检测数据表
- `coal_quality_alert` - 质量预警记录表

### 3. 字典数据检查
确保以下字典类型已配置：
- `coal_quality_item_type` - 检测项目类型
- `coal_quality_product_type` - 产品类型
- `coal_quality_product_spec` - 产品规格
- `coal_quality_sampling_method` - 采样方法
- `coal_quality_detection_type` - 检测类型
- `coal_quality_inspection_status` - 检测状态
- `coal_quality_review_status` - 审核状态
- `coal_quality_qualified` - 是否合格
- `coal_quality_recheck` - 是否复检
- `coal_quality_standard_type` - 标准类型
- `coal_quality_standard_status` - 标准状态
- `coal_quality_alert_type` - 预警类型
- `coal_quality_alert_level` - 预警级别
- `coal_quality_alert_status` - 预警状态
- `coal_quality_auto_alert` - 是否自动预警
- `coal_quality_notification_sent` - 是否已发送通知

## 🚀 数据导入步骤

### 步骤1：导入基础数据
```sql
-- 1. 导入质量检测项目数据
-- 执行 coal_quality_item 表的 INSERT 语句

-- 2. 导入质量标准数据
-- 执行 coal_quality_standard 表的 INSERT 语句
```

### 步骤2：导入业务数据
```sql
-- 3. 导入质量检测记录数据
-- 执行 coal_quality_inspection 表的 INSERT 语句

-- 4. 导入质量检测数据
-- 执行 coal_quality_data 表的 INSERT 语句

-- 5. 导入质量预警记录数据
-- 执行 coal_quality_alert 表的 INSERT 语句
```

### 步骤3：验证数据导入
```sql
-- 检查各表数据量
SELECT 'coal_quality_item' as table_name, COUNT(*) as count FROM coal_quality_item
UNION ALL
SELECT 'coal_quality_standard', COUNT(*) FROM coal_quality_standard
UNION ALL
SELECT 'coal_quality_inspection', COUNT(*) FROM coal_quality_inspection
UNION ALL
SELECT 'coal_quality_data', COUNT(*) FROM coal_quality_data
UNION ALL
SELECT 'coal_quality_alert', COUNT(*) FROM coal_quality_alert;
```

## 🔍 数据验证

### 1. 基础数据验证
```sql
-- 验证检测项目数据
SELECT * FROM coal_quality_item WHERE deleted = 0;

-- 验证质量标准数据
SELECT * FROM coal_quality_standard WHERE deleted = 0;
```

### 2. 业务数据验证
```sql
-- 验证检测记录数据
SELECT 
    inspection_code,
    inspection_date,
    inspector_name,
    product_type,
    inspection_status,
    review_status
FROM coal_quality_inspection 
WHERE deleted = 0
ORDER BY inspection_date DESC;

-- 验证检测数据
SELECT 
    qd.measured_value,
    qd.standard_value,
    qd.deviation,
    qd.is_qualified,
    qi.item_name,
    qi.inspection_code
FROM coal_quality_data qd
JOIN coal_quality_inspection qi ON qd.inspection_id = qi.id
WHERE qd.deleted = 0
ORDER BY qd.detection_time DESC;

-- 验证预警记录数据
SELECT 
    alert_code,
    alert_type,
    alert_level,
    alert_message,
    alert_status,
    handler_name
FROM coal_quality_alert 
WHERE deleted = 0
ORDER BY alert_time DESC;
```

### 3. 数据关联验证
```sql
-- 验证检测记录与检测数据的关联
SELECT 
    qi.inspection_code,
    qi.inspection_date,
    qi.inspector_name,
    COUNT(qd.id) as data_count
FROM coal_quality_inspection qi
LEFT JOIN coal_quality_data qd ON qi.id = qd.inspection_id
WHERE qi.deleted = 0
GROUP BY qi.id, qi.inspection_code, qi.inspection_date, qi.inspector_name
ORDER BY qi.inspection_date DESC;

-- 验证预警记录与检测数据的关联
SELECT 
    qa.alert_code,
    qa.alert_message,
    qi.inspection_code,
    qd.measured_value,
    qd.standard_value
FROM coal_quality_alert qa
JOIN coal_quality_inspection qi ON qa.inspection_id = qi.id
JOIN coal_quality_data qd ON qi.id = qd.inspection_id
WHERE qa.deleted = 0
ORDER BY qa.alert_time DESC;
```

## ⚠️ 注意事项

### 1. 数据冲突处理
- 如果表中已存在相同ID的数据，导入会失败
- 建议先清空表数据再导入，或修改ID值
- 注意外键约束，确保关联数据存在

### 2. 时间格式处理
- 确保数据库时区设置正确
- 注意时间格式的兼容性
- 验证时间数据的准确性

### 3. 字符编码处理
- 确保数据库字符集为utf8mb4
- 注意中文字符的正确显示
- 验证特殊字符的处理

## 🔧 常见问题解决

### 问题1：导入失败，提示主键冲突
**解决方案**：
```sql
-- 清空表数据
TRUNCATE TABLE coal_quality_alert;
TRUNCATE TABLE coal_quality_data;
TRUNCATE TABLE coal_quality_inspection;
TRUNCATE TABLE coal_quality_standard;
TRUNCATE TABLE coal_quality_item;

-- 重新导入数据
```

### 问题2：导入失败，提示外键约束错误
**解决方案**：
```sql
-- 检查关联数据是否存在
SELECT COUNT(*) FROM coal_quality_item WHERE id IN (1,2,3,4,5,6,7);
SELECT COUNT(*) FROM coal_quality_standard WHERE id IN (1,2,3,4,5,6,7,8);

-- 如果不存在，先导入基础数据
```

### 问题3：中文字符显示乱码
**解决方案**：
```sql
-- 检查数据库字符集
SHOW VARIABLES LIKE 'character_set%';

-- 设置正确的字符集
SET NAMES utf8mb4;
```

### 问题4：时间数据格式错误
**解决方案**：
```sql
-- 检查时间格式
SELECT inspection_date FROM coal_quality_inspection LIMIT 1;

-- 调整时间格式
UPDATE coal_quality_inspection 
SET inspection_date = STR_TO_DATE(inspection_date, '%Y-%m-%d %H:%i:%s')
WHERE inspection_date IS NOT NULL;
```

## 📊 导入后数据统计

### 预期数据量
- **质量检测项目**：7条
- **质量标准**：8条
- **质量检测记录**：24条
- **质量检测数据**：42条
- **质量预警记录**：7条

### 数据分布
- **正常数据**：35条（83.3%）
- **异常数据**：7条（16.7%）
- **已处理预警**：7条（100%）

## 🎯 导入完成后的操作

### 1. 功能测试
- 测试检测项目管理功能
- 测试质量标准管理功能
- 测试检测记录管理功能
- 测试预警管理功能

### 2. 数据查询测试
- 测试按时间查询
- 测试按班次查询
- 测试按产品类型查询
- 测试按系统位置查询

### 3. 业务流程测试
- 测试检测记录创建流程
- 测试检测数据录入流程
- 测试审核流程
- 测试预警处理流程

---

*按照本指南操作，可以顺利完成煤质管理模块的模拟数据导入，为系统测试和演示提供数据支持。*
