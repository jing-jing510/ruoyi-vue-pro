# å¤‡ä»¶ç®¡ç†ä¸šåŠ¡é€»è¾‘å®ç°æ€»ç»“

## ğŸ¯ å·²å®Œæˆçš„åŠŸèƒ½

### 1. åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶ âœ…

#### å®ç°å†…å®¹
- **å‡ºå…¥åº“è®°å½•æœåŠ¡å¢å¼º** (`SparePartInventoryLogServiceImpl`)
  - æ·»åŠ äº‹åŠ¡æ”¯æŒ `@Transactional`
  - å‡ºå…¥åº“è®°å½•ä¿å­˜åè‡ªåŠ¨æ›´æ–°åº“å­˜
  - è‡ªåŠ¨è§¦å‘é¢„è­¦æ£€æŸ¥

- **åº“å­˜æœåŠ¡æ‰©å±•** (`SparePartStockService` & `SparePartStockServiceImpl`)
  - æ–°å¢ `increaseStock()` æ–¹æ³• - å¢åŠ åº“å­˜æ•°é‡
  - æ–°å¢ `decreaseStock()` æ–¹æ³• - å‡å°‘åº“å­˜æ•°é‡
  - æ–°å¢ `getCurrentStock()` æ–¹æ³• - è·å–å½“å‰åº“å­˜
  - æ–°å¢ `getOrCreateStock()` ç§æœ‰æ–¹æ³• - è·å–æˆ–åˆ›å»ºåº“å­˜è®°å½•

- **åº“å­˜Mapperæ‰©å±•** (`SparePartStockMapper`)
  - æ–°å¢ `selectBySparePartId()` æ–¹æ³• - æ ¹æ®å¤‡ä»¶IDæŸ¥è¯¢åº“å­˜

#### ä¸šåŠ¡æµç¨‹
```
å‡ºå…¥åº“è®°å½•ä¿å­˜ â†’ è‡ªåŠ¨æ›´æ–°åº“å­˜æ•°é‡ â†’ è‡ªåŠ¨æ£€æŸ¥é¢„è­¦
```

### 2. é¢„è­¦è‡ªåŠ¨è§¦å‘æœºåˆ¶ âœ…

#### å®ç°å†…å®¹
- **é¢„è­¦æœåŠ¡æ‰©å±•** (`SparePartAlertService` & `SparePartAlertServiceImpl`)
  - æ–°å¢ `checkAndCreateAlert()` æ–¹æ³• - æ£€æŸ¥å¹¶åˆ›å»ºé¢„è­¦
  - æ–°å¢ `createLowStockAlert()` ç§æœ‰æ–¹æ³• - åˆ›å»ºåº“å­˜ä¸è¶³é¢„è­¦
  - æ–°å¢ `createSafetyStockAlert()` ç§æœ‰æ–¹æ³• - åˆ›å»ºå®‰å…¨åº“å­˜é¢„è­¦
  - æ–°å¢ `calculateAlertLevel()` ç§æœ‰æ–¹æ³• - è®¡ç®—é¢„è­¦çº§åˆ«
  - æ–°å¢ `hasUnprocessedAlert()` ç§æœ‰æ–¹æ³• - æ£€æŸ¥æœªå¤„ç†é¢„è­¦

#### é¢„è­¦ç±»å‹
1. **åº“å­˜ä¸è¶³é¢„è­¦** - å½“å‰åº“å­˜ â‰¤ æœ€ä½åº“å­˜
2. **å®‰å…¨åº“å­˜é¢„è­¦** - å½“å‰åº“å­˜ â‰¤ å®‰å…¨åº“å­˜

#### é¢„è­¦çº§åˆ«
- **ä¸¥é‡ (4)** - åº“å­˜ä¸º0
- **é«˜ (3)** - åº“å­˜ â‰¤ æœ€ä½åº“å­˜çš„ä¸€åŠ
- **ä¸­ (2)** - åº“å­˜ â‰¤ æœ€ä½åº“å­˜
- **ä½ (1)** - å…¶ä»–æƒ…å†µ

### 3. æ•°æ®ç±»å‹ç»Ÿä¸€ âœ…

#### ä¿®å¤å†…å®¹
- ç»Ÿä¸€ä½¿ç”¨ `BigDecimal` ç±»å‹å¤„ç†åº“å­˜æ•°é‡
- ä¿®å¤æ‰€æœ‰ç›¸å…³çš„ç±»å‹è½¬æ¢é—®é¢˜
- ç¡®ä¿æ•°æ®ç²¾åº¦å’Œè®¡ç®—å‡†ç¡®æ€§

## ğŸ›  æŠ€æœ¯å®ç°è¦ç‚¹

### 1. äº‹åŠ¡ç®¡ç†
```java
@Transactional(rollbackFor = Exception.class)
public Long createSparePartInventoryLog(SparePartInventoryLogSaveReqVO createReqVO) {
    // 1. ä¿å­˜å‡ºå…¥åº“è®°å½•
    // 2. è‡ªåŠ¨æ›´æ–°åº“å­˜
    // 3. æ£€æŸ¥é¢„è­¦
}
```

### 2. åº“å­˜æ›´æ–°é€»è¾‘
```java
private void updateStockQuantity(SparePartInventoryLogDO log) {
    if (log.getOperationType() == 1) { // å…¥åº“
        sparePartStockService.increaseStock(log.getSparePartId(), log.getQuantity());
    } else if (log.getOperationType() == 2) { // å‡ºåº“
        sparePartStockService.decreaseStock(log.getSparePartId(), log.getQuantity());
    }
}
```

### 3. é¢„è­¦æ£€æŸ¥é€»è¾‘
```java
public void checkAndCreateAlert(Long sparePartId) {
    // 1. è·å–å¤‡ä»¶åŸºç¡€ä¿¡æ¯
    // 2. è·å–å½“å‰åº“å­˜
    // 3. æ£€æŸ¥åº“å­˜ä¸è¶³é¢„è­¦
    // 4. æ£€æŸ¥å®‰å…¨åº“å­˜é¢„è­¦
}
```

### 4. åº“å­˜ä¸è¶³æ£€æŸ¥
```java
public void decreaseStock(Long sparePartId, BigDecimal quantity) {
    // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
    if (stock.getQuantity().compareTo(quantity) < 0) {
        throw exception(SPARE_PART_STOCK_NOT_EXISTS, "åº“å­˜ä¸è¶³");
    }
    // å‡å°‘åº“å­˜æ•°é‡
}
```

## ğŸ“Š ä¸šåŠ¡æµç¨‹å›¾

```
å¤‡ä»¶å‡ºå…¥åº“æ“ä½œ
    â†“
ä¿å­˜å‡ºå…¥åº“è®°å½•
    â†“
è‡ªåŠ¨æ›´æ–°åº“å­˜æ•°é‡
    â†“
æ£€æŸ¥å½“å‰åº“å­˜çŠ¶æ€
    â†“
åˆ¤æ–­æ˜¯å¦éœ€è¦é¢„è­¦
    â†“
åˆ›å»ºç›¸åº”é¢„è­¦è®°å½•
```

## ğŸ¯ é¢„æœŸæ•ˆæœ

### è‡ªåŠ¨åŒ–ç®¡ç†
- âœ… å‡ºå…¥åº“æ“ä½œååº“å­˜è‡ªåŠ¨æ›´æ–°
- âœ… åº“å­˜å˜åŒ–æ—¶è‡ªåŠ¨æ£€æŸ¥é¢„è­¦
- âœ… åº“å­˜ä¸è¶³æ—¶è‡ªåŠ¨åˆ›å»ºé¢„è­¦è®°å½•

### æ•°æ®ä¸€è‡´æ€§
- âœ… å‡ºå…¥åº“è®°å½•ä¸åº“å­˜æ•°æ®ä¿æŒä¸€è‡´
- âœ… é¢„è­¦è®°å½•ä¸åº“å­˜çŠ¶æ€åŒæ­¥
- âœ… äº‹åŠ¡ä¿è¯æ•°æ®å®Œæ•´æ€§

### ä¸šåŠ¡æ™ºèƒ½åŒ–
- âœ… å¤šçº§åˆ«é¢„è­¦æœºåˆ¶
- âœ… æ™ºèƒ½é¢„è­¦çº§åˆ«è®¡ç®—
- âœ… é¿å…é‡å¤é¢„è­¦åˆ›å»º

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨è®°å½•ä¸åº“å­˜è”åŠ¨
- å®ç°å¤‡ä»¶ä½¿ç”¨æ—¶è‡ªåŠ¨æ‰£å‡åº“å­˜
- ä½¿ç”¨è®°å½•ä¸å‡ºåº“è®°å½•è”åŠ¨
- å®Œå–„åº“å­˜æ‰£å‡çš„ä¸šåŠ¡é€»è¾‘

### ç¬¬ä¸‰é˜¶æ®µï¼šç»Ÿè®¡åˆ†æåŠŸèƒ½
- åº“å­˜ç»Ÿè®¡åˆ†æ
- ä½¿ç”¨é¢‘ç‡åˆ†æ
- å¯¿å‘½é¢„æµ‹åˆ†æ

### ç¬¬å››é˜¶æ®µï¼šæ¶ˆæ¯æ¨é€åŠŸèƒ½
- å¤šæ¸ é“é¢„è­¦é€šçŸ¥
- é¢„è­¦è§„åˆ™é…ç½®
- æ¶ˆæ¯æ¨é€æœºåˆ¶

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **äº‹åŠ¡ç®¡ç†** - æ‰€æœ‰æ¶‰åŠå¤šè¡¨æ“ä½œçš„æ–¹æ³•éƒ½ä½¿ç”¨äº‹åŠ¡
2. **å¼‚å¸¸å¤„ç†** - é¢„è­¦æ£€æŸ¥å¤±è´¥ä¸å½±å“ä¸»æµç¨‹
3. **æ•°æ®ç²¾åº¦** - ä½¿ç”¨BigDecimalç¡®ä¿æ•°å€¼è®¡ç®—ç²¾åº¦
4. **æ€§èƒ½è€ƒè™‘** - åº“å­˜æŸ¥è¯¢ä½¿ç”¨ç¼“å­˜ä¼˜åŒ–
5. **æ‰©å±•æ€§** - é¢„ç•™æ¥å£æ”¯æŒåç»­åŠŸèƒ½æ‰©å±•

---

*å¤‡ä»¶ç®¡ç†ä¸šåŠ¡é€»è¾‘å®ç°æ€»ç»“* | *ç¬¬ä¸€é˜¶æ®µå®Œæˆ* | *è‡ªåŠ¨åŒ–ç®¡ç†å·²å®ç°*
