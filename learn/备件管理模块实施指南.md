# 备件管理模块实施指南

## 🚀 快速开始

### 第一步：执行数据库脚本

```bash
# 进入MySQL命令行
mysql -u root -p ruoyi-vue-pro

# 执行完整安装脚本
source sql/mysql/execute_spare_part_setup.sql;
```

或者分别执行：

```bash
# 1. 数据库扩展
mysql -u root -p ruoyi-vue-pro < sql/mysql/spare_part_db_extend.sql

# 2. 字典配置
mysql -u root -p ruoyi-vue-pro < sql/mysql/spare_part_dict_data.sql

# 3. 测试数据
mysql -u root -p ruoyi-vue-pro < sql/mysql/spare_part_test_data.sql
```

### 第二步：重启后端服务

```bash
# 重启Spring Boot应用
# 让新的实体类和Service生效
```

### 第三步：验证安装

1. **检查数据库表结构**
   ```sql
   DESCRIBE erp_product;
   SHOW TABLES LIKE 'coal_spare_part%';
   ```

2. **检查字典数据**
   ```sql
   SELECT * FROM system_dict_type WHERE type LIKE '%spare_part%' OR type LIKE '%alert%';
   ```

3. **检查测试数据**
   ```sql
   SELECT COUNT(*) FROM erp_product WHERE spare_part_type IS NOT NULL;
   SELECT COUNT(*) FROM coal_spare_part_equipment;
   SELECT COUNT(*) FROM coal_spare_part_alert;
   ```

## 📋 已完成的开发内容

### ✅ 数据库扩展
- 扩展 `erp_product` 表，添加8个备件特有字段
- 创建 `coal_spare_part_equipment` 备件设备关联表
- 创建 `coal_spare_part_alert` 备件预警记录表

### ✅ 字典配置
- 添加备件类型字典 (`spare_part_type`)
- 添加预警类型字典 (`alert_type`)
- 添加预警级别字典 (`alert_level`)
- 添加预警状态字典 (`alert_status`)
- 更新前端字典配置文件

### ✅ 后端代码
- 扩展 `ErpProductDO` 实体类，添加备件字段
- 创建 `CoalSparePartEquipmentDO` 备件设备关联实体
- 创建 `CoalSparePartAlertDO` 备件预警记录实体
- 创建对应的 Mapper 接口
- 创建 Service 接口和实现类
- 添加错误码常量

### ✅ 测试数据
- 备件分类测试数据
- 产品单位测试数据
- 仓库测试数据
- 备件信息测试数据
- 库存测试数据
- 备件设备关联测试数据
- 备件预警测试数据

## 🎯 下一步开发计划

### 第四阶段：前端页面扩展
- 扩展ERP产品管理页面，添加备件特有功能
- 创建备件管理专用页面
- 添加设备关联组件
- 添加库存预警组件

### 第五阶段：功能完善
- 实现库存预警定时检查
- 实现更换提醒功能
- 完善备件管理业务流程

## 🔧 核心功能说明

### 1. 备件管理
- 基于ERP产品表扩展，复用80%现有功能
- 支持备件分类、单位、仓库管理
- 支持备件与设备关联
- 支持库存预警机制

### 2. 库存管理
- 复用ERP库存管理功能
- 支持多仓库管理
- 支持出入库记录
- 支持库存预警

### 3. 预警机制
- 库存不足预警
- 库存过多预警
- 到期提醒
- 更换提醒
- 定时检查任务

## 📊 数据关系图

```
erp_product (产品表)
├── equipment_id (关联设备)
├── spare_part_type (备件类型)
├── min_stock (最低库存)
├── max_stock (最高库存)
├── safety_stock (安全库存)
└── replacement_cycle (更换周期)

coal_spare_part_equipment (备件设备关联)
├── spare_part_id (备件ID)
├── equipment_id (设备ID)
├── usage_count (使用数量)
└── is_required (是否必需)

coal_spare_part_alert (备件预警)
├── spare_part_id (备件ID)
├── warehouse_id (仓库ID)
├── alert_type (预警类型)
├── current_stock (当前库存)
└── threshold_value (阈值)
```

## 🎉 安装完成后的效果

1. **ERP产品管理页面** - 可以看到备件特有字段
2. **备件分类管理** - 可以管理备件分类
3. **库存管理** - 可以管理备件库存
4. **预警功能** - 可以查看和处理预警
5. **设备关联** - 可以管理备件与设备的关联关系

## 📞 技术支持

如果在安装过程中遇到问题，请检查：
1. 数据库连接是否正常
2. SQL脚本是否完整执行
3. 后端服务是否重启
4. 字典数据是否正确导入

**恭喜！备件管理模块基础架构已完成，可以开始使用和进一步开发了！** 🎉
