# å¤‡ä»¶ç®¡ç†æ¨¡å—æŠ€æœ¯å®ç°æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶](#åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶)
2. [é¢„è­¦è‡ªåŠ¨è§¦å‘æœºåˆ¶](#é¢„è­¦è‡ªåŠ¨è§¦å‘æœºåˆ¶)
3. [åº“å­˜ç»Ÿè®¡åˆ†æåŠŸèƒ½](#åº“å­˜ç»Ÿè®¡åˆ†æåŠŸèƒ½)
4. [é¦–é¡µç»Ÿè®¡å¡ç‰‡å®ç°](#é¦–é¡µç»Ÿè®¡å¡ç‰‡å®ç°)
5. [æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°](#æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°)
6. [æ•°æ®å…³è”å¤„ç†](#æ•°æ®å…³è”å¤„ç†)

## ğŸ”„ åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶

### 1.1 æœºåˆ¶æ¦‚è¿°
åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶æ˜¯å¤‡ä»¶ç®¡ç†æ¨¡å—çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç¡®ä¿å‡ºå…¥åº“æ“ä½œååº“å­˜æ•°æ®å®æ—¶å‡†ç¡®ã€‚

### 1.2 å®ç°åŸç†
```mermaid
graph TD
    A[å‡ºå…¥åº“æ“ä½œ] --> B[åˆ›å»ºå‡ºå…¥åº“è®°å½•]
    B --> C[è°ƒç”¨åº“å­˜æ›´æ–°æœåŠ¡]
    C --> D{åˆ¤æ–­æ“ä½œç±»å‹}
    D -->|å…¥åº“| E[å¢åŠ åº“å­˜]
    D -->|å‡ºåº“| F[å‡å°‘åº“å­˜]
    E --> G[æ›´æ–°æœ€åå…¥åº“æ—¶é—´]
    F --> H[æ›´æ–°æœ€åå‡ºåº“æ—¶é—´]
    G --> I[æ£€æŸ¥é¢„è­¦æ¡ä»¶]
    H --> I
    I --> J[è§¦å‘é¢„è­¦æœºåˆ¶]
```

### 1.3 æ ¸å¿ƒä»£ç å®ç°

#### 1.3.1 å‡ºå…¥åº“è®°å½•æœåŠ¡
```java
@Service
@Validated
public class SparePartInventoryLogServiceImpl implements SparePartInventoryLogService {

    @Resource
    private SparePartStockService sparePartStockService;
    
    @Resource
    private SparePartAlertService sparePartAlertService;

    @Override
    @Transactional(rollbackFor = Exception.class)
    public Long createSparePartInventoryLog(SparePartInventoryLogSaveReqVO createReqVO) {
        // 1. åˆ›å»ºå‡ºå…¥åº“è®°å½•
        SparePartInventoryLogDO inventoryLog = BeanUtils.toBean(createReqVO, SparePartInventoryLogDO.class);
        sparePartInventoryLogMapper.insert(inventoryLog);
        
        // 2. è‡ªåŠ¨æ›´æ–°åº“å­˜
        updateStockQuantity(inventoryLog);
        
        // 3. æ£€æŸ¥å¹¶åˆ›å»ºé¢„è­¦
        checkAndCreateAlert(inventoryLog.getSparePartId());
        
        return inventoryLog.getId();
    }

    /**
     * æ›´æ–°åº“å­˜æ•°é‡
     */
    private void updateStockQuantity(SparePartInventoryLogDO log) {
        if (log.getQuantity().compareTo(BigDecimal.ZERO) > 0) {
            // å…¥åº“æ“ä½œ - å¢åŠ åº“å­˜
            sparePartStockService.increaseStock(log.getSparePartId(), log.getQuantity());
        } else {
            // å‡ºåº“æ“ä½œ - å‡å°‘åº“å­˜
            sparePartStockService.decreaseStock(log.getSparePartId(), log.getQuantity().abs());
        }
    }

    /**
     * æ£€æŸ¥å¹¶åˆ›å»ºé¢„è­¦
     */
    private void checkAndCreateAlert(Long sparePartId) {
        try {
            sparePartAlertService.checkAndCreateAlert(sparePartId);
        } catch (Exception e) {
            // é¢„è­¦åˆ›å»ºå¤±è´¥ä¸å½±å“ä¸»æµç¨‹
            log.error("åˆ›å»ºé¢„è­¦å¤±è´¥ï¼Œå¤‡ä»¶ID: {}", sparePartId, e);
        }
    }
}
```

#### 1.3.2 åº“å­˜æœåŠ¡å®ç°
```java
@Service
@Validated
public class SparePartStockServiceImpl implements SparePartStockService {

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void increaseStock(Long sparePartId, BigDecimal quantity) {
        // æŸ¥æ‰¾æˆ–åˆ›å»ºåº“å­˜è®°å½•
        SparePartStockDO stock = getOrCreateStock(sparePartId);
        
        // å¢åŠ åº“å­˜æ•°é‡
        stock.setQuantity(stock.getQuantity().add(quantity));
        
        // æ›´æ–°æœ€åå…¥åº“æ—¶é—´
        stock.setLastInDate(LocalDateTime.now());
        
        // æ›´æ–°åº“å­˜è®°å½•
        sparePartStockMapper.updateById(stock);
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public void decreaseStock(Long sparePartId, BigDecimal quantity) {
        // æŸ¥æ‰¾åº“å­˜è®°å½•
        SparePartStockDO stock = getOrCreateStock(sparePartId);
        
        // æ£€æŸ¥åº“å­˜æ˜¯å¦å……è¶³
        if (stock.getQuantity().compareTo(quantity) < 0) {
            throw exception(SPARE_PART_STOCK_NOT_EXISTS, "åº“å­˜ä¸è¶³ï¼Œå½“å‰åº“å­˜ï¼š" + stock.getQuantity() + "ï¼Œéœ€è¦æ•°é‡ï¼š" + quantity);
        }
        
        // å‡å°‘åº“å­˜æ•°é‡
        stock.setQuantity(stock.getQuantity().subtract(quantity));
        
        // æ›´æ–°æœ€åå‡ºåº“æ—¶é—´
        stock.setLastOutDate(LocalDateTime.now());
        
        // æ›´æ–°åº“å­˜è®°å½•
        sparePartStockMapper.updateById(stock);
    }

    /**
     * è·å–æˆ–åˆ›å»ºåº“å­˜è®°å½•
     */
    private SparePartStockDO getOrCreateStock(Long sparePartId) {
        // æŸ¥æ‰¾ç°æœ‰åº“å­˜è®°å½•
        SparePartStockDO stock = sparePartStockMapper.selectBySparePartId(sparePartId);
        
        if (stock == null) {
            // åˆ›å»ºæ–°çš„åº“å­˜è®°å½•
            stock = new SparePartStockDO();
            stock.setSparePartId(sparePartId);
            stock.setQuantity(BigDecimal.ZERO);
            stock.setStockType(1); // é»˜è®¤åº“å­˜ç±»å‹
            stock.setWarehouseLocation("é»˜è®¤ä»“åº“"); // è®¾ç½®é»˜è®¤ä»“åº“ä½ç½®
            stock.setUnitCost(BigDecimal.ZERO); // è®¾ç½®é»˜è®¤å•ä½æˆæœ¬
            stock.setTotalCost(BigDecimal.ZERO); // è®¾ç½®é»˜è®¤æ€»æˆæœ¬
            sparePartStockMapper.insert(stock);
        }
        
        return stock;
    }
}
```

### 1.4 å…³é”®ç‰¹æ€§
- **äº‹åŠ¡ä¿è¯**: ä½¿ç”¨ `@Transactional` ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **è‡ªåŠ¨åˆ›å»º**: åº“å­˜è®°å½•ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º
- **æ—¶é—´è®°å½•**: è‡ªåŠ¨æ›´æ–°æœ€åå‡ºå…¥åº“æ—¶é—´
- **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

## âš ï¸ é¢„è­¦è‡ªåŠ¨è§¦å‘æœºåˆ¶

### 2.1 æœºåˆ¶æ¦‚è¿°
é¢„è­¦è‡ªåŠ¨è§¦å‘æœºåˆ¶åœ¨åº“å­˜å˜åŒ–æ—¶è‡ªåŠ¨æ£€æŸ¥é¢„è­¦æ¡ä»¶ï¼Œç¡®ä¿åŠæ—¶å‘ç°é—®é¢˜ã€‚

### 2.2 é¢„è­¦ç±»å‹
- **é›¶åº“å­˜é¢„è­¦**: åº“å­˜ä¸º0æ—¶è§¦å‘
- **ä½åº“å­˜é¢„è­¦**: åº“å­˜ä½äºæœ€å°åº“å­˜æ—¶è§¦å‘
- **è¶…é‡åº“å­˜é¢„è­¦**: åº“å­˜è¶…è¿‡æœ€å¤§åº“å­˜æ—¶è§¦å‘

### 2.3 å®ç°ä»£ç 
```java
@Service
@Validated
public class SparePartAlertServiceImpl implements SparePartAlertService {

    @Resource
    private SparePartInfoService sparePartInfoService;
    
    @Resource
    private SparePartStockService sparePartStockService;

    @Override
    public void checkAndCreateAlert(Long sparePartId) {
        try {
            // è·å–å¤‡ä»¶ä¿¡æ¯
            SparePartInfoDO sparePart = sparePartInfoService.getSparePartInfo(sparePartId);
            if (sparePart == null) {
                return;
            }
            
            // è·å–å½“å‰åº“å­˜
            BigDecimal currentStock = sparePartStockService.getCurrentStock(sparePartId);
            if (currentStock == null) {
                currentStock = BigDecimal.ZERO;
            }
            
            // æ£€æŸ¥é›¶åº“å­˜é¢„è­¦
            if (currentStock.compareTo(BigDecimal.ZERO) == 0) {
                createAlert(sparePartId, 2, 3, currentStock, BigDecimal.ZERO, "é›¶åº“å­˜é¢„è­¦");
            }
            // æ£€æŸ¥ä½åº“å­˜é¢„è­¦
            else if (sparePart.getMinStock() != null && 
                     currentStock.compareTo(sparePart.getMinStock()) <= 0) {
                createAlert(sparePartId, 1, 2, currentStock, sparePart.getMinStock(), "ä½åº“å­˜é¢„è­¦");
            }
            // æ£€æŸ¥è¶…é‡åº“å­˜é¢„è­¦
            else if (sparePart.getMaxStock() != null && 
                     currentStock.compareTo(sparePart.getMaxStock()) > 0) {
                createAlert(sparePartId, 3, 1, currentStock, sparePart.getMaxStock(), "è¶…é‡åº“å­˜é¢„è­¦");
            }
            
        } catch (Exception e) {
            log.error("æ£€æŸ¥é¢„è­¦æ¡ä»¶å¤±è´¥ï¼Œå¤‡ä»¶ID: {}", sparePartId, e);
        }
    }

    /**
     * åˆ›å»ºé¢„è­¦è®°å½•
     */
    private void createAlert(Long sparePartId, Integer alertType, Integer alertLevel, 
                           BigDecimal currentStock, BigDecimal thresholdValue, String alertMessage) {
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç±»å‹çš„æœªå¤„ç†é¢„è­¦
        SparePartAlertDO existingAlert = sparePartAlertMapper.selectBySparePartIdAndType(sparePartId, alertType);
        if (existingAlert != null && existingAlert.getStatus() == 0) {
            return; // å·²å­˜åœ¨æœªå¤„ç†é¢„è­¦ï¼Œä¸é‡å¤åˆ›å»º
        }
        
        // åˆ›å»ºæ–°é¢„è­¦è®°å½•
        SparePartAlertDO alert = new SparePartAlertDO();
        alert.setSparePartId(sparePartId);
        alert.setAlertType(alertType);
        alert.setAlertLevel(alertLevel);
        alert.setCurrentStock(currentStock);
        alert.setThresholdValue(thresholdValue);
        alert.setAlertMessage(alertMessage);
        alert.setAlertTime(LocalDateTime.now());
        alert.setStatus(0); // æœªå¤„ç†
        
        sparePartAlertMapper.insert(alert);
        
        // å‘é€é¢„è­¦é€šçŸ¥ï¼ˆå¯æ‰©å±•ï¼‰
        sendAlertNotification(alert);
    }

    /**
     * å‘é€é¢„è­¦é€šçŸ¥
     */
    private void sendAlertNotification(SparePartAlertDO alert) {
        // TODO: å®ç°é¢„è­¦é€šçŸ¥é€»è¾‘
        // å¯ä»¥å‘é€é‚®ä»¶ã€çŸ­ä¿¡ã€ç³»ç»Ÿæ¶ˆæ¯ç­‰
        log.info("å‘é€é¢„è­¦é€šçŸ¥: {}", alert.getAlertMessage());
    }
}
```

### 2.4 é¢„è­¦é…ç½®
- **é¢„è­¦çº§åˆ«**: 1-ä½ï¼Œ2-ä¸­ï¼Œ3-é«˜
- **å¤„ç†çŠ¶æ€**: 0-æœªå¤„ç†ï¼Œ1-å·²å¤„ç†
- **é€šçŸ¥æœºåˆ¶**: æ”¯æŒå¤šç§é€šçŸ¥æ–¹å¼

## ğŸ“Š åº“å­˜ç»Ÿè®¡åˆ†æåŠŸèƒ½

### 3.1 åŠŸèƒ½æ¦‚è¿°
åº“å­˜ç»Ÿè®¡åˆ†æåŠŸèƒ½æä¾›å¤šç»´åº¦ã€å¯è§†åŒ–çš„åº“å­˜æ•°æ®åˆ†æã€‚

### 3.2 ç»Ÿè®¡ç»´åº¦
- **åº“å­˜æ¦‚è§ˆ**: æ€»ä½“åº“å­˜æƒ…å†µ
- **é¢„è­¦ç»Ÿè®¡**: å„ç±»é¢„è­¦æ•°é‡ç»Ÿè®¡
- **åˆ†ç±»ç»Ÿè®¡**: æŒ‰åˆ†ç±»ç»Ÿè®¡åº“å­˜
- **è¶‹åŠ¿åˆ†æ**: åº“å­˜å˜åŒ–è¶‹åŠ¿
- **ABCåˆ†æ**: å¤‡ä»¶é‡è¦æ€§åˆ†æ

### 3.3 å®ç°ä»£ç 
```java
@Service
@Validated
public class SparePartInfoServiceImpl implements SparePartInfoService {

    @Resource
    private SparePartStockService sparePartStockService;
    
    @Resource
    private SparePartCategoryService sparePartCategoryService;

    @Override
    public SparePartStockStatisticsRespVO getStockStatistics() {
        SparePartStockStatisticsRespVO statistics = new SparePartStockStatisticsRespVO();
        List<SparePartInfoDO> allSpareParts = sparePartInfoMapper.selectList();
        
        // è®¡ç®—å„é¡¹ç»Ÿè®¡
        statistics.setOverview(calculateStockOverview(allSpareParts));
        statistics.setAlertStatistics(calculateAlertStatistics(allSpareParts));
        statistics.setCategoryStatistics(calculateCategoryStatistics(allSpareParts));
        statistics.setTrendData(calculateTrendData());
        statistics.setAbcStatistics(calculateABCStatistics(allSpareParts));
        
        return statistics;
    }

    /**
     * è®¡ç®—åº“å­˜æ¦‚è§ˆ
     */
    private SparePartStockStatisticsRespVO.StockOverview calculateStockOverview(List<SparePartInfoDO> spareParts) {
        SparePartStockStatisticsRespVO.StockOverview overview = new SparePartStockStatisticsRespVO.StockOverview();
        
        overview.setTotalSparePartTypes(spareParts.size());
        
        BigDecimal totalQuantity = BigDecimal.ZERO;
        BigDecimal totalValue = BigDecimal.ZERO;
        int healthyCount = 0;
        
        for (SparePartInfoDO sparePart : spareParts) {
            try {
                BigDecimal currentStock = sparePartStockService.getCurrentStock(sparePart.getId());
                if (currentStock != null) {
                    totalQuantity = totalQuantity.add(currentStock);
                }
                
                if (sparePart.getUnitPrice() != null && currentStock != null) {
                    BigDecimal stockValue = currentStock.multiply(sparePart.getUnitPrice());
                    totalValue = totalValue.add(stockValue);
                }
                
                // åˆ¤æ–­åº“å­˜å¥åº·åº¦
                if (currentStock != null && sparePart.getMinStock() != null && sparePart.getMaxStock() != null) {
                    if (currentStock.compareTo(sparePart.getMinStock()) > 0 && 
                        currentStock.compareTo(sparePart.getMaxStock()) <= 0) {
                        healthyCount++;
                    }
                }
            } catch (Exception e) {
                log.error("å¤„ç†å¤‡ä»¶ {} æ—¶å‘ç”Ÿå¼‚å¸¸: {}", sparePart.getId(), e.getMessage());
            }
        }
        
        overview.setTotalStockQuantity(totalQuantity);
        overview.setTotalStockValue(totalValue);
        overview.setAverageTurnoverRate(BigDecimal.ZERO); // TODO: è®¡ç®—å‘¨è½¬ç‡
        overview.setHealthScore(healthyCount * 100 / spareParts.size());
        
        return overview;
    }

    /**
     * è®¡ç®—é¢„è­¦ç»Ÿè®¡
     */
    private SparePartStockStatisticsRespVO.AlertStatistics calculateAlertStatistics(List<SparePartInfoDO> spareParts) {
        SparePartStockStatisticsRespVO.AlertStatistics alertStats = new SparePartStockStatisticsRespVO.AlertStatistics();
        
        int lowStockCount = 0;
        int zeroStockCount = 0;
        int overStockCount = 0;
        int stagnantStockCount = 0;
        
        for (SparePartInfoDO sparePart : spareParts) {
            try {
                BigDecimal currentStock = sparePartStockService.getCurrentStock(sparePart.getId());
                if (currentStock == null) {
                    currentStock = BigDecimal.ZERO;
                }
                
                if (currentStock.compareTo(BigDecimal.ZERO) == 0) {
                    zeroStockCount++;
                } else if (sparePart.getMinStock() != null && 
                          currentStock.compareTo(sparePart.getMinStock()) <= 0) {
                    lowStockCount++;
                } else if (sparePart.getMaxStock() != null && 
                          currentStock.compareTo(sparePart.getMaxStock()) > 0) {
                    overStockCount++;
                }
                
                // TODO: è®¡ç®—å‘†æ»åº“å­˜
            } catch (Exception e) {
                log.error("å¤„ç†å¤‡ä»¶ {} é¢„è­¦ç»Ÿè®¡æ—¶å‘ç”Ÿå¼‚å¸¸: {}", sparePart.getId(), e.getMessage());
            }
        }
        
        alertStats.setLowStockCount(lowStockCount);
        alertStats.setZeroStockCount(zeroStockCount);
        alertStats.setOverStockCount(overStockCount);
        alertStats.setStagnantStockCount(stagnantStockCount);
        
        return alertStats;
    }
}
```

### 3.4 å‰ç«¯å±•ç¤º
```vue
<template>
  <div class="statistics-container">
    <!-- åº“å­˜æ¦‚è§ˆ -->
    <el-row :gutter="20">
      <el-col :span="6">
        <el-card>
          <div class="stat-item">
            <div class="stat-value">{{ statistics.overview.totalSparePartTypes }}</div>
            <div class="stat-label">å¤‡ä»¶ç§ç±»</div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card>
          <div class="stat-item">
            <div class="stat-value">{{ formatNumber(statistics.overview.totalStockQuantity) }}</div>
            <div class="stat-label">æ€»åº“å­˜</div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card>
          <div class="stat-item">
            <div class="stat-value">{{ statistics.alertStatistics.zeroStockCount }}</div>
            <div class="stat-label">é›¶åº“å­˜</div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card>
          <div class="stat-item">
            <div class="stat-value">{{ statistics.alertStatistics.lowStockCount }}</div>
            <div class="stat-label">ä½åº“å­˜</div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- å›¾è¡¨å±•ç¤º -->
    <el-row :gutter="20" class="mt-4">
      <el-col :span="12">
        <el-card title="åˆ†ç±»ç»Ÿè®¡">
          <div ref="categoryChart" style="height: 300px;"></div>
        </el-card>
      </el-col>
      <el-col :span="12">
        <el-card title="è¶‹åŠ¿åˆ†æ">
          <div ref="trendChart" style="height: 300px;"></div>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>
```

## ğŸ  é¦–é¡µç»Ÿè®¡å¡ç‰‡å®ç°

### 4.1 åŠŸèƒ½æ¦‚è¿°
é¦–é¡µç»Ÿè®¡å¡ç‰‡æä¾›å¤‡ä»¶åº“å­˜çš„å¿«é€Ÿæ¦‚è§ˆï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿäº†è§£åº“å­˜çŠ¶å†µã€‚

### 4.2 å®ç°ä»£ç 
```vue
<template>
  <!-- å¤‡ä»¶åº“å­˜ç»Ÿè®¡å¡ç‰‡ -->
  <el-card shadow="never" class="mt-8px">
    <template #header>
      <div class="h-3 flex justify-between">
        <span>å¤‡ä»¶åº“å­˜ç»Ÿè®¡</span>
        <el-button type="text" size="small" @click="getSparePartStatistics" :loading="sparePartLoading">
          åˆ·æ–°
        </el-button>
      </div>
    </template>
    <el-skeleton :loading="sparePartLoading" animated>
      <div v-if="sparePartStats">
        <el-row :gutter="12">
          <el-col :span="12">
            <div class="text-center p-3 bg-blue-50 rounded-lg">
              <div class="text-20px font-bold text-blue-600">{{ sparePartStats.overview?.totalSparePartTypes || 0 }}</div>
              <div class="text-12px text-gray-500 mt-1">å¤‡ä»¶ç§ç±»</div>
            </div>
          </el-col>
          <el-col :span="12">
            <div class="text-center p-3 bg-green-50 rounded-lg">
              <div class="text-20px font-bold text-green-600">{{ formatNumber(sparePartStats.overview?.totalStockQuantity) }}</div>
              <div class="text-12px text-gray-500 mt-1">æ€»åº“å­˜</div>
            </div>
          </el-col>
        </el-row>
        <el-row :gutter="12" class="mt-3">
          <el-col :span="12">
            <div class="text-center p-3 bg-orange-50 rounded-lg">
              <div class="text-20px font-bold text-orange-600">{{ sparePartStats.alertStatistics?.zeroStockCount || 0 }}</div>
              <div class="text-12px text-gray-500 mt-1">é›¶åº“å­˜</div>
            </div>
          </el-col>
          <el-col :span="12">
            <div class="text-center p-3 bg-red-50 rounded-lg">
              <div class="text-20px font-bold text-red-600">{{ sparePartStats.alertStatistics?.lowStockCount || 0 }}</div>
              <div class="text-12px text-gray-500 mt-1">ä½åº“å­˜</div>
            </div>
          </el-col>
        </el-row>
        <div class="mt-3 text-center">
          <div class="text-14px text-gray-600">åº“å­˜å¥åº·åº¦</div>
          <div class="text-24px font-bold" :class="getHealthScoreColor(sparePartStats.overview?.healthScore)">
            {{ sparePartStats.overview?.healthScore || 0 }}%
          </div>
        </div>
      </div>
      <div v-else class="text-center text-gray-400 py-8">
        æš‚æ— ç»Ÿè®¡æ•°æ®
      </div>
    </el-skeleton>
  </el-card>
</template>

<script setup lang="ts">
import { SparePartInfoApi } from '@/api/coal/sparepartinfo'

const sparePartLoading = ref(false)
const sparePartStats = ref<any>(null)

// è·å–å¤‡ä»¶ç»Ÿè®¡æ•°æ®
const getSparePartStatistics = async () => {
  try {
    sparePartLoading.value = true
    console.log('å¼€å§‹è·å–å¤‡ä»¶ç»Ÿè®¡æ•°æ®...')
    const response = await SparePartInfoApi.getStockStatistics()
    console.log('å¤‡ä»¶ç»Ÿè®¡æ•°æ®å®Œæ•´å“åº”:', response)
    console.log('å“åº”ç±»å‹:', typeof response)
    console.log('å“åº”ç»“æ„:', Object.keys(response))
    
    // æ£€æŸ¥å“åº”ç»“æ„
    if (response && response.data) {
      console.log('response.data å­˜åœ¨:', response.data)
      sparePartStats.value = response.data
    } else if (response && response.overview) {
      console.log('response ç›´æ¥åŒ…å«æ•°æ®:', response)
      sparePartStats.value = response
    } else {
      console.log('å“åº”ç»“æ„å¼‚å¸¸ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®')
      sparePartStats.value = {
        overview: {
          totalSparePartTypes: 0,
          totalStockQuantity: 0,
          totalStockValue: 0,
          averageTurnoverRate: 0,
          healthScore: 0
        },
        alertStatistics: {
          lowStockCount: 0,
          zeroStockCount: 0,
          overStockCount: 0,
          stagnantStockCount: 0
        }
      }
    }
    
    console.log('å¤‡ä»¶ç»Ÿè®¡æ•°æ®è®¾ç½®æˆåŠŸ:', sparePartStats.value)
  } catch (error) {
    console.error('è·å–å¤‡ä»¶ç»Ÿè®¡æ•°æ®å¤±è´¥:', error)
    // è®¾ç½®é»˜è®¤æ•°æ®ï¼Œé¿å…æ˜¾ç¤º"æš‚æ— ç»Ÿè®¡æ•°æ®"
    sparePartStats.value = {
      overview: {
        totalSparePartTypes: 0,
        totalStockQuantity: 0,
        totalStockValue: 0,
        averageTurnoverRate: 0,
        healthScore: 0
      },
      alertStatistics: {
        lowStockCount: 0,
        zeroStockCount: 0,
        overStockCount: 0,
        stagnantStockCount: 0
      }
    }
  } finally {
    sparePartLoading.value = false
  }
}

// æ ¼å¼åŒ–æ•°å­—
const formatNumber = (value: any) => {
  if (!value) return '0'
  return Number(value).toLocaleString()
}

// è·å–å¥åº·åº¦é¢œè‰²
const getHealthScoreColor = (score: number) => {
  if (score >= 80) return 'text-green-600'
  if (score >= 60) return 'text-yellow-600'
  return 'text-red-600'
}

// åˆå§‹åŒ–æ•°æ®
onMounted(() => {
  getSparePartStatistics()
})
</script>
```

### 4.3 å…³é”®ç‰¹æ€§
- **å®æ—¶æ•°æ®**: æ”¯æŒæ‰‹åŠ¨åˆ·æ–°è·å–æœ€æ–°æ•°æ®
- **åŠ è½½çŠ¶æ€**: æ˜¾ç¤ºåŠ è½½åŠ¨ç”»æå‡ç”¨æˆ·ä½“éªŒ
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œé»˜è®¤æ•°æ®æ˜¾ç¤º
- **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸

## ğŸ“ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½å®ç°

### 5.1 åŠŸèƒ½æ¦‚è¿°
æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ”¯æŒå¤‡ä»¶å›¾ç‰‡ã€è¯´æ˜ä¹¦ã€å›¾çº¸ç­‰æ–‡ä»¶çš„ä¸Šä¼ å’Œç®¡ç†ã€‚

### 5.2 å®ç°ä»£ç 
```vue
<template>
  <el-form-item label="å¤‡ä»¶å›¾ç‰‡" prop="imageUrl">
    <UploadImg v-model="formData.imageUrl" :limit="1" />
  </el-form-item>
  
  <el-form-item label="è¯´æ˜ä¹¦æ–‡ä»¶" prop="manualUrl">
    <UploadFile v-model="formData.manualUrl" :limit="1" :fileType="['pdf', 'doc', 'docx']" />
  </el-form-item>
  
  <el-form-item label="å›¾çº¸æ–‡ä»¶" prop="drawingUrl">
    <UploadFile v-model="formData.drawingUrl" :limit="1" :fileType="['pdf', 'dwg', 'dxf', 'jpg', 'png']" />
  </el-form-item>
</template>

<script setup lang="ts">
// è¡¨å•æ•°æ®åˆå§‹åŒ–
const formData = ref({
  imageUrl: '',
  manualUrl: '',
  drawingUrl: ''
})

// é‡ç½®è¡¨å•
const resetForm = () => {
  formData.value = {
    imageUrl: '',
    manualUrl: '',
    drawingUrl: ''
  }
}
</script>
```

### 5.3 æ–‡ä»¶ç±»å‹é™åˆ¶
- **å›¾ç‰‡æ–‡ä»¶**: jpg, jpeg, png, gif
- **æ–‡æ¡£æ–‡ä»¶**: pdf, doc, docx
- **å›¾çº¸æ–‡ä»¶**: pdf, dwg, dxf, jpg, png

## ğŸ”— æ•°æ®å…³è”å¤„ç†

### 6.1 å¤‡ä»¶åç§°æ˜¾ç¤º
```vue
<template>
  <!-- åˆ—è¡¨æ˜¾ç¤ºå¤‡ä»¶åç§° -->
  <el-table-column label="å¤‡ä»¶åç§°" prop="sparePartName" width="200px" />
  
  <!-- è¡¨å•ä¸‹æ‹‰é€‰æ‹© -->
  <el-form-item label="å¤‡ä»¶åç§°" prop="sparePartId">
    <el-select v-model="formData.sparePartId" placeholder="è¯·é€‰æ‹©å¤‡ä»¶">
      <el-option
        v-for="item in sparePartList"
        :key="item.id"
        :label="item.sparePartName"
        :value="item.id"
      />
    </el-select>
  </el-form-item>
</template>

<script setup lang="ts">
import { SparePartInfoApi } from '@/api/coal/sparepartinfo'

const sparePartList = ref<any[]>([])

// è·å–å¤‡ä»¶åˆ—è¡¨
const getSparePartList = async () => {
  try {
    const response = await SparePartInfoApi.getSimpleSparePartList()
    sparePartList.value = response.data
  } catch (error) {
    console.error('è·å–å¤‡ä»¶åˆ—è¡¨å¤±è´¥:', error)
  }
}

// è·å–å¤‡ä»¶åç§°
const getSparePartName = (sparePartId: number) => {
  const sparePart = sparePartList.value.find(item => item.id === sparePartId)
  return sparePart ? sparePart.sparePartName : sparePartId
}

onMounted(() => {
  getSparePartList()
})
</script>
```

### 6.2 è®¾å¤‡åç§°æ˜¾ç¤º
```vue
<template>
  <!-- åˆ—è¡¨æ˜¾ç¤ºè®¾å¤‡åç§° -->
  <el-table-column label="è®¾å¤‡åç§°" prop="equipmentName" width="200px" />
  
  <!-- è¡¨å•ä¸‹æ‹‰é€‰æ‹© -->
  <el-form-item label="è®¾å¤‡åç§°" prop="equipmentId">
    <el-select v-model="formData.equipmentId" placeholder="è¯·é€‰æ‹©è®¾å¤‡">
      <el-option
        v-for="item in equipmentList"
        :key="item.id"
        :label="item.equipmentName"
        :value="item.id"
      />
    </el-select>
  </el-form-item>
</template>

<script setup lang="ts">
import { EquipmentInfoApi } from '@/api/coal/equipmentinfo'

const equipmentList = ref<any[]>([])

// è·å–è®¾å¤‡åˆ—è¡¨
const getEquipmentList = async () => {
  try {
    const response = await EquipmentInfoApi.getSimpleEquipmentList()
    equipmentList.value = response.data
  } catch (error) {
    console.error('è·å–è®¾å¤‡åˆ—è¡¨å¤±è´¥:', error)
  }
}

onMounted(() => {
  getEquipmentList()
})
</script>
```

## ğŸ”§ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 7.1 äº‹åŠ¡ç®¡ç†
- ä½¿ç”¨ `@Transactional` ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- å…³é”®æ“ä½œä½¿ç”¨äº‹åŠ¡å›æ»šæœºåˆ¶

### 7.2 å¼‚å¸¸å¤„ç†
- å®Œå–„çš„ try-catch å¼‚å¸¸å¤„ç†
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- ä¼˜é›…çš„é™çº§å¤„ç†

### 7.3 æ€§èƒ½ä¼˜åŒ–
- æ‰¹é‡æ•°æ®å¤„ç†
- ç¼“å­˜æœºåˆ¶åº”ç”¨
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

### 7.4 ç”¨æˆ·ä½“éªŒ
- åŠ è½½çŠ¶æ€æ˜¾ç¤º
- é”™è¯¯æç¤ºå‹å¥½
- æ“ä½œåé¦ˆåŠæ—¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-01-09  
**æ›´æ–°æ—¶é—´**: 2025-01-09  
**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ
