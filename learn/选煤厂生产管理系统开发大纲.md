# 选煤厂生产管理系统开发大纲

## 🎯 项目概述

基于芋道开源框架开发的选煤厂智能生产管控系统，实现生产调度、设备管理、煤质管理、安全管理等全流程数字化管理。系统采用标准数据库设计，数据标准指导后续各种选煤智能化新技术开发，确保选煤信息"一次输入，全局共享"，提高数据的真实性和唯一性。

### 📋 开发进度跟踪

**已完成模块：**
- ✅ **生产计划管理** - 树表结构，支持年/月/日/班计划层级管理，完成率统计分析
- ✅ **生产日报管理** - 现场生产数据记录，包含产量、质量、设备状态等，统计接口完善
- ✅ **班制与班次设置** - 树表结构，支持多种班制模式和灵活班次配置
- ✅ **排班管理** - 主子表结构，支持日常排班、人员安排和替班管理
- ✅ **设备分类管理** - 树表结构，设备按系统/子系统/设备类型层级分类
- ✅ **设备档案管理** - 设备台账、设备档案、二维码管理、文件上传
- ✅ **备件分类管理** - 树表结构，支持备件按类别层级管理
- ✅ **备件基础信息** - 基于ERP产品表扩展，支持备件规格、库存预警配置
- ✅ **备件库存记录** - 库存变更记录，支持入库、出库、调拨、盘点等操作
- ✅ **备件出入库管理** - 完整的出入库流程，支持单据管理和审批
- ✅ **备件预警管理** - 库存预警、更换提醒、预警处理流程
- ✅ **备件设备关联** - 备件与设备的多对多关联关系管理
- ✅ **检修计划管理** - 日/周/月检修计划，支持审批流程
- ✅ **报修单管理** - 设备故障报修，支持图片、语音、视频记录
- ✅ **检修单管理** - 检修工单全流程管理，关联检修计划和报修单
- ✅ **备件使用记录** - 检修过程中备件使用记录，自动关联检修单和设备
- ✅ **煤质管理模块** - 质量检测项目、质量标准、检测记录、检测数据、预警管理，完整业务流程设计，包含统计接口和业务流程卡片
- ✅ **安全管理模块** - 安全检查分类、安全检查计划、安全检查记录、安全检查项目、安全事故记录、安全附件管理，完整业务流程设计，包含统计接口和业务流程卡片
- ✅ **能源管理模块** - 能源类型配置、能源消耗记录、能源统计分析、能源预警管理，完整业务流程设计，包含统计接口和业务流程卡片

**推荐下一个开发模块：**
- 🎯 **调度看板管理模块** - 生产看板、任务看板、报警看板（推荐优先开发）

**待开发模块：**  
- ⏳ **调度看板** - 生产看板、任务看板、报警看板
- ⏳ **产品销售管理** - 产品销售数质量统计、合格率分析
- ⏳ **事故统计分析** - 生产事故、机电事故、安全事故统计
- ⏳ **KPI分析** - 生产KPI、设备KPI指标计算和分析
- ⏳ **报表统计** - 各类生产报表和数据分析

### 技术架构
- **后端**：Spring Boot + MyBatis-Plus + SQL Server
- **前端**：Vue 3 + TypeScript + Element Plus
- **框架**：芋道开源框架 (ruoyi-vue-pro)
- **数据库**：MySQL 8.0+（支持JSON数据类型，存储半结构化数据）
- **部署**：Docker + Nginx
- **集成**：PLC数据采集、OPC UA、MQTT协议支持

---

## 📊 系统架构设计

### 模块划分

```
yudao-module-coal/                    # 选煤厂核心模块
├── production/                       # 生产调度管理
├── equipment/                        # 设备档案管理  
├── quality/                          # 煤质管理
├── safety/                          # 安全管理
├── energy/                          # 能源管理
├── report/                          # 报表统计
└── common/                          # 公共组件
```

### 数据库设计原则
- 采用 MySQL 8.0+ 数据库，支持JSON数据类型存储半结构化数据
- 遵循第三范式设计，确保数据标准化
- 支持多租户架构，数据隔离安全
- 预留扩展字段，支持后续功能扩展
- 建立完整的索引体系，优化查询性能
- 数据标准统一，支持"一次输入，全局共享"

---

## 🗄️ 数据库设计详解

### 1. 生产调度管理模块

#### 1.1 生产计划表 (coal_production_plan) - 树表结构
```sql
DROP TABLE IF EXISTS `coal_production_plan`;
CREATE TABLE `coal_production_plan` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '计划ID',
    `name` VARCHAR(100) NOT NULL COMMENT '计划名称',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父计划ID',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '显示顺序',
    `plan_code` VARCHAR(50) NOT NULL DEFAULT '' COMMENT '计划编号',
    `plan_type` TINYINT NOT NULL COMMENT '计划类型：1年度 2月度 3日计划 4班计划',
    `plan_year` INT NULL COMMENT '计划年度',
    `plan_month` TINYINT NULL COMMENT '计划月份',
    `plan_date` DATE NULL COMMENT '计划日期',
    `shift_id` BIGINT NULL COMMENT '班次ID',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '计划状态：0停用 1正常',
    plan_path VARCHAR(500) COMMENT '计划层级路径（如：1/2/3表示年/月/日）',

    -- 计划产量数据（基础）
    `raw_coal_plan` DECIMAL(10,2) NULL COMMENT '计划入洗原煤量(吨)',

    -- 精煤产量计划（按粒度分类）
    `fine_coal_plan` DECIMAL(10,2) NULL COMMENT '计划末煤产量(吨)',
    `granular_coal_plan` DECIMAL(10,2) NULL COMMENT '计划粒煤产量(吨)',
    `large_block_coal_plan` DECIMAL(10,2) NULL COMMENT '计划大块煤产量(吨)',
    `medium_block_coal_plan` DECIMAL(10,2) NULL COMMENT '计划中块煤产量(吨)',
    `small_block_coal_plan` DECIMAL(10,2) NULL COMMENT '计划小块煤产量(吨)',

    -- 其他产品计划产量
    `middling_coal_plan` DECIMAL(10,2) NULL COMMENT '计划中煤产量(吨)',
    `slime_plan` DECIMAL(10,2) NULL COMMENT '计划煤泥产量(吨)',
    `gangue_plan` DECIMAL(10,2) NULL COMMENT '计划矸石产量(吨)',

    -- 预留计划产量字段
    `reserved_product_plan1` DECIMAL(10,2) NULL COMMENT '预留计划产量字段1(吨)',
    `reserved_product_plan2` DECIMAL(10,2) NULL COMMENT '预留计划产量字段2(吨)',

    -- 质量指标
    `fine_coal_ash` DECIMAL(5,2) NULL COMMENT '末煤灰分(%)',
    `granular_coal_ash` DECIMAL(5,2) NULL COMMENT '粒煤灰分(%)',
    `large_block_coal_ash` DECIMAL(5,2) NULL COMMENT '大块煤灰分(%)',
    `medium_block_coal_ash` DECIMAL(5,2) NULL COMMENT '中块煤灰分(%)',
    `small_block_coal_ash` DECIMAL(5,2) NULL COMMENT '小块煤灰分(%)',
    `middling_coal_ash` DECIMAL(5,2) NULL COMMENT '中煤灰分(%)',

    -- 审批信息
    `creator_id` BIGINT NULL COMMENT '制定人ID',
    `approver_id` BIGINT NULL COMMENT '审批人ID',
    `approve_time` DATETIME NULL COMMENT '审批时间',

    -- 基础字段（芋道框架标准）
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '生产计划表（树表结构）';
```

#### 1.2 现场生产日报表 (coal_production_daily_report)
```sql
CREATE TABLE `coal_production_daily_report` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT '日报id',
  `report_date` datetime NOT NULL COMMENT '日期',
  `shift_id` bigint DEFAULT NULL COMMENT '班次ID',
  `operator_id` bigint DEFAULT NULL COMMENT '集控员（操作人）ID',
  `shift_leader_id` bigint DEFAULT NULL COMMENT '带班主任/班长ID',
  `start_time` datetime DEFAULT NULL COMMENT '启车时间',
  `coal_feeding_time` int DEFAULT NULL COMMENT '带煤时间(分钟)',
  `stop_time` datetime DEFAULT NULL COMMENT '停车时间',
  `effective_feeding_time` int DEFAULT NULL COMMENT '有效带煤时间(分钟)',
  `fault_impact_time` int DEFAULT NULL COMMENT '故障影响时间(分钟)',
  `raw_coal_input` decimal(10,2) DEFAULT NULL COMMENT '入洗煤量(吨)',
  `hourly_capacity` decimal(8,2) DEFAULT NULL COMMENT '小时处理量(吨/小时)',
  `block_clean_coal_output` decimal(10,2) DEFAULT NULL COMMENT '块精煤产量(吨)',
  `fine_clean_coal_output` decimal(10,2) DEFAULT NULL COMMENT '末精煤产量(吨)',
  `gangue_output` decimal(10,2) DEFAULT NULL COMMENT '矸石产量(吨)',
  `middling_coal_output` decimal(10,2) DEFAULT NULL COMMENT '中煤产量(吨)',
  `filter_press_cycles` int DEFAULT NULL COMMENT '压滤板次',
  `filter_press_coal_amount` decimal(8,2) DEFAULT NULL COMMENT '压滤煤量(吨)',
  `filter_cloth_usage` int DEFAULT NULL COMMENT '滤布使用量(张)',
  `discharge_record` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '放舱记录',
  `baffle_medium_addition` decimal(8,2) DEFAULT NULL COMMENT '挡板添加介质量(kg)',
  `cao_amount` decimal(8,2) DEFAULT NULL COMMENT 'CaO量(kg)',
  `flocculant_amount` decimal(8,2) DEFAULT NULL COMMENT '絮凝剂(kg)',
  `density_MD317` decimal(5,2) DEFAULT NULL COMMENT '317密度(kg/L)',
  `first_ash_block_clean` decimal(5,2) DEFAULT NULL COMMENT '第一次块精煤灰分(%)',
  `first_ash_fine_clean` decimal(5,2) DEFAULT NULL COMMENT '第一次末精煤灰分(%)',
  `first_ash_middling` decimal(5,2) DEFAULT NULL COMMENT '第一次中煤灰分(%)',
  `first_ash_slime` decimal(5,2) DEFAULT NULL COMMENT '第一次煤泥灰分(%)',
  `first_ash_gangue` decimal(5,2) DEFAULT NULL COMMENT '第一次矸石灰分(%)',
  `second_ash_block_clean` decimal(5,2) DEFAULT NULL COMMENT '第二次块精煤灰分(%)',
  `second_ash_fine_clean` decimal(5,2) DEFAULT NULL COMMENT '第二次末精煤灰分(%)',
  `second_ash_middling` decimal(5,2) DEFAULT NULL COMMENT '第二次中煤灰分(%)',
  `second_ash_slime` decimal(5,2) DEFAULT NULL COMMENT '第二次煤泥灰分(%)',
  `second_ash_gangue` decimal(5,2) DEFAULT NULL COMMENT '第二次矸石灰分(%)',
  `impact_time_record` text COLLATE utf8mb4_unicode_ci COMMENT '影响时间记录详情',
  `assigned_tasks` text COLLATE utf8mb4_unicode_ci COMMENT '交办事项',
  `start_circulating_water_pool` decimal(6,2) DEFAULT NULL COMMENT '启车循环水池液位',
  `start_clean_water_tank` decimal(6,2) DEFAULT NULL COMMENT '启车清水桶液位',
  `start_fine_coal_level` decimal(6,2) DEFAULT NULL COMMENT '启车末煤仓位',
  `start_granular_coal_level` decimal(6,2) DEFAULT NULL COMMENT '启车粒煤仓位',
  `start_large_block_level` decimal(6,2) DEFAULT NULL COMMENT '启车大块仓位',
  `start_medium_block_level` decimal(6,2) DEFAULT NULL COMMENT '启车中块仓位',
  `start_small_block_level` decimal(6,2) DEFAULT NULL COMMENT '启车小块仓位',
  `start_middling_coal_level` decimal(6,2) DEFAULT NULL COMMENT '启车中煤仓位',
  `start_gangue_level` decimal(6,2) DEFAULT NULL COMMENT '启车矸石仓位',
  `stop_circulating_water_pool` decimal(6,2) DEFAULT NULL COMMENT '停车循环水池液位',
  `stop_clean_water_tank` decimal(6,2) DEFAULT NULL COMMENT '停车清水桶液位',
  `stop_fine_coal_level` decimal(6,2) DEFAULT NULL COMMENT '停车末煤仓位',
  `stop_granular_coal_level` decimal(6,2) DEFAULT NULL COMMENT '停车粒煤仓位',
  `stop_large_block_level` decimal(6,2) DEFAULT NULL COMMENT '停车大块仓位',
  `stop_medium_block_level` decimal(6,2) DEFAULT NULL COMMENT '停车中块仓位',
  `stop_small_block_level` decimal(6,2) DEFAULT NULL COMMENT '停车小块仓位',
  `stop_middling_coal_level` decimal(6,2) DEFAULT NULL COMMENT '停车中煤仓位',
  `stop_gangue_level` decimal(6,2) DEFAULT NULL COMMENT '停车矸石仓位',
  `remarks` text COLLATE utf8mb4_unicode_ci COMMENT '备注信息',
  `reserved_field1` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '预留字段1',
  `reserved_field2` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT '预留字段2',
  `reserved_field3` decimal(10,2) DEFAULT NULL COMMENT '预留字段3',
  `reserved_field4` decimal(10,2) DEFAULT NULL COMMENT '预留字段4',
  `reserved_field5` text COLLATE utf8mb4_unicode_ci COMMENT '预留字段5',
  `creator` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT '' COMMENT '创建者',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updater` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT '' COMMENT '更新者',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `deleted` tinyint DEFAULT '0' COMMENT '是否删除',
  `tenant_id` bigint DEFAULT '0' COMMENT '租户ID',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1120870174271299585 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='现场生产日报表';
```

#### 1.3 计划完成率统计表 (coal_plan_completion_statistics)
```sql
CREATE TABLE coal_plan_completion_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    plan_id BIGINT NOT NULL COMMENT '计划ID',
    statistics_date DATE NOT NULL COMMENT '统计日期',
    statistics_type TINYINT NOT NULL COMMENT '统计类型：1日统计 2月统计 3年统计 4班统计',

    -- 计划数据
    plan_raw_coal DECIMAL(10,2),                  -- 计划入洗原煤量(吨)
    plan_fine_coal DECIMAL(10,2),                 -- 计划末煤产量(吨)
    plan_granular_coal DECIMAL(10,2),             -- 计划粒煤产量(吨)
    plan_large_block_coal DECIMAL(10,2),          -- 计划大块煤产量(吨)
    plan_medium_block_coal DECIMAL(10,2),         -- 计划中块煤产量(吨)
    plan_small_block_coal DECIMAL(10,2),          -- 计划小块煤产量(吨)
    plan_middling_coal DECIMAL(10,2),             -- 计划中煤产量(吨)
    plan_gangue DECIMAL(10,2),                    -- 计划矸石产量(吨)

    -- 实际完成数据
    actual_raw_coal DECIMAL(10,2),                -- 实际入洗原煤量(吨)
    actual_fine_coal DECIMAL(10,2),               -- 实际末煤产量(吨)
    actual_granular_coal DECIMAL(10,2),           -- 实际粒煤产量(吨)
    actual_large_block_coal DECIMAL(10,2),        -- 实际大块煤产量(吨)
    actual_medium_block_coal DECIMAL(10,2),       -- 实际中块煤产量(吨)
    actual_small_block_coal DECIMAL(10,2),        -- 实际小块煤产量(吨)
    actual_middling_coal DECIMAL(10,2),           -- 实际中煤产量(吨)
    actual_gangue DECIMAL(10,2),                  -- 实际矸石产量(吨)

    -- 完成率数据（百分比）
    completion_rate_raw_coal DECIMAL(5,2),        -- 入洗原煤完成率(%)
    completion_rate_fine_coal DECIMAL(5,2),       -- 末煤完成率(%)
    completion_rate_granular_coal DECIMAL(5,2),   -- 粒煤完成率(%)
    completion_rate_large_block DECIMAL(5,2),     -- 大块煤完成率(%)
    completion_rate_medium_block DECIMAL(5,2),    -- 中块煤完成率(%)
    completion_rate_small_block DECIMAL(5,2),     -- 小块煤完成率(%)
    completion_rate_middling_coal DECIMAL(5,2),   -- 中煤完成率(%)
    completion_rate_gangue DECIMAL(5,2),          -- 矸石完成率(%)

    -- 总体完成率
    overall_completion_rate DECIMAL(5,2),         -- 总体完成率(%)

    -- 统计状态
    statistics_status TINYINT DEFAULT 1,          -- 统计状态：1正常 2异常 3需关注

    -- 基础字段
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 1.4 班次管理模块 (树表 + 主子表)

##### 1.4.1 业务逻辑与表结构设计
为满足合同中"开放性班次设置"、"倒班/值班设置"及"指定生产班"的灵活要求，采用 **树表 + 主子表** 结合的方案：

1.  **班制与班次设置 (`coal_shift_system` - 树表)**:
    *   **作用**: 定义班次的"制度"或"模式"。树结构能清晰体现"班制" (如: 三班两倒) 与其下的具体"班次" (如: 早班, 中班) 的层级关系。
    *   **生成方式**: 使用芋道代码生成器的 **树表** 模板。

2.  **排班管理 (`coal_schedule` - 主表) & 人员安排 (`coal_schedule_staff` - 子表)**:
    *   **作用**: 负责具体的"排班管理"和"人员分配"。主表核心是"哪一天，采用哪种班制"，子表负责"在该天的具体班次中，安排了哪些人"。
    *   **生成方式**: 使用芋道代码生成器的 **主子表** 模板。

**表关系：**
```
coal_shift_system (班制与班次) <--- coal_schedule (排班管理)
                                      |
                                      +--- coal_schedule_staff (人员安排)
```

##### 1.4.2 班制与班次设置 (coal_shift_system) - 树表
```sql
DROP TABLE IF EXISTS `coal_shift_system`;
CREATE TABLE `coal_shift_system` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ID',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父ID (0=班制, >0=班次)',
    `name` VARCHAR(50) NOT NULL COMMENT '名称 (班制或班次名)',
    `code` VARCHAR(20) NULL COMMENT '编码 (班次编码)',
    `is_production` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否生产班制 (仅班制层级有效)',
    `start_time` TIME NULL COMMENT '开始时间 (仅班次层级有效) - 格式：HH:mm:ss',
    `end_time` TIME NULL COMMENT '结束时间 (仅班次层级有效) - 格式：HH:mm:ss',
    `shift_type` TINYINT NULL COMMENT '班次类型：1生产班 2检修班 3值班 (仅班次层级有效)',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_parent_id` (`parent_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '班制与班次设置 (树表)';
```

**前端时间选择器配置说明：**
- 使用 `el-time-picker` 组件选择时分秒
- 配置 `value-format="HH:mm:ss"` 确保数据格式为时分秒
- 参考芋道框架中的秒杀配置模块实现方式

##### 1.4.3 排班管理 (coal_schedule) - 主表
```sql
DROP TABLE IF EXISTS `coal_schedule`;
CREATE TABLE `coal_schedule` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '排班ID',
    `schedule_date` DATE NOT NULL COMMENT '排班日期',
    `shift_system_id` BIGINT NOT NULL COMMENT '班制ID (关联coal_shift_system)',
    `schedule_status` TINYINT NOT NULL DEFAULT 1 COMMENT '排班状态：1正常 2调整 3取消',
    `is_production_day` TINYINT(1) NOT NULL DEFAULT 1 COMMENT '是否生产日：1是 0否',
    `production_target` DECIMAL(10,2) NULL COMMENT '当日生产目标(吨)',
    `schedule_type` TINYINT NOT NULL DEFAULT 1 COMMENT '排班类型：1正常排班 2节假日排班 3应急排班',
    `approver_id` BIGINT NULL COMMENT '审批人ID',
    `approve_time` DATETIME NULL COMMENT '审批时间',
    `remark` VARCHAR(500) NULL COMMENT '备注',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_date` (`schedule_date`, `deleted`) USING BTREE,
    INDEX `idx_shift_system` (`shift_system_id`) USING BTREE,
    INDEX `idx_schedule_date` (`schedule_date`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '排班管理 (主表)';
```

##### 1.4.4 人员安排 (coal_schedule_staff) - 子表
```sql
DROP TABLE IF EXISTS `coal_schedule_staff`;
CREATE TABLE `coal_schedule_staff` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '人员安排ID',
    `schedule_id` BIGINT NOT NULL COMMENT '排班ID (关联主表)',
    `shift_id` BIGINT NOT NULL COMMENT '班次ID (关联coal_shift_system的子节点)',
    `user_id` BIGINT NOT NULL COMMENT '员工ID',
    `position_type` TINYINT NOT NULL COMMENT '岗位类型：1调度员 2操作工 3检修工 4安全员 5质检员',
    `is_leader` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否班组长',
    `is_substitute` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否替班：1是 0否',
    `substitute_reason` VARCHAR(200) NULL COMMENT '替班原因',
    `work_status` TINYINT NOT NULL DEFAULT 1 COMMENT '工作状态：1正常 2请假 3调休 4替班',
    `contact_phone` VARCHAR(20) NULL COMMENT '联系电话',
    `emergency_contact` VARCHAR(50) NULL COMMENT '紧急联系人',
    `emergency_phone` VARCHAR(20) NULL COMMENT '紧急联系电话',
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_schedule` (`schedule_id`) USING BTREE,
    INDEX `idx_shift` (`shift_id`) USING BTREE,
    INDEX `idx_user` (`user_id`) USING BTREE,
    INDEX `idx_position` (`position_type`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '人员安排 (子表)';
```

##### 1.4.5 字典数据配置

```sql
-- 班次类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('班次类型', 'shift_type', 0, '班次类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待排班', '1', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(2, '已排班', '2', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(3, '已确认', '3', 'schedule_status', 0, '1', NOW(), '1', NOW());
```

#### 1.5 测试数据
已提供班制、班次、排班、人员安排的测试数据。

### 2. 设备档案管理 ✅ **已完成**

#### 2.1 功能概述
设备档案管理模块用于管理选煤厂所有设备的详细信息，包括设备基本信息、技术参数、维护记录等。

#### 2.2 数据库设计

##### 2.2.1 设备分类表 (树表)
```sql
CREATE TABLE `coal_equipment_category` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '分类ID',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父分类ID (0=根分类)',
    `category_name` VARCHAR(50) NOT NULL COMMENT '分类名称',
    `category_code` VARCHAR(20) NOT NULL COMMENT '分类编码',
    `category_level` TINYINT NOT NULL DEFAULT 1 COMMENT '分类层级：1系统 2子系统 3设备类型',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_parent_id` (`parent_id`) USING BTREE,
    INDEX `idx_category_code` (`category_code`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备分类表 (树表)';
```

##### 2.2.2 设备档案表
```sql
CREATE TABLE `coal_equipment_info` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '设备ID',
    `equipment_code` VARCHAR(50) NOT NULL COMMENT '设备编号',
    `equipment_name` VARCHAR(100) NOT NULL COMMENT '设备名称',
    `category_id` BIGINT NOT NULL COMMENT '设备分类ID',
    `parent_equipment_id` BIGINT DEFAULT 0 COMMENT '父设备ID (支持设备层级)',
    `model` VARCHAR(100) DEFAULT NULL COMMENT '设备型号',
    `manufacturer` VARCHAR(100) DEFAULT NULL COMMENT '制造厂商',
    `manufacture_date` DATE DEFAULT NULL COMMENT '制造日期',
    `install_date` DATE DEFAULT NULL COMMENT '安装日期',
    `commission_date` DATE DEFAULT NULL COMMENT '投产日期',
    `asset_number` VARCHAR(50) DEFAULT NULL COMMENT '资产编号',
    `rated_power` DECIMAL(10,2) DEFAULT NULL COMMENT '额定功率(kW)',
    `rated_capacity` DECIMAL(10,2) DEFAULT NULL COMMENT '额定处理能力(t/h)',
    `weight` DECIMAL(10,2) DEFAULT NULL COMMENT '设备重量(t)',
    `dimensions` VARCHAR(100) DEFAULT NULL COMMENT '外形尺寸(长x宽x高)',
    `voltage_level` VARCHAR(20) DEFAULT NULL COMMENT '电压等级',
    `protection_level` VARCHAR(20) DEFAULT NULL COMMENT '防护等级',
    `workshop` VARCHAR(100) DEFAULT NULL COMMENT '所属车间',
    `location` VARCHAR(200) DEFAULT NULL COMMENT '安装位置',
    `coordinate_x` DECIMAL(10,6) DEFAULT NULL COMMENT 'X坐标',
    `coordinate_y` DECIMAL(10,6) DEFAULT NULL COMMENT 'Y坐标',
    `equipment_status` TINYINT NOT NULL DEFAULT 1 COMMENT '设备状态：1正常 2故障 3检修 4停用 5报废',
    `health_level` TINYINT NOT NULL DEFAULT 1 COMMENT '健康等级：1优良 2良好 3注意 4异常 5危险',
    `importance_level` TINYINT NOT NULL DEFAULT 3 COMMENT '重要度：1关键 2重要 3一般',
    `responsible_person_id` BIGINT DEFAULT NULL COMMENT '责任人ID',
    `maintenance_person_id` BIGINT DEFAULT NULL COMMENT '维护人ID',
    `operator_person_id` BIGINT DEFAULT NULL COMMENT '操作人ID',
    `qr_code` VARCHAR(10000) DEFAULT NULL COMMENT '二维码内容',
    `qr_code_url` VARCHAR(500) DEFAULT NULL COMMENT '二维码图片URL',
    `manual_url` VARCHAR(500) DEFAULT NULL COMMENT '说明书文件URL',
    `drawing_url` VARCHAR(500) DEFAULT NULL COMMENT '图纸文件URL',
    `supplier` VARCHAR(100) DEFAULT NULL COMMENT '供应商',
    `purchase_date` DATE DEFAULT NULL COMMENT '采购日期',
    `purchase_price` DECIMAL(12,2) DEFAULT NULL COMMENT '采购价格',
    `warranty_period` INT DEFAULT NULL COMMENT '保修期(月)',
    `warranty_expire_date` DATE DEFAULT NULL COMMENT '保修到期日期',
    `remark` TEXT COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_equipment_code` (`equipment_code`,`deleted`) USING BTREE,
    INDEX `idx_category` (`category_id`) USING BTREE,
    INDEX `idx_parent_equipment` (`parent_equipment_id`) USING BTREE,
    INDEX `idx_equipment_status` (`equipment_status`) USING BTREE,
    INDEX `idx_responsible_person` (`responsible_person_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备档案表';
```

#### 2.3 字典配置
- 设备状态：1正常 2故障 3检修 4停用 5报废
- 健康等级：1优良 2良好 3注意 4异常 5危险  
- 重要程度：1关键 2重要 3一般

#### 2.4 前端页面
- 设备分类管理 (树表)
- 设备档案管理 (支持二维码生成)
- 设备信息表单 (支持文件上传)

#### 2.5 测试数据
已提供设备分类和设备档案的测试数据。

### 3. 备件管理 ✅ **已完成**

#### 3.1 功能概述
备件管理模块基于ERP产品管理模块扩展，用于管理选煤厂设备备件的库存、预警、更换等。

#### 3.2 数据库设计

##### 3.2.1 扩展ERP产品表
在现有`erp_product`表基础上添加备件特有字段：
```sql
ALTER TABLE `erp_product` ADD COLUMN `equipment_id` BIGINT DEFAULT NULL COMMENT '关联设备ID';
ALTER TABLE `erp_product` ADD COLUMN `spare_part_type` TINYINT DEFAULT NULL COMMENT '备件类型：1易损件 2标准件 3专用件';
ALTER TABLE `erp_product` ADD COLUMN `min_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最低库存预警数量';
ALTER TABLE `erp_product` ADD COLUMN `max_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最高库存数量';
ALTER TABLE `erp_product` ADD COLUMN `safety_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '安全库存数量';
ALTER TABLE `erp_product` ADD COLUMN `supplier_id` BIGINT DEFAULT NULL COMMENT '供应商ID';
ALTER TABLE `erp_product` ADD COLUMN `replacement_cycle` INT DEFAULT NULL COMMENT '更换周期(天)';
ALTER TABLE `erp_product` ADD COLUMN `last_replacement_date` DATE DEFAULT NULL COMMENT '最后更换日期';
ALTER TABLE `erp_product` ADD COLUMN `next_replacement_date` DATE DEFAULT NULL COMMENT '下次更换日期';
```

##### 3.2.2 备件设备关联表
```sql
CREATE TABLE `coal_spare_part_equipment` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关联ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `equipment_id` BIGINT NOT NULL COMMENT '设备ID',
    `usage_count` INT NOT NULL DEFAULT 0 COMMENT '使用数量',
    `is_required` TINYINT NOT NULL DEFAULT 1 COMMENT '是否必需：1必需 0非必需',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_spare_part_equipment` (`spare_part_id`, `equipment_id`, `deleted`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_equipment` (`equipment_id`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件设备关联表';
```

##### 3.2.3 备件预警记录表
```sql
CREATE TABLE `coal_spare_part_alert` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '预警ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID',
    `alert_type` TINYINT NOT NULL COMMENT '预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒',
    `current_stock` DECIMAL(10,2) NOT NULL COMMENT '当前库存',
    `threshold_value` DECIMAL(10,2) NOT NULL COMMENT '阈值',
    `alert_level` TINYINT NOT NULL DEFAULT 1 COMMENT '预警级别：1低 2中 3高',
    `alert_status` TINYINT NOT NULL DEFAULT 1 COMMENT '预警状态：1待处理 2已处理 3已忽略',
    `alert_message` VARCHAR(500) NOT NULL COMMENT '预警信息',
    `handler_id` BIGINT DEFAULT NULL COMMENT '处理人ID',
    `handle_time` DATETIME DEFAULT NULL COMMENT '处理时间',
    `handle_remark` VARCHAR(500) DEFAULT NULL COMMENT '处理备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_warehouse` (`warehouse_id`) USING BTREE,
    INDEX `idx_alert_type` (`alert_type`) USING BTREE,
    INDEX `idx_alert_status` (`alert_status`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件预警记录表';
```

#### 3.3 字典配置
- 备件类型：1易损件 2标准件 3专用件
- 预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒
- 预警级别：1低 2中 3高
- 预警状态：1待处理 2已处理 3已忽略

#### 3.4 前端页面
- 备件管理主页面 (基于ERP产品管理扩展)
- 库存管理弹窗 (库存信息、记录、调整)
- 预警管理弹窗 (预警列表、设置、处理)

#### 3.5 后端服务
- 扩展ERP Product实体类，添加备件特有字段
- 创建备件设备关联Service
- 创建备件预警Service (支持定时任务)

#### 3.6 测试数据
已提供备件分类、产品、库存、设备关联、预警记录的测试数据。

## 四、开发进度总结

### 已完成模块
1. ✅ **生产计划管理** - 生产计划制定、执行、监控
2. ✅ **生产日报管理** - 日报填报、审核、统计
3. ✅ **班制与班次管理** - 班制设置、班次管理
4. ✅ **排班管理** - 排班计划、人员安排
5. ✅ **设备档案管理** - 设备分类、档案、二维码
6. ✅ **备件管理** - 基于ERP扩展的备件库存预警管理

### 推荐下一个开发模块
**维护管理模块** - 设备维护计划、维护记录、维护提醒sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '生产班', '1', 'shift_type', 0, '1', NOW(), '1', NOW()),
(2, '检修班', '2', 'shift_type', 0, '1', NOW(), '1', NOW()),
(3, '值班', '3', 'shift_type', 0, '1', NOW(), '1', NOW());

-- 岗位类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('岗位类型', 'position_type', 0, '排班岗位类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待排班', '1', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(2, '已排班', '2', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(3, '已确认', '3', 'schedule_status', 0, '1', NOW(), '1', NOW());
```

#### 1.5 测试数据
已提供班制、班次、排班、人员安排的测试数据。

### 2. 设备档案管理 ✅ **已完成**

#### 2.1 功能概述
设备档案管理模块用于管理选煤厂所有设备的详细信息，包括设备基本信息、技术参数、维护记录等。

#### 2.2 数据库设计

##### 2.2.1 设备分类表 (树表)
```sql
CREATE TABLE `coal_equipment_category` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '分类ID',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父分类ID (0=根分类)',
    `category_name` VARCHAR(50) NOT NULL COMMENT '分类名称',
    `category_code` VARCHAR(20) NOT NULL COMMENT '分类编码',
    `category_level` TINYINT NOT NULL DEFAULT 1 COMMENT '分类层级：1系统 2子系统 3设备类型',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_parent_id` (`parent_id`) USING BTREE,
    INDEX `idx_category_code` (`category_code`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备分类表 (树表)';
```

##### 2.2.2 设备档案表
```sql
CREATE TABLE `coal_equipment_info` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '设备ID',
    `equipment_code` VARCHAR(50) NOT NULL COMMENT '设备编号',
    `equipment_name` VARCHAR(100) NOT NULL COMMENT '设备名称',
    `category_id` BIGINT NOT NULL COMMENT '设备分类ID',
    `parent_equipment_id` BIGINT DEFAULT 0 COMMENT '父设备ID (支持设备层级)',
    `model` VARCHAR(100) DEFAULT NULL COMMENT '设备型号',
    `manufacturer` VARCHAR(100) DEFAULT NULL COMMENT '制造厂商',
    `manufacture_date` DATE DEFAULT NULL COMMENT '制造日期',
    `install_date` DATE DEFAULT NULL COMMENT '安装日期',
    `commission_date` DATE DEFAULT NULL COMMENT '投产日期',
    `asset_number` VARCHAR(50) DEFAULT NULL COMMENT '资产编号',
    `rated_power` DECIMAL(10,2) DEFAULT NULL COMMENT '额定功率(kW)',
    `rated_capacity` DECIMAL(10,2) DEFAULT NULL COMMENT '额定处理能力(t/h)',
    `weight` DECIMAL(10,2) DEFAULT NULL COMMENT '设备重量(t)',
    `dimensions` VARCHAR(100) DEFAULT NULL COMMENT '外形尺寸(长x宽x高)',
    `voltage_level` VARCHAR(20) DEFAULT NULL COMMENT '电压等级',
    `protection_level` VARCHAR(20) DEFAULT NULL COMMENT '防护等级',
    `workshop` VARCHAR(100) DEFAULT NULL COMMENT '所属车间',
    `location` VARCHAR(200) DEFAULT NULL COMMENT '安装位置',
    `coordinate_x` DECIMAL(10,6) DEFAULT NULL COMMENT 'X坐标',
    `coordinate_y` DECIMAL(10,6) DEFAULT NULL COMMENT 'Y坐标',
    `equipment_status` TINYINT NOT NULL DEFAULT 1 COMMENT '设备状态：1正常 2故障 3检修 4停用 5报废',
    `health_level` TINYINT NOT NULL DEFAULT 1 COMMENT '健康等级：1优良 2良好 3注意 4异常 5危险',
    `importance_level` TINYINT NOT NULL DEFAULT 3 COMMENT '重要度：1关键 2重要 3一般',
    `responsible_person_id` BIGINT DEFAULT NULL COMMENT '责任人ID',
    `maintenance_person_id` BIGINT DEFAULT NULL COMMENT '维护人ID',
    `operator_person_id` BIGINT DEFAULT NULL COMMENT '操作人ID',
    `qr_code` VARCHAR(10000) DEFAULT NULL COMMENT '二维码内容',
    `qr_code_url` VARCHAR(500) DEFAULT NULL COMMENT '二维码图片URL',
    `manual_url` VARCHAR(500) DEFAULT NULL COMMENT '说明书文件URL',
    `drawing_url` VARCHAR(500) DEFAULT NULL COMMENT '图纸文件URL',
    `supplier` VARCHAR(100) DEFAULT NULL COMMENT '供应商',
    `purchase_date` DATE DEFAULT NULL COMMENT '采购日期',
    `purchase_price` DECIMAL(12,2) DEFAULT NULL COMMENT '采购价格',
    `warranty_period` INT DEFAULT NULL COMMENT '保修期(月)',
    `warranty_expire_date` DATE DEFAULT NULL COMMENT '保修到期日期',
    `remark` TEXT COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_equipment_code` (`equipment_code`,`deleted`) USING BTREE,
    INDEX `idx_category` (`category_id`) USING BTREE,
    INDEX `idx_parent_equipment` (`parent_equipment_id`) USING BTREE,
    INDEX `idx_equipment_status` (`equipment_status`) USING BTREE,
    INDEX `idx_responsible_person` (`responsible_person_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备档案表';
```

#### 2.3 字典配置
- 设备状态：1正常 2故障 3检修 4停用 5报废
- 健康等级：1优良 2良好 3注意 4异常 5危险  
- 重要程度：1关键 2重要 3一般

#### 2.4 前端页面
- 设备分类管理 (树表)
- 设备档案管理 (支持二维码生成)
- 设备信息表单 (支持文件上传)

#### 2.5 测试数据
已提供设备分类和设备档案的测试数据。

### 3. 备件管理 ✅ **已完成**

#### 3.1 功能概述
备件管理模块基于ERP产品管理模块扩展，用于管理选煤厂设备备件的库存、预警、更换等。

#### 3.2 数据库设计

##### 3.2.1 扩展ERP产品表
在现有`erp_product`表基础上添加备件特有字段：
```sql
ALTER TABLE `erp_product` ADD COLUMN `equipment_id` BIGINT DEFAULT NULL COMMENT '关联设备ID';
ALTER TABLE `erp_product` ADD COLUMN `spare_part_type` TINYINT DEFAULT NULL COMMENT '备件类型：1易损件 2标准件 3专用件';
ALTER TABLE `erp_product` ADD COLUMN `min_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最低库存预警数量';
ALTER TABLE `erp_product` ADD COLUMN `max_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最高库存数量';
ALTER TABLE `erp_product` ADD COLUMN `safety_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '安全库存数量';
ALTER TABLE `erp_product` ADD COLUMN `supplier_id` BIGINT DEFAULT NULL COMMENT '供应商ID';
ALTER TABLE `erp_product` ADD COLUMN `replacement_cycle` INT DEFAULT NULL COMMENT '更换周期(天)';
ALTER TABLE `erp_product` ADD COLUMN `last_replacement_date` DATE DEFAULT NULL COMMENT '最后更换日期';
ALTER TABLE `erp_product` ADD COLUMN `next_replacement_date` DATE DEFAULT NULL COMMENT '下次更换日期';
```

##### 3.2.2 备件设备关联表
```sql
CREATE TABLE `coal_spare_part_equipment` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关联ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `equipment_id` BIGINT NOT NULL COMMENT '设备ID',
    `usage_count` INT NOT NULL DEFAULT 0 COMMENT '使用数量',
    `is_required` TINYINT NOT NULL DEFAULT 1 COMMENT '是否必需：1必需 0非必需',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_spare_part_equipment` (`spare_part_id`, `equipment_id`, `deleted`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_equipment` (`equipment_id`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件设备关联表';
```

##### 3.2.3 备件预警记录表
```sql
CREATE TABLE `coal_spare_part_alert` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '预警ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID',
    `alert_type` TINYINT NOT NULL COMMENT '预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒',
    `current_stock` DECIMAL(10,2) NOT NULL COMMENT '当前库存',
    `threshold_value` DECIMAL(10,2) NOT NULL COMMENT '阈值',
    `alert_level` TINYINT NOT NULL DEFAULT 1 COMMENT '预警级别：1低 2中 3高',
    `alert_status` TINYINT NOT NULL DEFAULT 1 COMMENT '预警状态：1待处理 2已处理 3已忽略',
    `alert_message` VARCHAR(500) NOT NULL COMMENT '预警信息',
    `handler_id` BIGINT DEFAULT NULL COMMENT '处理人ID',
    `handle_time` DATETIME DEFAULT NULL COMMENT '处理时间',
    `handle_remark` VARCHAR(500) DEFAULT NULL COMMENT '处理备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_warehouse` (`warehouse_id`) USING BTREE,
    INDEX `idx_alert_type` (`alert_type`) USING BTREE,
    INDEX `idx_alert_status` (`alert_status`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件预警记录表';
```

#### 3.3 字典配置
- 备件类型：1易损件 2标准件 3专用件
- 预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒
- 预警级别：1低 2中 3高
- 预警状态：1待处理 2已处理 3已忽略

#### 3.4 前端页面
- 备件管理主页面 (基于ERP产品管理扩展)
- 库存管理弹窗 (库存信息、记录、调整)
- 预警管理弹窗 (预警列表、设置、处理)

#### 3.5 后端服务
- 扩展ERP Product实体类，添加备件特有字段
- 创建备件设备关联Service
- 创建备件预警Service (支持定时任务)

#### 3.6 测试数据
已提供备件分类、产品、库存、设备关联、预警记录的测试数据。

## 四、开发进度总结

### 已完成模块
1. ✅ **生产计划管理** - 生产计划制定、执行、监控
2. ✅ **生产日报管理** - 日报填报、审核、统计
3. ✅ **班制与班次管理** - 班制设置、班次管理
4. ✅ **排班管理** - 排班计划、人员安排
5. ✅ **设备档案管理** - 设备分类、档案、二维码
6. ✅ **备件管理** - 基于ERP扩展的备件库存预警管理

### 推荐下一个开发模块
**维护管理模块** - 设备维护计划、维护记录、维护提醒sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '调度员', '1', 'position_type', 0, '1', NOW(), '1', NOW()),
(2, '操作工', '2', 'position_type', 0, '1', NOW(), '1', NOW()),
(3, '检修工', '3', 'position_type', 0, '1', NOW(), '1', NOW()),
(4, '安全员', '4', 'position_type', 0, '1', NOW(), '1', NOW()),
(5, '质检员', '5', 'position_type', 0, '1', NOW(), '1', NOW());

-- 班制类型字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('班制类型', 'shift_system_type', 0, '班制类型', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待排班', '1', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(2, '已排班', '2', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(3, '已确认', '3', 'schedule_status', 0, '1', NOW(), '1', NOW());
```

#### 1.5 测试数据
已提供班制、班次、排班、人员安排的测试数据。

### 2. 设备档案管理 ✅ **已完成**

#### 2.1 功能概述
设备档案管理模块用于管理选煤厂所有设备的详细信息，包括设备基本信息、技术参数、维护记录等。

#### 2.2 数据库设计

##### 2.2.1 设备分类表 (树表)
```sql
CREATE TABLE `coal_equipment_category` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '分类ID',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父分类ID (0=根分类)',
    `category_name` VARCHAR(50) NOT NULL COMMENT '分类名称',
    `category_code` VARCHAR(20) NOT NULL COMMENT '分类编码',
    `category_level` TINYINT NOT NULL DEFAULT 1 COMMENT '分类层级：1系统 2子系统 3设备类型',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_parent_id` (`parent_id`) USING BTREE,
    INDEX `idx_category_code` (`category_code`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备分类表 (树表)';
```

##### 2.2.2 设备档案表
```sql
CREATE TABLE `coal_equipment_info` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '设备ID',
    `equipment_code` VARCHAR(50) NOT NULL COMMENT '设备编号',
    `equipment_name` VARCHAR(100) NOT NULL COMMENT '设备名称',
    `category_id` BIGINT NOT NULL COMMENT '设备分类ID',
    `parent_equipment_id` BIGINT DEFAULT 0 COMMENT '父设备ID (支持设备层级)',
    `model` VARCHAR(100) DEFAULT NULL COMMENT '设备型号',
    `manufacturer` VARCHAR(100) DEFAULT NULL COMMENT '制造厂商',
    `manufacture_date` DATE DEFAULT NULL COMMENT '制造日期',
    `install_date` DATE DEFAULT NULL COMMENT '安装日期',
    `commission_date` DATE DEFAULT NULL COMMENT '投产日期',
    `asset_number` VARCHAR(50) DEFAULT NULL COMMENT '资产编号',
    `rated_power` DECIMAL(10,2) DEFAULT NULL COMMENT '额定功率(kW)',
    `rated_capacity` DECIMAL(10,2) DEFAULT NULL COMMENT '额定处理能力(t/h)',
    `weight` DECIMAL(10,2) DEFAULT NULL COMMENT '设备重量(t)',
    `dimensions` VARCHAR(100) DEFAULT NULL COMMENT '外形尺寸(长x宽x高)',
    `voltage_level` VARCHAR(20) DEFAULT NULL COMMENT '电压等级',
    `protection_level` VARCHAR(20) DEFAULT NULL COMMENT '防护等级',
    `workshop` VARCHAR(100) DEFAULT NULL COMMENT '所属车间',
    `location` VARCHAR(200) DEFAULT NULL COMMENT '安装位置',
    `coordinate_x` DECIMAL(10,6) DEFAULT NULL COMMENT 'X坐标',
    `coordinate_y` DECIMAL(10,6) DEFAULT NULL COMMENT 'Y坐标',
    `equipment_status` TINYINT NOT NULL DEFAULT 1 COMMENT '设备状态：1正常 2故障 3检修 4停用 5报废',
    `health_level` TINYINT NOT NULL DEFAULT 1 COMMENT '健康等级：1优良 2良好 3注意 4异常 5危险',
    `importance_level` TINYINT NOT NULL DEFAULT 3 COMMENT '重要度：1关键 2重要 3一般',
    `responsible_person_id` BIGINT DEFAULT NULL COMMENT '责任人ID',
    `maintenance_person_id` BIGINT DEFAULT NULL COMMENT '维护人ID',
    `operator_person_id` BIGINT DEFAULT NULL COMMENT '操作人ID',
    `qr_code` VARCHAR(10000) DEFAULT NULL COMMENT '二维码内容',
    `qr_code_url` VARCHAR(500) DEFAULT NULL COMMENT '二维码图片URL',
    `manual_url` VARCHAR(500) DEFAULT NULL COMMENT '说明书文件URL',
    `drawing_url` VARCHAR(500) DEFAULT NULL COMMENT '图纸文件URL',
    `supplier` VARCHAR(100) DEFAULT NULL COMMENT '供应商',
    `purchase_date` DATE DEFAULT NULL COMMENT '采购日期',
    `purchase_price` DECIMAL(12,2) DEFAULT NULL COMMENT '采购价格',
    `warranty_period` INT DEFAULT NULL COMMENT '保修期(月)',
    `warranty_expire_date` DATE DEFAULT NULL COMMENT '保修到期日期',
    `remark` TEXT COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_equipment_code` (`equipment_code`,`deleted`) USING BTREE,
    INDEX `idx_category` (`category_id`) USING BTREE,
    INDEX `idx_parent_equipment` (`parent_equipment_id`) USING BTREE,
    INDEX `idx_equipment_status` (`equipment_status`) USING BTREE,
    INDEX `idx_responsible_person` (`responsible_person_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备档案表';
```

#### 2.3 字典配置
- 设备状态：1正常 2故障 3检修 4停用 5报废
- 健康等级：1优良 2良好 3注意 4异常 5危险  
- 重要程度：1关键 2重要 3一般

#### 2.4 前端页面
- 设备分类管理 (树表)
- 设备档案管理 (支持二维码生成)
- 设备信息表单 (支持文件上传)

#### 2.5 测试数据
已提供设备分类和设备档案的测试数据。

### 3. 备件管理 ✅ **已完成**

#### 3.1 功能概述
备件管理模块基于ERP产品管理模块扩展，用于管理选煤厂设备备件的库存、预警、更换等。

#### 3.2 数据库设计

##### 3.2.1 扩展ERP产品表
在现有`erp_product`表基础上添加备件特有字段：
```sql
ALTER TABLE `erp_product` ADD COLUMN `equipment_id` BIGINT DEFAULT NULL COMMENT '关联设备ID';
ALTER TABLE `erp_product` ADD COLUMN `spare_part_type` TINYINT DEFAULT NULL COMMENT '备件类型：1易损件 2标准件 3专用件';
ALTER TABLE `erp_product` ADD COLUMN `min_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最低库存预警数量';
ALTER TABLE `erp_product` ADD COLUMN `max_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最高库存数量';
ALTER TABLE `erp_product` ADD COLUMN `safety_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '安全库存数量';
ALTER TABLE `erp_product` ADD COLUMN `supplier_id` BIGINT DEFAULT NULL COMMENT '供应商ID';
ALTER TABLE `erp_product` ADD COLUMN `replacement_cycle` INT DEFAULT NULL COMMENT '更换周期(天)';
ALTER TABLE `erp_product` ADD COLUMN `last_replacement_date` DATE DEFAULT NULL COMMENT '最后更换日期';
ALTER TABLE `erp_product` ADD COLUMN `next_replacement_date` DATE DEFAULT NULL COMMENT '下次更换日期';
```

##### 3.2.2 备件设备关联表
```sql
CREATE TABLE `coal_spare_part_equipment` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关联ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `equipment_id` BIGINT NOT NULL COMMENT '设备ID',
    `usage_count` INT NOT NULL DEFAULT 0 COMMENT '使用数量',
    `is_required` TINYINT NOT NULL DEFAULT 1 COMMENT '是否必需：1必需 0非必需',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_spare_part_equipment` (`spare_part_id`, `equipment_id`, `deleted`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_equipment` (`equipment_id`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件设备关联表';
```

##### 3.2.3 备件预警记录表
```sql
CREATE TABLE `coal_spare_part_alert` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '预警ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID',
    `alert_type` TINYINT NOT NULL COMMENT '预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒',
    `current_stock` DECIMAL(10,2) NOT NULL COMMENT '当前库存',
    `threshold_value` DECIMAL(10,2) NOT NULL COMMENT '阈值',
    `alert_level` TINYINT NOT NULL DEFAULT 1 COMMENT '预警级别：1低 2中 3高',
    `alert_status` TINYINT NOT NULL DEFAULT 1 COMMENT '预警状态：1待处理 2已处理 3已忽略',
    `alert_message` VARCHAR(500) NOT NULL COMMENT '预警信息',
    `handler_id` BIGINT DEFAULT NULL COMMENT '处理人ID',
    `handle_time` DATETIME DEFAULT NULL COMMENT '处理时间',
    `handle_remark` VARCHAR(500) DEFAULT NULL COMMENT '处理备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_warehouse` (`warehouse_id`) USING BTREE,
    INDEX `idx_alert_type` (`alert_type`) USING BTREE,
    INDEX `idx_alert_status` (`alert_status`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件预警记录表';
```

#### 3.3 字典配置
- 备件类型：1易损件 2标准件 3专用件
- 预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒
- 预警级别：1低 2中 3高
- 预警状态：1待处理 2已处理 3已忽略

#### 3.4 前端页面
- 备件管理主页面 (基于ERP产品管理扩展)
- 库存管理弹窗 (库存信息、记录、调整)
- 预警管理弹窗 (预警列表、设置、处理)

#### 3.5 后端服务
- 扩展ERP Product实体类，添加备件特有字段
- 创建备件设备关联Service
- 创建备件预警Service (支持定时任务)

#### 3.6 测试数据
已提供备件分类、产品、库存、设备关联、预警记录的测试数据。

## 四、开发进度总结

### 已完成模块
1. ✅ **生产计划管理** - 生产计划制定、执行、监控
2. ✅ **生产日报管理** - 日报填报、审核、统计
3. ✅ **班制与班次管理** - 班制设置、班次管理
4. ✅ **排班管理** - 排班计划、人员安排
5. ✅ **设备档案管理** - 设备分类、档案、二维码
6. ✅ **备件管理** - 基于ERP扩展的备件库存预警管理

### 推荐下一个开发模块
**维护管理模块** - 设备维护计划、维护记录、维护提醒sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '三班两倒', '1', 'shift_system_type', 0, '1', NOW(), '1', NOW()),
(2, '四班三倒', '2', 'shift_system_type', 0, '1', NOW(), '1', NOW()),
(3, '两班倒', '3', 'shift_system_type', 0, '1', NOW(), '1', NOW()),
(4, '长白班', '4', 'shift_system_type', 0, '1', NOW(), '1', NOW());

-- 排班状态字典
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES 
('排班状态', 'schedule_status', 0, '排班状态', '1', NOW(), '1', NOW(), 0);

INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, '待排班', '1', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(2, '已排班', '2', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(3, '已确认', '3', 'schedule_status', 0, '1', NOW(), '1', NOW());
```

#### 1.5 测试数据
已提供班制、班次、排班、人员安排的测试数据。

### 2. 设备档案管理 ✅ **已完成**

#### 2.1 功能概述
设备档案管理模块用于管理选煤厂所有设备的详细信息，包括设备基本信息、技术参数、维护记录等。

#### 2.2 数据库设计

##### 2.2.1 设备分类表 (树表)
```sql
CREATE TABLE `coal_equipment_category` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '分类ID',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT '父分类ID (0=根分类)',
    `category_name` VARCHAR(50) NOT NULL COMMENT '分类名称',
    `category_code` VARCHAR(20) NOT NULL COMMENT '分类编码',
    `category_level` TINYINT NOT NULL DEFAULT 1 COMMENT '分类层级：1系统 2子系统 3设备类型',
    `sort` INT NOT NULL DEFAULT 0 COMMENT '排序',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT '状态：0禁用 1启用',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_parent_id` (`parent_id`) USING BTREE,
    INDEX `idx_category_code` (`category_code`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备分类表 (树表)';
```

##### 2.2.2 设备档案表
```sql
CREATE TABLE `coal_equipment_info` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '设备ID',
    `equipment_code` VARCHAR(50) NOT NULL COMMENT '设备编号',
    `equipment_name` VARCHAR(100) NOT NULL COMMENT '设备名称',
    `category_id` BIGINT NOT NULL COMMENT '设备分类ID',
    `parent_equipment_id` BIGINT DEFAULT 0 COMMENT '父设备ID (支持设备层级)',
    `model` VARCHAR(100) DEFAULT NULL COMMENT '设备型号',
    `manufacturer` VARCHAR(100) DEFAULT NULL COMMENT '制造厂商',
    `manufacture_date` DATE DEFAULT NULL COMMENT '制造日期',
    `install_date` DATE DEFAULT NULL COMMENT '安装日期',
    `commission_date` DATE DEFAULT NULL COMMENT '投产日期',
    `asset_number` VARCHAR(50) DEFAULT NULL COMMENT '资产编号',
    `rated_power` DECIMAL(10,2) DEFAULT NULL COMMENT '额定功率(kW)',
    `rated_capacity` DECIMAL(10,2) DEFAULT NULL COMMENT '额定处理能力(t/h)',
    `weight` DECIMAL(10,2) DEFAULT NULL COMMENT '设备重量(t)',
    `dimensions` VARCHAR(100) DEFAULT NULL COMMENT '外形尺寸(长x宽x高)',
    `voltage_level` VARCHAR(20) DEFAULT NULL COMMENT '电压等级',
    `protection_level` VARCHAR(20) DEFAULT NULL COMMENT '防护等级',
    `workshop` VARCHAR(100) DEFAULT NULL COMMENT '所属车间',
    `location` VARCHAR(200) DEFAULT NULL COMMENT '安装位置',
    `coordinate_x` DECIMAL(10,6) DEFAULT NULL COMMENT 'X坐标',
    `coordinate_y` DECIMAL(10,6) DEFAULT NULL COMMENT 'Y坐标',
    `equipment_status` TINYINT NOT NULL DEFAULT 1 COMMENT '设备状态：1正常 2故障 3检修 4停用 5报废',
    `health_level` TINYINT NOT NULL DEFAULT 1 COMMENT '健康等级：1优良 2良好 3注意 4异常 5危险',
    `importance_level` TINYINT NOT NULL DEFAULT 3 COMMENT '重要度：1关键 2重要 3一般',
    `responsible_person_id` BIGINT DEFAULT NULL COMMENT '责任人ID',
    `maintenance_person_id` BIGINT DEFAULT NULL COMMENT '维护人ID',
    `operator_person_id` BIGINT DEFAULT NULL COMMENT '操作人ID',
    `qr_code` VARCHAR(10000) DEFAULT NULL COMMENT '二维码内容',
    `qr_code_url` VARCHAR(500) DEFAULT NULL COMMENT '二维码图片URL',
    `manual_url` VARCHAR(500) DEFAULT NULL COMMENT '说明书文件URL',
    `drawing_url` VARCHAR(500) DEFAULT NULL COMMENT '图纸文件URL',
    `supplier` VARCHAR(100) DEFAULT NULL COMMENT '供应商',
    `purchase_date` DATE DEFAULT NULL COMMENT '采购日期',
    `purchase_price` DECIMAL(12,2) DEFAULT NULL COMMENT '采购价格',
    `warranty_period` INT DEFAULT NULL COMMENT '保修期(月)',
    `warranty_expire_date` DATE DEFAULT NULL COMMENT '保修到期日期',
    `remark` TEXT COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_equipment_code` (`equipment_code`,`deleted`) USING BTREE,
    INDEX `idx_category` (`category_id`) USING BTREE,
    INDEX `idx_parent_equipment` (`parent_equipment_id`) USING BTREE,
    INDEX `idx_equipment_status` (`equipment_status`) USING BTREE,
    INDEX `idx_responsible_person` (`responsible_person_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '设备档案表';
```

#### 2.3 字典配置
- 设备状态：1正常 2故障 3检修 4停用 5报废
- 健康等级：1优良 2良好 3注意 4异常 5危险  
- 重要程度：1关键 2重要 3一般

#### 2.4 前端页面
- 设备分类管理 (树表)
- 设备档案管理 (支持二维码生成)
- 设备信息表单 (支持文件上传)

#### 2.5 测试数据
已提供设备分类和设备档案的测试数据。

### 3. 备件管理 ✅ **已完成**

#### 3.1 功能概述
备件管理模块基于ERP产品管理模块扩展，用于管理选煤厂设备备件的库存、预警、更换等。

#### 3.2 数据库设计

##### 3.2.1 扩展ERP产品表
在现有`erp_product`表基础上添加备件特有字段：
```sql
ALTER TABLE `erp_product` ADD COLUMN `equipment_id` BIGINT DEFAULT NULL COMMENT '关联设备ID';
ALTER TABLE `erp_product` ADD COLUMN `spare_part_type` TINYINT DEFAULT NULL COMMENT '备件类型：1易损件 2标准件 3专用件';
ALTER TABLE `erp_product` ADD COLUMN `min_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最低库存预警数量';
ALTER TABLE `erp_product` ADD COLUMN `max_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '最高库存数量';
ALTER TABLE `erp_product` ADD COLUMN `safety_stock` DECIMAL(10,2) DEFAULT NULL COMMENT '安全库存数量';
ALTER TABLE `erp_product` ADD COLUMN `supplier_id` BIGINT DEFAULT NULL COMMENT '供应商ID';
ALTER TABLE `erp_product` ADD COLUMN `replacement_cycle` INT DEFAULT NULL COMMENT '更换周期(天)';
ALTER TABLE `erp_product` ADD COLUMN `last_replacement_date` DATE DEFAULT NULL COMMENT '最后更换日期';
ALTER TABLE `erp_product` ADD COLUMN `next_replacement_date` DATE DEFAULT NULL COMMENT '下次更换日期';
```

##### 3.2.2 备件设备关联表
```sql
CREATE TABLE `coal_spare_part_equipment` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '关联ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `equipment_id` BIGINT NOT NULL COMMENT '设备ID',
    `usage_count` INT NOT NULL DEFAULT 0 COMMENT '使用数量',
    `is_required` TINYINT NOT NULL DEFAULT 1 COMMENT '是否必需：1必需 0非必需',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_spare_part_equipment` (`spare_part_id`, `equipment_id`, `deleted`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_equipment` (`equipment_id`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件设备关联表';
```

##### 3.2.3 备件预警记录表
```sql
CREATE TABLE `coal_spare_part_alert` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '预警ID',
    `spare_part_id` BIGINT NOT NULL COMMENT '备件ID',
    `warehouse_id` BIGINT NOT NULL COMMENT '仓库ID',
    `alert_type` TINYINT NOT NULL COMMENT '预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒',
    `current_stock` DECIMAL(10,2) NOT NULL COMMENT '当前库存',
    `threshold_value` DECIMAL(10,2) NOT NULL COMMENT '阈值',
    `alert_level` TINYINT NOT NULL DEFAULT 1 COMMENT '预警级别：1低 2中 3高',
    `alert_status` TINYINT NOT NULL DEFAULT 1 COMMENT '预警状态：1待处理 2已处理 3已忽略',
    `alert_message` VARCHAR(500) NOT NULL COMMENT '预警信息',
    `handler_id` BIGINT DEFAULT NULL COMMENT '处理人ID',
    `handle_time` DATETIME DEFAULT NULL COMMENT '处理时间',
    `handle_remark` VARCHAR(500) DEFAULT NULL COMMENT '处理备注',
    `creator` VARCHAR(64) DEFAULT '' COMMENT '创建者',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updater` VARCHAR(64) DEFAULT '' COMMENT '更新者',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT '是否删除',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT '租户编号',
    PRIMARY KEY (`id`) USING BTREE,
    INDEX `idx_spare_part` (`spare_part_id`) USING BTREE,
    INDEX `idx_warehouse` (`warehouse_id`) USING BTREE,
    INDEX `idx_alert_type` (`alert_type`) USING BTREE,
    INDEX `idx_alert_status` (`alert_status`) USING BTREE
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = '备件预警记录表';
```

#### 3.3 字典配置
- 备件类型：1易损件 2标准件 3专用件
- 预警类型：1库存不足 2库存过多 3更换提醒 4过期提醒
- 预警级别：1低 2中 3高
- 预警状态：1待处理 2已处理 3已忽略

#### 3.4 前端页面
- 备件管理主页面 (基于ERP产品管理扩展)
- 库存管理弹窗 (库存信息、记录、调整)
- 预警管理弹窗 (预警列表、设置、处理)

#### 3.5 后端服务
- 扩展ERP Product实体类，添加备件特有字段
- 创建备件设备关联Service
- 创建备件预警Service (支持定时任务)

#### 3.6 测试数据
已提供备件分类、产品、库存、设备关联、预警记录的测试数据。

## 四、开发进度总结

### 已完成模块
1. ✅ **生产计划管理** - 生产计划制定、执行、监控
2. ✅ **生产日报管理** - 日报填报、审核、统计
3. ✅ **班制与班次管理** - 班制设置、班次管理
4. ✅ **排班管理** - 排班计划、人员安排
5. ✅ **设备档案管理** - 设备分类、档案、二维码
6. ✅ **备件管理** - 基于ERP扩展的备件库存预警管理
7. ✅ **检修管理** - 检修计划、报修单、检修单、备件使用记录
8. ✅ **煤质管理** - 质量检测项目、质量标准、检测记录、检测数据、预警管理

### 推荐下一个开发模块
**安全管理模块** - 安全检查、隐患排查、事故管理

## 四、煤质管理模块设计

### 4.1 模块概述
煤质管理模块是选煤厂生产管理系统的核心模块，负责管理煤炭产品的质量检测、标准制定、数据分析和预警处理等全流程业务。该模块确保煤炭产品质量符合国家标准和客户要求，为生产决策提供数据支持。

### 4.2 数据库设计
包含5个核心表：质量检测项目表（单表）、质量标准表（单表）、质量检测记录表（主表）、质量检测数据表（子表）、质量预警记录表（单表）。

### 4.3 业务流程设计
1. **基础数据准备**：维护检测项目 → 制定质量标准 → 标准审批 → 标准发布
2. **检测执行**：创建检测记录 → 选择检测项目 → 录入检测数据 → 自动计算判断 → 复检处理
3. **审核确认**：接收审核任务 → 检查检测数据 → 审核决策 → 记录生效
4. **预警处理**：预警条件检查 → 生成预警记录 → 分配处理人 → 执行处理措施

### 4.4 技术实现
- 前端：Vue 3 + TypeScript + Element Plus，支持主子表结构
- 后端：Spring Boot + MyBatis-Plus，支持审批流程和自动预警
- 数据库：MySQL，支持复杂关联查询和状态管理

### 4.5 业务文档
- 煤质管理模块业务逻辑设计.md - 详细的业务逻辑说明
- 煤质管理模块业务流程图.md - 可视化业务流程