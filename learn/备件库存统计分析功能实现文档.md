# 备件库存统计分析功能实现文档

## 📋 功能概述

备件库存统计分析功能是一个综合性的数据分析和可视化系统，为备件管理提供全面的数据支持和决策依据。该功能通过多维度统计分析，帮助管理人员实时了解库存状况，优化库存管理策略。

## 🎯 功能目标

1. **实时监控**: 实时监控备件库存状况，及时发现异常
2. **数据洞察**: 通过多维度分析，提供深入的库存数据洞察
3. **决策支持**: 为库存管理决策提供科学的数据支持
4. **预警机制**: 识别低库存、超库存、呆滞库存等风险
5. **趋势分析**: 分析库存变化趋势，预测未来需求

## 📊 功能模块

### 1. 库存概览
- **总备件种类数**: 统计系统中备件的总种类数量
- **总库存数量**: 计算所有备件的库存总量
- **总库存价值**: 基于单价计算库存总价值
- **库存健康度评分**: 综合评估库存状况的健康程度

### 2. 预警统计
- **低库存预警**: 库存低于最低库存预警线的备件数量
- **零库存**: 库存为0的备件数量
- **超库存**: 库存超过最高库存的备件数量
- **呆滞库存**: 长期未使用的备件数量

### 3. 分类统计
- **按备件分类统计**: 统计各分类的备件数量、库存数量、库存价值
- **分类占比分析**: 计算各分类在总库存中的占比
- **可视化展示**: 通过饼图展示分类分布

### 4. 趋势分析
- **时间序列数据**: 最近30天的库存变化数据
- **入库趋势**: 入库数量的变化趋势
- **出库趋势**: 出库数量的变化趋势
- **库存趋势**: 库存数量的变化趋势

### 5. ABC分类分析
- **A类备件**: 前20%的高价值备件，占总价值的80%
- **B类备件**: 中间30%的中等价值备件
- **C类备件**: 剩余50%的低价值备件
- **价值占比**: 各类备件的价值占比分析
- **数量占比**: 各类备件的数量占比分析

## 🏗️ 技术架构

### 后端架构
```
Controller Layer (API接口层)
    ↓
Service Layer (业务逻辑层)
    ↓
Mapper Layer (数据访问层)
    ↓
Database (数据库层)
```

### 前端架构
```
Vue3 + TypeScript
    ↓
Element Plus UI组件
    ↓
ECharts图表库
    ↓
Axios HTTP客户端
```

## 📁 文件结构

### 后端文件
```
yudao-module-coal/src/main/java/cn/iocoder/yudao/module/coal/
├── controller/admin/sparepartinfo/
│   ├── SparePartInfoController.java          # 控制器，添加统计API
│   └── vo/
│       └── SparePartStockStatisticsRespVO.java  # 统计响应VO
├── service/sparepartinfo/
│   ├── SparePartInfoService.java             # 服务接口
│   └── SparePartInfoServiceImpl.java         # 服务实现，统计逻辑
└── dal/dataobject/sparepartinfo/
    └── SparePartInfoDO.java                  # 数据对象
```

### 前端文件
```
yudao-ui/yudao-ui-admin-vue3/src/
├── api/coal/sparepartinfo/
│   └── index.ts                              # API接口定义
└── views/coal/sparepartinfo/
    └── statistics.vue                        # 统计页面
```

### 数据库文件
```
sql/mysql/
└── create_spare_part_statistics_menu.sql    # 菜单创建脚本
```

## 🔧 核心实现

### 1. 统计数据结构
```java
public class SparePartStockStatisticsRespVO {
    private StockOverview overview;                    // 库存概览
    private StockAlertStatistics alertStatistics;     // 预警统计
    private List<CategoryStatistics> categoryStatistics; // 分类统计
    private List<TrendData> trendData;                // 趋势数据
    private List<ABCCategoryStatistics> abcStatistics; // ABC分类统计
}
```

### 2. 统计计算逻辑
```java
@Override
public SparePartStockStatisticsRespVO getStockStatistics() {
    // 1. 获取所有备件信息
    List<SparePartInfoDO> allSpareParts = sparePartInfoMapper.selectList();
    
    // 2. 计算各项统计指标
    statistics.setOverview(calculateStockOverview(allSpareParts));
    statistics.setAlertStatistics(calculateAlertStatistics(allSpareParts));
    statistics.setCategoryStatistics(calculateCategoryStatistics(allSpareParts));
    statistics.setTrendData(calculateTrendData());
    statistics.setAbcStatistics(calculateABCStatistics(allSpareParts));
    
    return statistics;
}
```

### 3. 前端图表展示
```typescript
// 使用ECharts展示数据
const initCategoryChart = () => {
    const chart = echarts.init(categoryChart.value)
    const option = {
        title: { text: '库存价值分布' },
        series: [{
            type: 'pie',
            data: categoryData
        }]
    }
    chart.setOption(option)
}
```

## 📈 数据流程

### 1. 数据获取流程
```
用户访问统计页面
    ↓
前端调用API接口
    ↓
后端Service层计算统计
    ↓
查询备件基础信息表
    ↓
查询备件库存记录表
    ↓
计算各项统计指标
    ↓
返回统计结果
    ↓
前端渲染图表
```

### 2. 统计计算流程
```
获取所有备件信息
    ↓
遍历每个备件
    ↓
查询当前库存数量
    ↓
计算库存价值
    ↓
判断库存状态（正常/低库存/超库存/零库存）
    ↓
按分类汇总统计
    ↓
计算ABC分类
    ↓
生成趋势数据
    ↓
返回完整统计结果
```

## 🎨 界面设计

### 1. 布局结构
- **顶部概览卡片**: 4个关键指标卡片
- **预警统计卡片**: 4个预警状态卡片
- **图表区域**: 2x2网格布局的图表
- **趋势图表**: 全宽的趋势分析图表

### 2. 视觉设计
- **卡片样式**: 圆角卡片，渐变背景
- **图标设计**: 语义化图标，颜色区分
- **图表配色**: 统一的配色方案
- **响应式布局**: 适配不同屏幕尺寸

## 🔐 权限控制

### 1. 菜单权限
```sql
-- 主菜单
INSERT INTO system_menu (id, name, permission, type, sort, parent_id, path, icon, component, component_name, status, visible, keep_alive, always_show, creator, create_time, updater, update_time, deleted)
VALUES (2100, '库存统计分析', '', 1, 4, 2000, 'statistics', 'chart', 'coal/sparepartinfo/statistics', 'SparePartStatistics', 0, b'1', b'1', b'1', '1', NOW(), '1', NOW(), b'0');

-- 功能权限
INSERT INTO system_menu (id, name, permission, type, sort, parent_id, path, icon, component, component_name, status, visible, keep_alive, always_show, creator, create_time, updater, update_time, deleted)
VALUES (2101, '库存统计查看', 'coal:spare-part-info:statistics', 3, 1, 2100, '', '', '', '', 0, b'1', b'1', b'1', '1', NOW(), '1', NOW(), b'0');
```

### 2. 接口权限
```java
@PreAuthorize("@ss.hasPermission('coal:spare-part-info:query')")
public CommonResult<SparePartStockStatisticsRespVO> getStockStatistics()
```

## 📊 性能优化

### 1. 数据查询优化
- 使用批量查询减少数据库访问次数
- 合理使用索引提高查询效率
- 避免N+1查询问题

### 2. 计算优化
- 使用Stream API进行数据处理
- 合理使用缓存机制
- 异步计算非关键指标

### 3. 前端优化
- 图表懒加载
- 数据分页加载
- 防抖处理用户操作

## 🚀 部署说明

### 1. 后端部署
1. 编译后端代码
2. 确保数据库连接正常
3. 启动Spring Boot应用
4. 验证API接口可访问

### 2. 前端部署
1. 安装依赖: `npm install`
2. 构建项目: `npm run build`
3. 部署到Web服务器
4. 配置API接口地址

### 3. 数据库配置
1. 执行菜单创建脚本
2. 确保备件相关表数据完整
3. 验证权限配置正确

## 🔍 故障排查

### 1. 常见问题
- **API调用失败**: 检查权限配置和接口地址
- **数据不准确**: 检查库存数据完整性
- **图表不显示**: 检查ECharts依赖和配置
- **权限不足**: 检查用户角色和权限分配

### 2. 调试方法
- 查看后端日志
- 使用浏览器开发者工具
- 检查网络请求状态
- 验证数据库数据

## 📝 使用说明

### 1. 访问方式
- 菜单路径: 备件管理 → 库存统计分析
- 直接访问: `/coal/sparepartinfo/statistics`

### 2. 操作说明
- **数据刷新**: 点击图表右上角的"刷新"按钮
- **图表交互**: 鼠标悬停查看详细数据
- **数据导出**: 支持Excel导出（待实现）

### 3. 数据解读
- **健康度评分**: 0-100分，分数越高表示库存状况越好
- **ABC分类**: 基于帕累托原理的价值分析
- **趋势分析**: 帮助预测未来库存需求

## 🔮 未来扩展

### 1. 功能扩展
- 库存预测分析
- 采购建议算法
- 成本优化分析
- 供应商绩效分析

### 2. 技术优化
- 实时数据推送
- 大数据分析
- 机器学习预测
- 移动端适配

## 📞 技术支持

如有问题，请联系开发团队或查看相关文档：
- 技术文档: `/learn/` 目录
- 代码仓库: 项目根目录
- 问题反馈: 通过项目管理系统

---

**文档版本**: v1.0  
**创建时间**: 2025-01-09  
**最后更新**: 2025-01-09  
**维护人员**: 开发团队
