# é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº²

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºèŠ‹é“å¼€æºæ¡†æ¶å¼€å‘çš„é€‰ç…¤å‚æ™ºèƒ½ç”Ÿäº§ç®¡æ§ç³»ç»Ÿï¼Œå®ç°ç”Ÿäº§è°ƒåº¦ã€è®¾å¤‡ç®¡ç†ã€ç…¤è´¨ç®¡ç†ã€å®‰å…¨ç®¡ç†ç­‰å…¨æµç¨‹æ•°å­—åŒ–ç®¡ç†ã€‚ç³»ç»Ÿé‡‡ç”¨æ ‡å‡†æ•°æ®åº“è®¾è®¡ï¼Œæ•°æ®æ ‡å‡†æŒ‡å¯¼åç»­å„ç§é€‰ç…¤æ™ºèƒ½åŒ–æ–°æŠ€æœ¯å¼€å‘ï¼Œç¡®ä¿é€‰ç…¤ä¿¡æ¯"ä¸€æ¬¡è¾“å…¥ï¼Œå…¨å±€å…±äº«"ï¼Œæé«˜æ•°æ®çš„çœŸå®æ€§å’Œå”¯ä¸€æ€§ã€‚

### æŠ€æœ¯æ¶æ„
- **åç«¯**ï¼šSpring Boot + MyBatis-Plus + SQL Server
- **å‰ç«¯**ï¼šVue 3 + TypeScript + Element Plus
- **æ¡†æ¶**ï¼šèŠ‹é“å¼€æºæ¡†æ¶ (ruoyi-vue-pro)
- **æ•°æ®åº“**ï¼šMySQL 8.0+ï¼ˆæ”¯æŒJSONæ•°æ®ç±»å‹ï¼Œå­˜å‚¨åŠç»“æ„åŒ–æ•°æ®ï¼‰
- **éƒ¨ç½²**ï¼šDocker + Nginx
- **é›†æˆ**ï¼šPLCæ•°æ®é‡‡é›†ã€OPC UAã€MQTTåè®®æ”¯æŒ

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ¨¡å—åˆ’åˆ†

```
yudao-module-coal/                    # é€‰ç…¤å‚æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ production/                       # ç”Ÿäº§è°ƒåº¦ç®¡ç†
â”œâ”€â”€ equipment/                        # è®¾å¤‡æ¡£æ¡ˆç®¡ç†  
â”œâ”€â”€ quality/                          # ç…¤è´¨ç®¡ç†
â”œâ”€â”€ safety/                          # å®‰å…¨ç®¡ç†
â”œâ”€â”€ energy/                          # èƒ½æºç®¡ç†
â”œâ”€â”€ report/                          # æŠ¥è¡¨ç»Ÿè®¡
â””â”€â”€ common/                          # å…¬å…±ç»„ä»¶
```

### æ•°æ®åº“è®¾è®¡åŸåˆ™
- é‡‡ç”¨ MySQL 8.0+ æ•°æ®åº“ï¼Œæ”¯æŒJSONæ•°æ®ç±»å‹å­˜å‚¨åŠç»“æ„åŒ–æ•°æ®
- éµå¾ªç¬¬ä¸‰èŒƒå¼è®¾è®¡ï¼Œç¡®ä¿æ•°æ®æ ‡å‡†åŒ–
- æ”¯æŒå¤šç§Ÿæˆ·æ¶æ„ï¼Œæ•°æ®éš”ç¦»å®‰å…¨
- é¢„ç•™æ‰©å±•å­—æ®µï¼Œæ”¯æŒåç»­åŠŸèƒ½æ‰©å±•
- å»ºç«‹å®Œæ•´çš„ç´¢å¼•ä½“ç³»ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- æ•°æ®æ ‡å‡†ç»Ÿä¸€ï¼Œæ”¯æŒ"ä¸€æ¬¡è¾“å…¥ï¼Œå…¨å±€å…±äº«"

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡è¯¦è§£

### 1. ç”Ÿäº§è°ƒåº¦ç®¡ç†æ¨¡å—

#### 1.1 ç”Ÿäº§è®¡åˆ’è¡¨ (coal_production_plan) - æ ‘è¡¨ç»“æ„
```sql
DROP TABLE IF EXISTS `coal_production_plan`;
CREATE TABLE `coal_production_plan` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è®¡åˆ’ID',
    `name` VARCHAR(100) NOT NULL COMMENT 'è®¡åˆ’åç§°',
    `parent_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'çˆ¶è®¡åˆ’ID',
    `sort` INT NOT NULL DEFAULT 0 COMMENT 'æ˜¾ç¤ºé¡ºåº',
    `plan_code` VARCHAR(50) NOT NULL DEFAULT '' COMMENT 'è®¡åˆ’ç¼–å·',
    `plan_type` TINYINT NOT NULL COMMENT 'è®¡åˆ’ç±»å‹ï¼š1å¹´åº¦ 2æœˆåº¦ 3æ—¥è®¡åˆ’ 4ç­è®¡åˆ’',
    `plan_year` INT NULL COMMENT 'è®¡åˆ’å¹´åº¦',
    `plan_month` TINYINT NULL COMMENT 'è®¡åˆ’æœˆä»½',
    `plan_date` DATE NULL COMMENT 'è®¡åˆ’æ—¥æœŸ',
    `shift_id` BIGINT NULL COMMENT 'ç­æ¬¡ID',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT 'è®¡åˆ’çŠ¶æ€ï¼š0åœç”¨ 1æ­£å¸¸',
    plan_path VARCHAR(500) COMMENT 'è®¡åˆ’å±‚çº§è·¯å¾„ï¼ˆå¦‚ï¼š1/2/3è¡¨ç¤ºå¹´/æœˆ/æ—¥ï¼‰',

    -- è®¡åˆ’äº§é‡æ•°æ®ï¼ˆåŸºç¡€ï¼‰
    `raw_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’å…¥æ´—åŸç…¤é‡(å¨)',

    -- ç²¾ç…¤äº§é‡è®¡åˆ’ï¼ˆæŒ‰ç²’åº¦åˆ†ç±»ï¼‰
    `fine_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’æœ«ç…¤äº§é‡(å¨)',
    `granular_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’ç²’ç…¤äº§é‡(å¨)',
    `large_block_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’å¤§å—ç…¤äº§é‡(å¨)',
    `medium_block_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’ä¸­å—ç…¤äº§é‡(å¨)',
    `small_block_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’å°å—ç…¤äº§é‡(å¨)',

    -- å…¶ä»–äº§å“è®¡åˆ’äº§é‡
    `middling_coal_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’ä¸­ç…¤äº§é‡(å¨)',
    `slime_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’ç…¤æ³¥äº§é‡(å¨)',
    `gangue_plan` DECIMAL(10,2) NULL COMMENT 'è®¡åˆ’çŸ¸çŸ³äº§é‡(å¨)',

    -- é¢„ç•™è®¡åˆ’äº§é‡å­—æ®µ
    `reserved_product_plan1` DECIMAL(10,2) NULL COMMENT 'é¢„ç•™è®¡åˆ’äº§é‡å­—æ®µ1(å¨)',
    `reserved_product_plan2` DECIMAL(10,2) NULL COMMENT 'é¢„ç•™è®¡åˆ’äº§é‡å­—æ®µ2(å¨)',

    -- è´¨é‡æŒ‡æ ‡
    `fine_coal_ash` DECIMAL(5,2) NULL COMMENT 'æœ«ç…¤ç°åˆ†(%)',
    `granular_coal_ash` DECIMAL(5,2) NULL COMMENT 'ç²’ç…¤ç°åˆ†(%)',
    `large_block_coal_ash` DECIMAL(5,2) NULL COMMENT 'å¤§å—ç…¤ç°åˆ†(%)',
    `medium_block_coal_ash` DECIMAL(5,2) NULL COMMENT 'ä¸­å—ç…¤ç°åˆ†(%)',
    `small_block_coal_ash` DECIMAL(5,2) NULL COMMENT 'å°å—ç…¤ç°åˆ†(%)',
    `middling_coal_ash` DECIMAL(5,2) NULL COMMENT 'ä¸­ç…¤ç°åˆ†(%)',

    -- å®¡æ‰¹ä¿¡æ¯
    `creator_id` BIGINT NULL COMMENT 'åˆ¶å®šäººID',
    `approver_id` BIGINT NULL COMMENT 'å®¡æ‰¹äººID',
    `approve_time` DATETIME NULL COMMENT 'å®¡æ‰¹æ—¶é—´',

    -- åŸºç¡€å­—æ®µï¼ˆèŠ‹é“æ¡†æ¶æ ‡å‡†ï¼‰
    `creator` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updater` VARCHAR(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ç¼–å·',
    PRIMARY KEY (`id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci COMMENT = 'ç”Ÿäº§è®¡åˆ’è¡¨ï¼ˆæ ‘è¡¨ç»“æ„ï¼‰';
```
å…¶ä¸­ç”¨åˆ°çš„å­—å…¸ï¼šè®¡åˆ’å±‚çº§å’Œè®¡åˆ’çŠ¶æ€ã€‚

![image-20250820160535987](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250820160535987.png)

![](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250820160550262.png)

```sql

INSERT INTO `ruoyi-vue-pro`.system_dict_type
(id, name, `type`, status, remark, creator, create_time, updater, update_time, deleted, deleted_time)
VALUES(2000, 'è®¡åˆ’å±‚çº§', 'plan_level', 0, 'ç”Ÿäº§è®¡åˆ’å±‚çº§', '1', '2025-08-20 16:01:18', '1', '2025-08-20 16:01:18', 0, '1970-01-01 00:00:00');
INSERT INTO `ruoyi-vue-pro`.system_dict_type
(id, name, `type`, status, remark, creator, create_time, updater, update_time, deleted, deleted_time)
VALUES(2001, 'è®¡åˆ’çŠ¶æ€', 'plan_status', 0, '', '1', '2025-08-20 16:04:06', '1', '2025-08-20 16:04:06', 0, '1970-01-01 00:00:00');



INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3003, 0, 'å¹´åº¦', '1', 'plan_level', 0, '', '', '', '1', '2025-08-20 16:01:49', '1', '2025-08-20 16:01:49', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3004, 2, 'æœˆåº¦', '2', 'plan_level', 0, '', '', '', '1', '2025-08-20 16:02:03', '1', '2025-08-20 16:02:03', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3005, 3, 'æ—¥è®¡åˆ’', '3', 'plan_level', 0, '', '', '', '1', '2025-08-20 16:02:18', '1', '2025-08-20 16:02:18', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3006, 4, 'ç­è®¡åˆ’', '4', 'plan_level', 0, '', '', '', '1', '2025-08-20 16:02:26', '1', '2025-08-20 16:06:31', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3007, 1, 'å¾…å®Œæˆ', '1', 'plan_status', 0, '', '', '', '1', '2025-08-20 16:04:28', '1', '2025-08-20 16:04:28', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3008, 2, 'æ‰§è¡Œä¸­', '2', 'plan_status', 0, '', '', '', '1', '2025-08-20 16:04:39', '1', '2025-08-20 16:04:39', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3009, 3, 'å·²å®Œæˆ', '3', 'plan_status', 0, '', '', '', '1', '2025-08-20 16:04:47', '1', '2025-08-20 16:04:47', 0);
INSERT INTO `ruoyi-vue-pro`.system_dict_data
(id, sort, label, value, dict_type, status, color_type, css_class, remark, creator, create_time, updater, update_time, deleted)
VALUES(3010, 4, 'å·²å–æ¶ˆ', '4', 'plan_status', 0, '', '', '', '1', '2025-08-20 16:04:53', '1', '2025-08-20 16:04:53', 0);
```

##### æ–°å¢ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’è¡¨å’Œåˆ é™¤å¹´åº¦è¡¨

###### controller

```java
    @PostMapping("/generate-yearly-plan")
    @Operation(summary = "ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’")
    @PreAuthorize("@ss.hasPermission('coal:production-plan:create')")
    public CommonResult<Boolean> generateYearlyPlan(@Valid @RequestBody ProductionPlanSaveReqVO createReqVO) {
        productionPlanService.generateYearlyPlan(createReqVO);
        return success(true);
    }

    @DeleteMapping("/delete-by-year")
    @Operation(summary = "ä¸€é”®åˆ é™¤å¹´åº¦è®¡åˆ’")
    @Parameter(name = "year", description = "å¹´ä»½", required = true, example = "2025")
    @PreAuthorize("@ss.hasPermission('coal:production-plan:delete')")
    public CommonResult<Boolean> deleteProductionPlanByYear(@RequestParam("year") Integer year) {
        productionPlanService.deleteProductionPlanByYear(year);
        return success(true);
    }
    @DeleteMapping("/physical-delete-by-year")
        @Operation(summary = "ç‰©ç†åˆ é™¤å¹´åº¦è®¡åˆ’ï¼ˆè°ƒè¯•ç”¨ï¼‰")
        @Parameter(name = "year", description = "å¹´ä»½", required = true, example = "2025")
        @PreAuthorize("@ss.hasPermission('coal:production-plan:delete')") // æ³¨æ„ï¼šæƒé™ä¿æŒä¸€è‡´
        public CommonResult<Boolean> physicalDeleteProductionPlanByYear(@RequestParam("year") Integer year) {
            productionPlanService.physicalDeleteProductionPlanByYear(year);
            return success(true);
        }
```





###### mapper

```java
    default void deleteByYear(Integer year) {
            delete(new LambdaQueryWrapperX<ProductionPlanDO>()
                    .eq(ProductionPlanDO::getPlanYear, year));
        }

    @Delete("DELETE FROM coal_production_plan WHERE plan_year = #{year}")
    void physicalDeleteByYear(@Param("year") Integer year);
```





###### service

```java
   /**
     * ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’
     *
     * @param createReqVO å¹´åº¦è®¡åˆ’ä¿¡æ¯
     */
    void generateYearlyPlan(@Valid ProductionPlanSaveReqVO createReqVO);

    /**
     * æ ¹æ®å¹´ä»½åˆ é™¤ç”Ÿäº§è®¡åˆ’
     *
     * @param year å¹´ä»½
     */
    void deleteProductionPlanByYear(Integer year);

    /**
     * æ ¹æ®å¹´ä»½ç‰©ç†åˆ é™¤ç”Ÿäº§è®¡åˆ’ï¼ˆè°ƒè¯•ç”¨ï¼‰
     *
     * @param year å¹´ä»½
     */
    void physicalDeleteProductionPlanByYear(Integer year);
```







###### serviceImp

```java
@Override
    @Transactional
    public void generateYearlyPlan(ProductionPlanSaveReqVO createReqVO) {
        // 1. æ’å…¥å¹´åº¦è®¡åˆ’
        ProductionPlanDO yearPlan = BeanUtils.toBean(createReqVO, ProductionPlanDO.class);
        yearPlan.setPlanYear(createReqVO.getPlanYear()); // æ˜¾å¼è®¾ç½®å¹´ä»½ï¼Œç¡®ä¿ä¿å­˜
        productionPlanMapper.insert(yearPlan); // æ’å…¥æ•°æ®åº“ï¼Œä¸ºäº†è·å¾— id

        // 2. æ‰¹é‡æ’å…¥åç»­è®¡åˆ’
        List<ProductionPlanDO> batchList = new ArrayList<>();

        // 2.1 ç”Ÿæˆæœˆåº¦è®¡åˆ’
        for (int i = 1; i <= 12; i++) {
            ProductionPlanDO monthPlan = generateSubPlan(yearPlan, yearPlan.getId(), i + "æœˆ", 12, 2); // planType = 2
            monthPlan.setPlanMonth(i);
            productionPlanMapper.insert(monthPlan); // æ’å…¥æ•°æ®åº“ï¼Œä¸ºäº†è·å¾— id

            // 2.2 ç”Ÿæˆæ—¥è®¡åˆ’
            int daysInMonth = java.time.YearMonth.of(yearPlan.getPlanYear(), i).lengthOfMonth();
            for (int j = 1; j <= daysInMonth; j++) {
                // æ³¨æ„ï¼šé™¤æ•°ä½¿ç”¨è¯¥æœˆçš„å®é™…å¤©æ•°ï¼Œä¿è¯æ—¥è®¡åˆ’åˆè®¡çº¦ç­‰äºæœˆè®¡åˆ’
                ProductionPlanDO dayPlan = generateSubPlan(monthPlan, monthPlan.getId(), j + "æ—¥", daysInMonth, 3); // planType = 3
                dayPlan.setPlanDate(LocalDate.of(yearPlan.getPlanYear(), monthPlan.getPlanMonth(), j));
                productionPlanMapper.insert(dayPlan); // æ’å…¥æ•°æ®åº“ï¼Œä¸ºäº†è·å¾— id

                // 2.3 ç”Ÿæˆç­æ¬¡è®¡åˆ’
                batchList.add(generateSubPlan(dayPlan, dayPlan.getId(), "æ—©ç­", 3, 4)); // planType = 4
                batchList.add(generateSubPlan(dayPlan, dayPlan.getId(), "ä¸­ç­", 3, 4)); // planType = 4
                batchList.add(generateSubPlan(dayPlan, dayPlan.getId(), "æ™šç­", 3, 4)); // planType = 4
            }
        }

        // æ‰¹é‡æ’å…¥æ‰€æœ‰ç­æ¬¡è®¡åˆ’
        for (ProductionPlanDO plan : batchList) {
            productionPlanMapper.insert(plan);
        }
    }
  /**
     * ç”Ÿæˆå­è®¡åˆ’
     *
     * @param parentPlan çˆ¶è®¡åˆ’
     * @param parentId çˆ¶è®¡åˆ’ç¼–å·
     * @param name è®¡åˆ’åç§°
     * @param subMultiple å­è®¡åˆ’çš„æ‹†åˆ†å€æ•°
     * @param planType è®¡åˆ’ç±»å‹
     * @return å­è®¡åˆ’
     */
    private ProductionPlanDO generateSubPlan(ProductionPlanDO parentPlan, Long parentId, String name, int subMultiple, Integer planType) {
        ProductionPlanDO subPlan = new ProductionPlanDO();
        subPlan.setName(parentPlan.getName() + "-" + name);
        subPlan.setParentId(parentId);
        subPlan.setPlanType(planType);
        subPlan.setStatus(parentPlan.getStatus());
        subPlan.setPlanYear(parentPlan.getPlanYear()); // ç»§æ‰¿çˆ¶è®¡åˆ’çš„å¹´ä»½

        // å°†â€œé‡â€ç›¸å…³çš„å­—æ®µï¼Œè¿›è¡Œé™¤æ³•
        subPlan.setRawCoalPlan(parentPlan.getRawCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setFineCoalPlan(parentPlan.getFineCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setGranularCoalPlan(parentPlan.getGranularCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setLargeBlockCoalPlan(parentPlan.getLargeBlockCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setMediumBlockCoalPlan(parentPlan.getMediumBlockCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setSmallBlockCoalPlan(parentPlan.getSmallBlockCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setMiddlingCoalPlan(parentPlan.getMiddlingCoalPlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setSlimePlan(parentPlan.getSlimePlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));
        subPlan.setGanguePlan(parentPlan.getGanguePlan().divide(BigDecimal.valueOf(subMultiple), 2, RoundingMode.HALF_UP));

        // å°†â€œç°åˆ†â€ç›¸å…³çš„å­—æ®µï¼Œç›´æ¥å¤åˆ¶
        subPlan.setFineCoalAsh(parentPlan.getFineCoalAsh());
        subPlan.setGranularCoalAsh(parentPlan.getGranularCoalAsh());
        subPlan.setLargeBlockCoalAsh(parentPlan.getLargeBlockCoalAsh());
        subPlan.setMediumBlockCoalAsh(parentPlan.getMediumBlockCoalAsh());
        subPlan.setSmallBlockCoalAsh(parentPlan.getSmallBlockCoalAsh());
        subPlan.setMiddlingCoalAsh(parentPlan.getMiddlingCoalAsh());
        return subPlan;
    }

    @Override
    public void deleteProductionPlanByYear(Integer year) {
        productionPlanMapper.deleteByYear(year);
    }
    @Override
    public void physicalDeleteProductionPlanByYear(Integer year) {
        productionPlanMapper.physicalDeleteByYear(year);
    } 
```







###### å‰ç«¯

æ·»åŠ æç¤ºæ¡†

```vue
  <el-alert
      title="æœç´¢æç¤ºï¼šå¯¹äºâ€œä¸€é”®ç”Ÿæˆâ€çš„è®¡åˆ’ï¼Œå»ºè®®ä½¿ç”¨â€œè®¡åˆ’åç§°â€è¿›è¡Œç²¾ç¡®æœç´¢ã€‚æœç´¢æ ¼å¼ç¤ºä¾‹ï¼š'2025å¹´-12æœˆ-31æ—¥-æ™šç­' æˆ– '2025å¹´-12æœˆ-31æ—¥'ã€‚"
      type="success"
      show-icon
      :closable="true"
      style="margin-bottom: 20px; border:1px green solid;"
    />
```



æ·»åŠ ä¸¤ä¸ªæŒ‰é’®

```vue
    <el-button
          type="primary"
          @click="openForm('generate')"
          v-hasPermi="['coal:production-plan:create']"
        >
          <Icon icon="ep:plus" class="mr-5px" /> ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’
        </el-button>
        <el-button
          type="danger"
          plain
          @click="handleDeleteByYear"
          v-hasPermi="['coal:production-plan:delete']"
        >
          <Icon icon="ep:delete" class="mr-5px" /> æŒ‰å¹´åˆ é™¤
        </el-button>
```





å› ä¸ºä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’é‡Œé¢ï¼Œéœ€è¦å¡«å†™å¹´åº¦è®¡åˆ’ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¼•ç”¨æ–°å¢æˆ–ä¿®æ”¹çš„è¡¨æ ¼ï¼Œä¹Ÿå°±æ˜¯ProductionPlanForm.vueã€‚æ‰€ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªgenerateæ ‡è¯†ä¸ºç”Ÿæˆçš„ï¼Œå¯¹åº”çš„æ˜¯è¿™
é‡Œï¼š

![image-20250825113053844](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825113053844.png)



æ‰“å¼€å¼¹çª—çš„ProductionPlanForm.vueåï¼Œåˆ¤æ–­æ˜¯ç”Ÿæˆçš„æ—¶å€™è‡ªåŠ¨å¡«å†™å¹´åº¦è®¡åˆ’å’Œé¡¶çº§ID

```vue
// ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’æ—¶ï¼Œè®¾ç½®é»˜è®¤å€¼
  if (type === 'generate') {
    formData.value.planType = 1 // 1 ä»£è¡¨å¹´åº¦è®¡åˆ’
    formData.value.parentId = 0 // 0 ä»£è¡¨é¡¶çº§
  }
```





æäº¤æ˜¯æ‰§è¡ŒgenerationYearPlanæ–¹æ³•

```ts
if (formType.value === 'generate') {
      await ProductionPlanApi.generateYearlyPlan(data)
      message.success('ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’æˆåŠŸ')
```





```TS
// TSä»£ç 

// ä¸€é”®ç”Ÿæˆå¹´åº¦è®¡åˆ’
  generateYearlyPlan: async (data: ProductionPlan) => {
    return await request.post({ url: `/coal/production-plan/generate-yearly-plan`, data })
  },

  // æŒ‰å¹´ä»½åˆ é™¤ç”Ÿäº§è®¡åˆ’
  deleteProductionPlanByYear: async (year: number) => {
    return await request.delete({ url: `/coal/production-plan/delete-by-year?year=` + year })
  },
```



å¯¹äºåˆ é™¤é€»è¾‘å°±æ˜¯ä¼ é€’å¹´ä»½ç„¶åæ‰§è¡Œdelete-by-yearæ–¹æ³•

```ts
/** æŒ‰å¹´ä»½åˆ é™¤æŒ‰é’®æ“ä½œ */
const handleDeleteByYear = async () => {
  try {
    const { value } = await ElMessageBox.prompt('è¯·è¾“å…¥è¦åˆ é™¤çš„å¹´ä»½', 'æç¤º', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      inputPattern: /^\d{4}$/,
      inputErrorMessage: 'è¯·è¾“å…¥æœ‰æ•ˆçš„å››ä½å¹´ä»½'
    })
    if (value) {
      await message.delConfirm('ç¡®è®¤è¦åˆ é™¤ ' + value + ' å¹´çš„æ‰€æœ‰è®¡åˆ’æ•°æ®å—ï¼Ÿ')
      await ProductionPlanApi.deleteProductionPlanByYear(Number(value))
      message.success(t('common.delSuccess'))
      await getList()
    }
  } catch {}
}
```





###### è°ƒè¯•

![image-20250825112725106](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825112725106.png)

**ç”Ÿæˆå¹´åº¦è®¡åˆ’ï¼š**



![image-20250825143905527](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143905527.png)

![image-20250825143920623](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143920623.png)



![image-20250825143927935](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143927935.png)**åˆ é™¤ï¼š**

![image-20250825143414516](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143414516.png)

![image-20250825143420016](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143420016.png)

æ•°æ®åº“ä¸­ä¸æ˜¯çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯é€»è¾‘åˆ é™¤ã€‚

![image-20250825143450111](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143450111.png)

å¦‚æœè¦ç‰©ç†åˆ é™¤ï¼Œä½¿ç”¨http://127.0.0.1:48080/doc.html#/all/%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%20-%20%E7%94%9F%E4%BA%A7%E8%AE%A1%E5%88%92/
physicalDeleteProductionPlanByYear

è¿›è¡Œç‰©ç†åˆ é™¤ã€‚



![image-20250825143524687](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143524687.png)

![image-20250825143531790](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143531790.png)

![image-20250825143537521](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250825143537521.png)


#### 1.2 ç°åœºç”Ÿäº§æ—¥æŠ¥è¡¨ (coal_production_daily_report)
```sql
CREATE TABLE `coal_production_daily_report` (
  `id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æ—¥æŠ¥id',
  `report_date` datetime NOT NULL COMMENT 'æ—¥æœŸ',
  `shift_id` bigint DEFAULT NULL COMMENT 'ç­æ¬¡ID',
  `operator_id` bigint DEFAULT NULL COMMENT 'é›†æ§å‘˜ï¼ˆæ“ä½œäººï¼‰ID',
  `shift_leader_id` bigint DEFAULT NULL COMMENT 'å¸¦ç­ä¸»ä»»/ç­é•¿ID',
  `start_time` datetime DEFAULT NULL COMMENT 'å¯è½¦æ—¶é—´',
  `coal_feeding_time` int DEFAULT NULL COMMENT 'å¸¦ç…¤æ—¶é—´(åˆ†é’Ÿ)',
  `stop_time` datetime DEFAULT NULL COMMENT 'åœè½¦æ—¶é—´',
  `effective_feeding_time` int DEFAULT NULL COMMENT 'æœ‰æ•ˆå¸¦ç…¤æ—¶é—´(åˆ†é’Ÿ)',
  `fault_impact_time` int DEFAULT NULL COMMENT 'æ•…éšœå½±å“æ—¶é—´(åˆ†é’Ÿ)',
  `raw_coal_input` decimal(10,2) DEFAULT NULL COMMENT 'å…¥æ´—ç…¤é‡(å¨)',
  `hourly_capacity` decimal(8,2) DEFAULT NULL COMMENT 'å°æ—¶å¤„ç†é‡(å¨/å°æ—¶)',
  `block_clean_coal_output` decimal(10,2) DEFAULT NULL COMMENT 'å—ç²¾ç…¤äº§é‡(å¨)',
  `fine_clean_coal_output` decimal(10,2) DEFAULT NULL COMMENT 'æœ«ç²¾ç…¤äº§é‡(å¨)',
  `gangue_output` decimal(10,2) DEFAULT NULL COMMENT 'çŸ¸çŸ³äº§é‡(å¨)',
  `middling_coal_output` decimal(10,2) DEFAULT NULL COMMENT 'ä¸­ç…¤äº§é‡(å¨)',
  `filter_press_cycles` int DEFAULT NULL COMMENT 'å‹æ»¤æ¿æ¬¡',
  `filter_press_coal_amount` decimal(8,2) DEFAULT NULL COMMENT 'å‹æ»¤ç…¤é‡(å¨)',
  `filter_cloth_usage` int DEFAULT NULL COMMENT 'æ»¤å¸ƒä½¿ç”¨é‡(å¼ )',
  `discharge_record` varchar(500) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'æ”¾èˆ±è®°å½•',
  `baffle_medium_addition` decimal(8,2) DEFAULT NULL COMMENT 'æŒ¡æ¿æ·»åŠ ä»‹è´¨é‡(kg)',
  `cao_amount` decimal(8,2) DEFAULT NULL COMMENT 'CaOé‡(kg)',
  `flocculant_amount` decimal(8,2) DEFAULT NULL COMMENT 'çµ®å‡å‰‚(kg)',
  `density_MD317` decimal(5,2) DEFAULT NULL COMMENT '317å¯†åº¦(kg/L)',
  `first_ash_block_clean` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬ä¸€æ¬¡å—ç²¾ç…¤ç°åˆ†(%)',
  `first_ash_fine_clean` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬ä¸€æ¬¡æœ«ç²¾ç…¤ç°åˆ†(%)',
  `first_ash_middling` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬ä¸€æ¬¡ä¸­ç…¤ç°åˆ†(%)',
  `first_ash_slime` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬ä¸€æ¬¡ç…¤æ³¥ç°åˆ†(%)',
  `first_ash_gangue` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬ä¸€æ¬¡çŸ¸çŸ³ç°åˆ†(%)',
  `second_ash_block_clean` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬äºŒæ¬¡å—ç²¾ç…¤ç°åˆ†(%)',
  `second_ash_fine_clean` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬äºŒæ¬¡æœ«ç²¾ç…¤ç°åˆ†(%)',
  `second_ash_middling` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬äºŒæ¬¡ä¸­ç…¤ç°åˆ†(%)',
  `second_ash_slime` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬äºŒæ¬¡ç…¤æ³¥ç°åˆ†(%)',
  `second_ash_gangue` decimal(5,2) DEFAULT NULL COMMENT 'ç¬¬äºŒæ¬¡çŸ¸çŸ³ç°åˆ†(%)',
  `impact_time_record` text COLLATE utf8mb4_unicode_ci COMMENT 'å½±å“æ—¶é—´è®°å½•è¯¦æƒ…',
  `assigned_tasks` text COLLATE utf8mb4_unicode_ci COMMENT 'äº¤åŠäº‹é¡¹',
  `start_circulating_water_pool` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦å¾ªç¯æ°´æ± æ¶²ä½',
  `start_clean_water_tank` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦æ¸…æ°´æ¡¶æ¶²ä½',
  `start_fine_coal_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦æœ«ç…¤ä»“ä½',
  `start_granular_coal_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦ç²’ç…¤ä»“ä½',
  `start_large_block_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦å¤§å—ä»“ä½',
  `start_medium_block_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦ä¸­å—ä»“ä½',
  `start_small_block_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦å°å—ä»“ä½',
  `start_middling_coal_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦ä¸­ç…¤ä»“ä½',
  `start_gangue_level` decimal(6,2) DEFAULT NULL COMMENT 'å¯è½¦çŸ¸çŸ³ä»“ä½',
  `stop_circulating_water_pool` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦å¾ªç¯æ°´æ± æ¶²ä½',
  `stop_clean_water_tank` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦æ¸…æ°´æ¡¶æ¶²ä½',
  `stop_fine_coal_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦æœ«ç…¤ä»“ä½',
  `stop_granular_coal_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦ç²’ç…¤ä»“ä½',
  `stop_large_block_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦å¤§å—ä»“ä½',
  `stop_medium_block_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦ä¸­å—ä»“ä½',
  `stop_small_block_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦å°å—ä»“ä½',
  `stop_middling_coal_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦ä¸­ç…¤ä»“ä½',
  `stop_gangue_level` decimal(6,2) DEFAULT NULL COMMENT 'åœè½¦çŸ¸çŸ³ä»“ä½',
  `remarks` text COLLATE utf8mb4_unicode_ci COMMENT 'å¤‡æ³¨ä¿¡æ¯',
  `reserved_field1` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'é¢„ç•™å­—æ®µ1',
  `reserved_field2` varchar(200) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT 'é¢„ç•™å­—æ®µ2',
  `reserved_field3` decimal(10,2) DEFAULT NULL COMMENT 'é¢„ç•™å­—æ®µ3',
  `reserved_field4` decimal(10,2) DEFAULT NULL COMMENT 'é¢„ç•™å­—æ®µ4',
  `reserved_field5` text COLLATE utf8mb4_unicode_ci COMMENT 'é¢„ç•™å­—æ®µ5',
  `creator` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT '' COMMENT 'åˆ›å»ºè€…',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `updater` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT '' COMMENT 'æ›´æ–°è€…',
  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` tinyint DEFAULT '0' COMMENT 'æ˜¯å¦åˆ é™¤',
  `tenant_id` bigint DEFAULT '0' COMMENT 'ç§Ÿæˆ·ID',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1120870174271299585 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç°åœºç”Ÿäº§æ—¥æŠ¥è¡¨';
```
###### æ›´æ”¹æ—¶é—´æ ¼å¼

ç”±äºç”Ÿäº§æ—¥æŠ¥ä¸­æ—¥æœŸæ˜¯ä¸å¸¦æ—¶é—´çš„ï¼Œå¯è½¦æ—¶é—´å’Œåœè½¦æ—¶é—´è¦ç²¾ç¡®åˆ°ç§’ï¼Œè¿™æ ·æ‰åˆç†ã€‚æ‰€ä»¥éœ€è¦æ›´æ”¹å‰ç«¯ä»£ç ï¼Œé€šè¿‡çœ‹æºç 

https://doc.iocoder.cn/validator/#_5-1-query-%E6%97%B6%E9%97%B4%E4%BC%A0%E5%8F%82

å‘ç°æ—¶é—´ä¼ å‚ï¼Œéœ€è¦ä¸¤ç‚¹ï¼š1åç«¯æ›´æ”¹@DateTimeFormat(pattern = FORMAT_YEAR_MONTH_DAY_HOUR_MINUTE_SECOND)ï¼Œ

```java
/**
     * ç§’è½¬æ¢æˆæ¯«ç§’
     */
    public static final long SECOND_MILLIS = 1000;

    public static final String FORMAT_YEAR_MONTH_DAY = "yyyy-MM-dd";

    public static final String FORMAT_YEAR_MONTH_DAY_HOUR_MINUTE_SECOND = "yyyy-MM-dd HH:mm:ss";

```





å¯¹åº”è¿™ä¸€å—ï¼Œé€‰æ‹©å¯¹åº”çš„äº‹ä»¶ï¼Œæœ€åå‘ç°åç«¯ä¸éœ€è¦æ›´æ”¹ï¼Œå°±å¹´æœˆæ—¥æ—¶åˆ†ç§’å°±è¡Œï¼Œå¯¹äºå‰ç«¯è¦è¿›è¡Œä¿®æ”¹ï¼š

```vue
  <el-form-item label="å¯è½¦æ—¶é—´" prop="startTime">
        <el-date-picker
          v-model="formData.startTime"
          type="datetime"
          value-format="x"
          placeholder="é€‰æ‹©å¯è½¦æ—¶é—´"
        />
      </el-form-item>
      
      <el-form-item label="åœè½¦æ—¶é—´" prop="stopTime">
        <el-date-picker
          v-model="formData.stopTime"
          type="datetime"
          value-format="x"
          placeholder="é€‰æ‹©åœè½¦æ—¶é—´"
        />
      </el-form-item>
```





å°†typeç±»å‹æ›´æ”¹ä¸ºdatetimeï¼Œä»–æ‰èƒ½é€‰æ‹©æ—¶åˆ†ç§’çš„æ•°å€¼ã€‚



![image-20250828151050274](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828151050274.png)





![image-20250828151104502](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828151104502.png)

è¿™æ˜¯æ–°å¢æˆ–è€…ä¿®æ”¹çš„æ—¶å€™ä¿®æ”¹çš„å†…å®¹ã€‚

å¯¹äºå‰ç«¯åˆ—è¡¨å±•ç¤ºé¡µé¢ï¼Œä¸€å¼€å§‹ç”Ÿæˆçš„æ—¶å€™æ˜¯åªæœ‰æ—¥æœˆå¹´æ—¶åˆ†ç§’ã€‚å‰ç«¯æä¾›äº†æ–¹æ³•è¿›è¡Œè½¬æ¢ã€‚



![image-20250828151256638](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828151256638.png)

```vue
 <el-table-column
        label="æ—¥æœŸ"
        align="center"
        prop="reportDate"
        :formatter="dateFormatter2"
        width="180px"
      />
```





å°†æ—¥æœŸæ›´æ”¹æ ¼å¼å³å¯ã€‚

è¿™æ ·åç«¯ç»Ÿä¸€éƒ½æ˜¯datetimeæ ¼å¼ï¼Œ

![image-20250828151351825](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828151351825.png)



ä½†æ˜¯å‰ç«¯é¡µé¢å±•ç¤ºæ˜¯ï¼š



![image-20250828151415766](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828151415766.png)



###### é›†æ§å‘˜å’Œå¸¦ç­ä¸»ä»»æ›´æ”¹



é€šè¿‡è·å–æœ¬åœ°çš„ç”¨æˆ·è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥å°†é›†æ§å‘˜å’Œå¸¦ç­ä¸»ä»»å†…å®¹è¿›è¡Œä¸‹æ¥æ¡†ï¼Œå¹¶ä¸”æ–°å¢æˆ–ä¿®æ”¹çš„æ—¶å€™è¾“å…¥çš„æ˜¯idï¼Œå±•ç¤ºçš„æ˜¯æ˜µç§°ã€‚

```vue
<el-form-item label="é›†æ§å‘˜ï¼ˆæ“ä½œäººï¼‰" prop="operatorId">
        <el-select v-model="formData.operatorId" placeholder="è¯·é€‰æ‹©é›†æ§å‘˜ï¼ˆæ“ä½œäººï¼‰" clearable filterable>
          <el-option
            v-for="user in userList"
            :key="user.id"
            :label="user.nickname"
            :value="user.id"
          />
        </el-select>
      </el-form-item>
      <el-form-item label="å¸¦ç­ä¸»ä»»/ç­é•¿" prop="shiftLeaderId">
        <el-select v-model="formData.shiftLeaderId" placeholder="è¯·é€‰æ‹©å¸¦ç­ä¸»ä»»/ç­é•¿" clearable filterable>
          <el-option
            v-for="user in userList"
            :key="user.id"
            :label="user.nickname"
            :value="user.id"
          />
        </el-select>
      </el-form-item>
      
import { getSimpleUserList, UserVO } from '@/api/system/user'
const userList = ref<UserVO[]>([]) // ç”¨æˆ·åˆ—è¡¨
    
/** åŠ è½½ç”¨æˆ·åˆ—è¡¨ */
const loadUserList = async () => {
  try {
    const data = await getSimpleUserList()
    userList.value = data
  } catch (error) {
    console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error)
    userList.value = []
  }
}
/** åˆå§‹åŒ– **/
onMounted(() => {
  loadUserList()
})
```





index.vueå±•ç¤ºé¡µé¢ï¼š

```vue
<el-table-column label="é›†æ§å‘˜" align="center" prop="operatorId">
        <template #default="scope">
          {{ getUserNickname(scope.row.operatorId) }}
        </template>
      </el-table-column>
      <el-table-column label="å¸¦ç­ä¸»ä»»" align="center" prop="shiftLeaderId">
        <template #default="scope">
          {{ getUserNickname(scope.row.shiftLeaderId) }}
        </template>
      </el-table-column>

import { getSimpleUserList, UserVO } from '@/api/system/user'
const userList = ref<UserVO[]>([]) // ç”¨æˆ·åˆ—è¡¨

/** æ ¹æ®ç”¨æˆ·IDè·å–ç”¨æˆ·æ˜µç§° */
const getUserNickname = (userId: number | undefined) => {
  if (!userId) return ''
  const user = userList.value.find(u => u.id === userId)
  return user ? user.nickname : `ç”¨æˆ·${userId}`
}
/** åŠ è½½ç”¨æˆ·åˆ—è¡¨ */
const loadUserList = async () => {
  try {
    const data = await getSimpleUserList()
    userList.value = data
  } catch (error) {
    console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error)
    userList.value = []
  }
}
/** åˆå§‹åŒ– **/
onMounted(() => {
  getList()
  loadUserList()
})
```







###### åœ¨çº¿å¡«è¡¨

é€šè¿‡æŠ¥è¡¨è®¾è®¡å™¨è®¾è®¡äº†åœ¨çº¿å¡«è¡¨ï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥è·³è½¬é“¾æ¥ï¼Œåœ¨çº¿å¡«è¡¨ã€‚ç„¶åå¯ä»¥æ”¯æŒæ‰“å°å¯¼å‡ºã€‚





```vue
<el-button
  type="primary"
  plain
  @click="openOnlineReport"
>
  <Icon icon="ep:plus" class="mr-5px" /> åœ¨çº¿å¡«æŠ¥
</el-button>
```

```ts
/** åœ¨çº¿å¡«æŠ¥æŒ‰é’®æ“ä½œ */
const openOnlineReport = () => {
  const url = 'http://localhost:48080/jmreport/shareView/1120595319747600384?shareToken=39303adec4dd28332e4ce1f063e17be7'
  window.open(url, '_blank')
}
```





![image-20250828152156677](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828152156677.png)

![image-20250828152212604](D:\code\ruoyi-vue-pro\learn\é€‰ç…¤å‚ç”Ÿäº§ç®¡ç†ç³»ç»Ÿå¼€å‘å¤§çº².assets\image-20250828152212604.png)


#### 1.3 è®¡åˆ’å®Œæˆç‡ç»Ÿè®¡è¡¨ (coal_plan_completion_statistics)
```sql
CREATE TABLE coal_plan_completion_statistics (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    plan_id BIGINT NOT NULL COMMENT 'è®¡åˆ’ID',
    statistics_date DATE NOT NULL COMMENT 'ç»Ÿè®¡æ—¥æœŸ',
    statistics_type TINYINT NOT NULL COMMENT 'ç»Ÿè®¡ç±»å‹ï¼š1æ—¥ç»Ÿè®¡ 2æœˆç»Ÿè®¡ 3å¹´ç»Ÿè®¡ 4ç­ç»Ÿè®¡',

    -- è®¡åˆ’æ•°æ®
    plan_raw_coal DECIMAL(10,2),                  -- è®¡åˆ’å…¥æ´—åŸç…¤é‡(å¨)
    plan_fine_coal DECIMAL(10,2),                 -- è®¡åˆ’æœ«ç…¤äº§é‡(å¨)
    plan_granular_coal DECIMAL(10,2),             -- è®¡åˆ’ç²’ç…¤äº§é‡(å¨)
    plan_large_block_coal DECIMAL(10,2),          -- è®¡åˆ’å¤§å—ç…¤äº§é‡(å¨)
    plan_medium_block_coal DECIMAL(10,2),         -- è®¡åˆ’ä¸­å—ç…¤äº§é‡(å¨)
    plan_small_block_coal DECIMAL(10,2),          -- è®¡åˆ’å°å—ç…¤äº§é‡(å¨)
    plan_middling_coal DECIMAL(10,2),             -- è®¡åˆ’ä¸­ç…¤äº§é‡(å¨)
    plan_gangue DECIMAL(10,2),                    -- è®¡åˆ’çŸ¸çŸ³äº§é‡(å¨)

    -- å®é™…å®Œæˆæ•°æ®
    actual_raw_coal DECIMAL(10,2),                -- å®é™…å…¥æ´—åŸç…¤é‡(å¨)
    actual_fine_coal DECIMAL(10,2),               -- å®é™…æœ«ç…¤äº§é‡(å¨)
    actual_granular_coal DECIMAL(10,2),           -- å®é™…ç²’ç…¤äº§é‡(å¨)
    actual_large_block_coal DECIMAL(10,2),        -- å®é™…å¤§å—ç…¤äº§é‡(å¨)
    actual_medium_block_coal DECIMAL(10,2),       -- å®é™…ä¸­å—ç…¤äº§é‡(å¨)
    actual_small_block_coal DECIMAL(10,2),        -- å®é™…å°å—ç…¤äº§é‡(å¨)
    actual_middling_coal DECIMAL(10,2),           -- å®é™…ä¸­ç…¤äº§é‡(å¨)
    actual_gangue DECIMAL(10,2),                  -- å®é™…çŸ¸çŸ³äº§é‡(å¨)

    -- å®Œæˆç‡æ•°æ®ï¼ˆç™¾åˆ†æ¯”ï¼‰
    completion_rate_raw_coal DECIMAL(5,2),        -- å…¥æ´—åŸç…¤å®Œæˆç‡(%)
    completion_rate_fine_coal DECIMAL(5,2),       -- æœ«ç…¤å®Œæˆç‡(%)
    completion_rate_granular_coal DECIMAL(5,2),   -- ç²’ç…¤å®Œæˆç‡(%)
    completion_rate_large_block DECIMAL(5,2),     -- å¤§å—ç…¤å®Œæˆç‡(%)
    completion_rate_medium_block DECIMAL(5,2),    -- ä¸­å—ç…¤å®Œæˆç‡(%)
    completion_rate_small_block DECIMAL(5,2),     -- å°å—ç…¤å®Œæˆç‡(%)
    completion_rate_middling_coal DECIMAL(5,2),   -- ä¸­ç…¤å®Œæˆç‡(%)
    completion_rate_gangue DECIMAL(5,2),          -- çŸ¸çŸ³å®Œæˆç‡(%)

    -- æ€»ä½“å®Œæˆç‡
    overall_completion_rate DECIMAL(5,2),         -- æ€»ä½“å®Œæˆç‡(%)

    -- ç»Ÿè®¡çŠ¶æ€
    statistics_status TINYINT DEFAULT 1,          -- ç»Ÿè®¡çŠ¶æ€ï¼š1æ­£å¸¸ 2å¼‚å¸¸ 3éœ€å…³æ³¨

    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

#### 1.4 ç­æ¬¡ç®¡ç†æ¨¡å—ï¼ˆä¸»å­è¡¨ç»“æ„è®¾è®¡ï¼‰

##### 1.4.1 ä¸šåŠ¡é€»è¾‘ä¸è¡¨ç»“æ„è®¾è®¡
ç­æ¬¡ç®¡ç†é‡‡ç”¨ä¸»å­è¡¨ç»“æ„è®¾è®¡ï¼Œå®Œç¾é€‚é…èŠ‹é“ä»£ç ç”Ÿæˆå™¨çš„ä¸»å­è¡¨åŠŸèƒ½ï¼Œæ”¯æŒä¸€ä¸ªä¸»è¡¨å¯¹åº”å¤šä¸ªå­è¡¨çš„æ¨¡å¼ã€‚

- **ä¸»è¡¨ï¼šç­æ¬¡é…ç½®è¡¨ (`coal_shift_config`)** - å®šä¹‰ç­æ¬¡çš„åŸºç¡€æ¨¡æ¿ï¼Œå¦‚â€œæ—©ç­â€ã€â€œä¸­ç­â€åŠå…¶å¯¹åº”çš„æ—¶é—´æ®µã€‚
- **å­è¡¨1ï¼šç­æ¬¡æ’ç­è¡¨ (`coal_shift_schedule`)** - å…³è”ç­æ¬¡é…ç½®ï¼Œç”¨äºæŒ‡å®šæŸä¸ªç­æ¬¡æ¨¡æ¿åœ¨å…·ä½“æ—¥æœŸçš„æ’ç­å®‰æ’ã€‚
- **å­è¡¨2ï¼šäººå‘˜æ’ç­è¡¨ (`coal_shift_staff`)** - å…³è”ç­æ¬¡é…ç½®ï¼Œç”¨äºå°†å…·ä½“å‘˜å·¥åˆ†é…åˆ°æŸä¸ªç­æ¬¡çš„æŸä¸ªæ—¥æœŸä¸­ã€‚

**è¡¨å…³ç³»ï¼š**
```
coal_shift_config (ç­æ¬¡é…ç½®) - ä¸»è¡¨
    â”œâ”€â”€ coal_shift_schedule (ç­æ¬¡æ’ç­) - å­è¡¨1ï¼Œé€šè¿‡ shift_config_id å…³è”
    â””â”€â”€ coal_shift_staff (äººå‘˜æ’ç­) - å­è¡¨2ï¼Œé€šè¿‡ shift_config_id å…³è”
```

**è®¾è®¡ä¼˜åŠ¿ï¼š**
- ç¬¦åˆèŠ‹é“ä»£ç ç”Ÿæˆå™¨çš„ä¸»å­è¡¨é™åˆ¶
- å¯ä»¥åœ¨ä¸€ä¸ªç•Œé¢ä¸­åŒæ—¶ç®¡ç†ç­æ¬¡æ’ç­å’Œäººå‘˜æ’ç­
- é€šè¿‡ `shift_config_id` + `schedule_date` å®ç°æ•°æ®å…³è”
- ä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼Œæ“ä½œä¾¿æ·

**ä¸šåŠ¡åœºæ™¯ç¤ºä¾‹ï¼š**
```
ç­æ¬¡é…ç½®ï¼ˆç›¸å¯¹å›ºå®šï¼‰ï¼š
- æ—©ç­ï¼š08:00-16:00ï¼ˆ8å°æ—¶ï¼‰
- ä¸­ç­ï¼š16:00-24:00ï¼ˆ8å°æ—¶ï¼‰
- æ™šç­ï¼š00:00-08:00ï¼ˆ8å°æ—¶ï¼Œè·¨å¤©ï¼‰

ç­æ¬¡æ’ç­ï¼ˆçµæ´»å®‰æ’ï¼‰ï¼š
- æ—©ç­ï¼š2025å¹´1æœˆ15æ—¥ã€18æ—¥ã€20æ—¥ã€22æ—¥...
- ä¸­ç­ï¼š2025å¹´1æœˆ16æ—¥ã€19æ—¥ã€21æ—¥ã€23æ—¥...
- æ™šç­ï¼š2025å¹´1æœˆ17æ—¥ã€20æ—¥ã€22æ—¥ã€24æ—¥...

äººå‘˜æ’ç­ï¼ˆå…·ä½“æ‰§è¡Œï¼‰ï¼š
- 2025å¹´1æœˆ15æ—¥æ—©ç­ï¼šå¼ ä¸‰ï¼ˆè°ƒåº¦å‘˜ã€ç­é•¿ï¼‰ã€æå››ï¼ˆæ“ä½œå·¥ï¼‰ã€ç‹äº”ï¼ˆæ£€ä¿®å·¥ï¼‰ã€èµµå…­ï¼ˆå®‰å…¨å‘˜ï¼‰
```

##### 1.4.2 ç­æ¬¡é…ç½®è¡¨ (coal_shift_config)
```sql
DROP TABLE IF EXISTS `coal_shift_config`;
CREATE TABLE `coal_shift_config` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç­æ¬¡é…ç½®ID',
    `shift_name` VARCHAR(50) NOT NULL COMMENT 'ç­æ¬¡åç§°ï¼ˆå¦‚ï¼šæ—©ç­ã€ä¸­ç­ã€æ™šç­ï¼‰',
    `shift_code` VARCHAR(20) NOT NULL COMMENT 'ç­æ¬¡ç¼–ç ï¼ˆå¦‚ï¼šMORNINGã€AFTERNOONã€NIGHTï¼‰',
    `start_time` TIME NOT NULL COMMENT 'ç­æ¬¡å¼€å§‹æ—¶é—´ï¼ˆå¦‚ï¼š08:00ï¼‰',
    `end_time` TIME NOT NULL COMMENT 'ç­æ¬¡ç»“æŸæ—¶é—´ï¼ˆå¦‚ï¼š16:00ï¼‰',
    `shift_type` TINYINT NOT NULL COMMENT 'ç­æ¬¡ç±»å‹ï¼š1ç”Ÿäº§ç­ 2æ£€ä¿®ç­ 3å€¼ç­',
    `is_cross_day` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦è·¨å¤©ç­æ¬¡ï¼š0å¦ 1æ˜¯',
    `work_hours` DECIMAL(4,2) NOT NULL COMMENT 'å·¥ä½œæ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
    `sort_order` INT NOT NULL DEFAULT 0 COMMENT 'æ’åº',
    `status` TINYINT NOT NULL DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0ç¦ç”¨ 1å¯ç”¨',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `creator` VARCHAR(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updater` VARCHAR(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ç¼–å·',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_shift_code` (`shift_code`, `deleted`) COMMENT 'ç­æ¬¡ç¼–ç å”¯ä¸€ç´¢å¼•'
) ENGINE = InnoDB COMMENT = 'ç­æ¬¡é…ç½®è¡¨';
```

##### 1.4.3 ç­æ¬¡æ’ç­è¡¨ (coal_shift_schedule)
```sql
DROP TABLE IF EXISTS `coal_shift_schedule`;
CREATE TABLE `coal_shift_schedule` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç­æ¬¡æ’ç­ID',
    `shift_config_id` BIGINT NOT NULL COMMENT 'ç­æ¬¡é…ç½®ID',
    `schedule_date` DATE NOT NULL COMMENT 'æ’ç­æ—¥æœŸ',
    `schedule_status` TINYINT NOT NULL DEFAULT 1 COMMENT 'æ’ç­çŠ¶æ€ï¼š1æ­£å¸¸ 2åœäº§ 3æ£€ä¿® 4å–æ¶ˆ',
    `planned_staff_count` INT NOT NULL DEFAULT 0 COMMENT 'è®¡åˆ’äººå‘˜æ•°é‡',
    `actual_staff_count` INT NOT NULL DEFAULT 0 COMMENT 'å®é™…äººå‘˜æ•°é‡',
    `shift_leader_id` BIGINT NULL COMMENT 'ç­é•¿ID',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `creator` VARCHAR(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updater` VARCHAR(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ç¼–å·',
    PRIMARY KEY (`id`) USING BTREE,
    KEY `idx_shift_config_id` (`shift_config_id`),
    KEY `idx_schedule_date` (`schedule_date`),
    UNIQUE KEY `uk_shift_schedule` (`shift_config_id`, `schedule_date`, `deleted`) COMMENT 'ç­æ¬¡æ—¥æœŸå”¯ä¸€ç´¢å¼•'
) ENGINE = InnoDB COMMENT = 'ç­æ¬¡æ’ç­è¡¨';
```

##### 1.4.4 äººå‘˜æ’ç­è¡¨ (coal_shift_staff)
```sql
DROP TABLE IF EXISTS `coal_shift_staff`;
CREATE TABLE `coal_shift_staff` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'äººå‘˜æ’ç­ID',
    `shift_config_id` BIGINT NOT NULL COMMENT 'ç­æ¬¡é…ç½®IDï¼ˆå…³è”ä¸»è¡¨ï¼‰',
    `schedule_date` DATE NOT NULL COMMENT 'æ’ç­æ—¥æœŸ',
    `user_id` BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    `position_type` TINYINT NOT NULL COMMENT 'å²—ä½ç±»å‹ï¼š1è°ƒåº¦å‘˜ 2æ“ä½œå·¥ 3æ£€ä¿®å·¥ 4å®‰å…¨å‘˜ 5è´¨æ£€å‘˜',
    `is_leader` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦ç­é•¿ï¼š0å¦ 1æ˜¯',
    `attendance_status` TINYINT NOT NULL DEFAULT 1 COMMENT 'å‡ºå‹¤çŠ¶æ€ï¼š1æ­£å¸¸ 2è¯·å‡ 3è¿Ÿåˆ° 4æ—©é€€ 5æ—·å·¥',
    `replacement_user_id` BIGINT NULL COMMENT 'æ›¿ç­äººå‘˜ID',
    `work_start_time` DATETIME NULL COMMENT 'å®é™…ä¸Šç­æ—¶é—´',
    `work_end_time` DATETIME NULL COMMENT 'å®é™…ä¸‹ç­æ—¶é—´',
    `overtime_hours` DECIMAL(4,2) DEFAULT 0 COMMENT 'åŠ ç­æ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `creator` VARCHAR(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updater` VARCHAR(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ç¼–å·',
    PRIMARY KEY (`id`) USING BTREE,
    KEY `idx_shift_config_id` (`shift_config_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_schedule_date` (`schedule_date`),
    UNIQUE KEY `uk_staff_schedule` (`shift_config_id`, `schedule_date`, `user_id`, `position_type`, `deleted`) COMMENT 'äººå‘˜æ’ç­å”¯ä¸€ç´¢å¼•'
) ENGINE = InnoDB COMMENT = 'äººå‘˜æ’ç­è¡¨';
```

##### 1.4.5 è€ƒå‹¤ç³»ç»Ÿé›†æˆè®¾è®¡ï¼ˆåæœŸæ‰©å±•ï¼‰
ä¸ºåæœŸé›†æˆè€ƒå‹¤åŠŸèƒ½ï¼Œé¢„å…ˆè®¾è®¡ä»¥ä¸‹è¡¨ç»“æ„ï¼Œå¯ä¸äººå‘˜æ’ç­è¡¨ (`coal_shift_staff`) å…³è”ã€‚

**è€ƒå‹¤è®°å½•è¡¨ (coal_attendance_record)**
```sql
CREATE TABLE `coal_attendance_record` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è€ƒå‹¤è®°å½•ID',
    `shift_staff_id` BIGINT NOT NULL COMMENT 'äººå‘˜æ’ç­ID',
    `user_id` BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    `attendance_date` DATE NOT NULL COMMENT 'è€ƒå‹¤æ—¥æœŸ',
    `check_in_time` DATETIME NULL COMMENT 'ç­¾åˆ°æ—¶é—´',
    `check_out_time` DATETIME NULL COMMENT 'ç­¾é€€æ—¶é—´',
    `attendance_type` TINYINT NOT NULL COMMENT 'è€ƒå‹¤ç±»å‹ï¼š1æ­£å¸¸ 2è¿Ÿåˆ° 3æ—©é€€ 4æ—·å·¥ 5è¯·å‡',
    `work_duration` DECIMAL(4,2) DEFAULT 0 COMMENT 'å·¥ä½œæ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
    `overtime_duration` DECIMAL(4,2) DEFAULT 0 COMMENT 'åŠ ç­æ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
    `location_info` VARCHAR(200) NULL COMMENT 'è€ƒå‹¤åœ°ç‚¹ä¿¡æ¯',
    `device_info` VARCHAR(100) NULL COMMENT 'è€ƒå‹¤è®¾å¤‡ä¿¡æ¯',
    `remark` VARCHAR(500) DEFAULT NULL COMMENT 'å¤‡æ³¨',
    `creator` VARCHAR(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updater` VARCHAR(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ç¼–å·',
    PRIMARY KEY (`id`) USING BTREE,
    KEY `idx_shift_staff_id` (`shift_staff_id`),
    KEY `idx_user_date` (`user_id`, `attendance_date`)
) ENGINE = InnoDB COMMENT = 'è€ƒå‹¤è®°å½•è¡¨';
```

**è€ƒå‹¤ç»Ÿè®¡è¡¨ (coal_attendance_statistics)**
```sql
CREATE TABLE `coal_attendance_statistics` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è€ƒå‹¤ç»Ÿè®¡ID',
    `user_id` BIGINT NOT NULL COMMENT 'å‘˜å·¥ID',
    `statistics_month` VARCHAR(7) NOT NULL COMMENT 'ç»Ÿè®¡æœˆä»½ï¼ˆYYYY-MMï¼‰',
    `work_days` INT DEFAULT 0 COMMENT 'åº”å‡ºå‹¤å¤©æ•°',
    `actual_days` INT DEFAULT 0 COMMENT 'å®é™…å‡ºå‹¤å¤©æ•°',
    `late_times` INT DEFAULT 0 COMMENT 'è¿Ÿåˆ°æ¬¡æ•°',
    `early_leave_times` INT DEFAULT 0 COMMENT 'æ—©é€€æ¬¡æ•°',
    `absent_days` INT DEFAULT 0 COMMENT 'æ—·å·¥å¤©æ•°',
    `leave_days` INT DEFAULT 0 COMMENT 'è¯·å‡å¤©æ•°',
    `overtime_hours` DECIMAL(6,2) DEFAULT 0 COMMENT 'åŠ ç­æ—¶é•¿ï¼ˆå°æ—¶ï¼‰',
    `attendance_rate` DECIMAL(5,2) DEFAULT 0 COMMENT 'å‡ºå‹¤ç‡ï¼ˆ%ï¼‰',
    `creator` VARCHAR(64) NULL DEFAULT '' COMMENT 'åˆ›å»ºè€…',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `updater` VARCHAR(64) NULL DEFAULT '' COMMENT 'æ›´æ–°è€…',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `deleted` BIT(1) NOT NULL DEFAULT b'0' COMMENT 'æ˜¯å¦åˆ é™¤',
    `tenant_id` BIGINT NOT NULL DEFAULT 0 COMMENT 'ç§Ÿæˆ·ç¼–å·',
    PRIMARY KEY (`id`) USING BTREE,
    UNIQUE KEY `uk_user_month` (`user_id`, `statistics_month`, `deleted`)
) ENGINE = InnoDB COMMENT = 'è€ƒå‹¤ç»Ÿè®¡è¡¨';
```

##### 1.4.6 å­—å…¸æ•°æ®é…ç½®
```sql
-- ç­æ¬¡ç±»å‹: shift_type
-- å²—ä½ç±»å‹: position_type
-- æ’ç­çŠ¶æ€: schedule_status
-- å‡ºå‹¤çŠ¶æ€: attendance_status
-- è€ƒå‹¤ç±»å‹: attendance_type
```
```sql
-- ç­æ¬¡ç±»å‹å­—å…¸
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES ('ç­æ¬¡ç±»å‹', 'shift_type', 0, 'ç­æ¬¡ç±»å‹', '1', NOW(), '1', NOW(), 0);

-- å²—ä½ç±»å‹å­—å…¸
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES ('å²—ä½ç±»å‹', 'position_type', 0, 'æ’ç­å²—ä½ç±»å‹', '1', NOW(), '1', NOW(), 0);

-- æ’ç­çŠ¶æ€å­—å…¸
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES ('æ’ç­çŠ¶æ€', 'schedule_status', 0, 'ç­æ¬¡æ’ç­çŠ¶æ€', '1', NOW(), '1', NOW(), 0);

-- å‡ºå‹¤çŠ¶æ€å­—å…¸
INSERT INTO `system_dict_type` (`name`, `type`, `status`, `remark`, `creator`, `create_time`, `updater`, `update_time`, `deleted`) VALUES ('å‡ºå‹¤çŠ¶æ€', 'attendance_status', 0, 'äººå‘˜å‡ºå‹¤çŠ¶æ€', '1', NOW(), '1', NOW(), 0);

-- ç­æ¬¡ç±»å‹æ•°æ®
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, 'ç”Ÿäº§ç­', '1', 'shift_type', 0, '1', NOW(), '1', NOW()),
(2, 'æ£€ä¿®ç­', '2', 'shift_type', 0, '1', NOW(), '1', NOW()),
(3, 'å€¼ç­', '3', 'shift_type', 0, '1', NOW(), '1', NOW());

-- å²—ä½ç±»å‹æ•°æ®
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, 'è°ƒåº¦å‘˜', '1', 'position_type', 0, '1', NOW(), '1', NOW()),
(2, 'æ“ä½œå·¥', '2', 'position_type', 0, '1', NOW(), '1', NOW()),
(3, 'æ£€ä¿®å·¥', '3', 'position_type', 0, '1', NOW(), '1', NOW()),
(4, 'å®‰å…¨å‘˜', '4', 'position_type', 0, '1', NOW(), '1', NOW()),
(5, 'è´¨æ£€å‘˜', '5', 'position_type', 0, '1', NOW(), '1', NOW());

-- æ’ç­çŠ¶æ€æ•°æ®
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, 'æ­£å¸¸', '1', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(2, 'åœäº§', '2', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(3, 'æ£€ä¿®', '3', 'schedule_status', 0, '1', NOW(), '1', NOW()),
(4, 'å–æ¶ˆ', '4', 'schedule_status', 0, '1', NOW(), '1', NOW());

-- å‡ºå‹¤çŠ¶æ€æ•°æ®
INSERT INTO `system_dict_data` (`sort`, `label`, `value`, `dict_type`, `status`, `creator`, `create_time`, `updater`, `update_time`) VALUES
(1, 'æ­£å¸¸', '1', 'attendance_status', 0, '1', NOW(), '1', NOW()),
(2, 'è¯·å‡', '2', 'attendance_status', 0, '1', NOW(), '1', NOW()),
(3, 'è¿Ÿåˆ°', '3', 'attendance_status', 0, '1', NOW(), '1', NOW()),
(4, 'æ—©é€€', '4', 'attendance_status', 0, '1', NOW(), '1', NOW()),
(5, 'æ—·å·¥', '5', 'attendance_status', 0, '1', NOW(), '1', NOW());

##### 1.4.7 ä»£ç ç”Ÿæˆå™¨ä½¿ç”¨å»ºè®®

**ä½¿ç”¨èŠ‹é“ä»£ç ç”Ÿæˆå™¨çš„ä¸»å­è¡¨åŠŸèƒ½ï¼š**

- **ä¸»è¡¨ï¼š** `coal_shift_config`ï¼ˆç­æ¬¡é…ç½®è¡¨ï¼‰
- **å­è¡¨1ï¼š** `coal_shift_schedule`ï¼ˆç­æ¬¡æ’ç­è¡¨ï¼‰- å…³è”å­—æ®µï¼š`shift_config_id`
- **å­è¡¨2ï¼š** `coal_shift_staff`ï¼ˆäººå‘˜æ’ç­è¡¨ï¼‰- å…³è”å­—æ®µï¼š`shift_config_id`

**ç”Ÿæˆé…ç½®ï¼š**
- æ¨¡æ¿ç±»å‹ï¼šä¸»å­è¡¨
- ä¸»è¡¨ï¼šcoal_shift_config
- å­è¡¨ï¼šcoal_shift_schedule, coal_shift_staff
- å…³è”å­—æ®µï¼šshift_config_id

**ç•Œé¢æ“ä½œæµç¨‹ï¼š**
1. åœ¨ç­æ¬¡é…ç½®é¡µé¢ï¼Œå¯ä»¥åŒæ—¶çœ‹åˆ°è¯¥ç­æ¬¡çš„æ’ç­è®¡åˆ’å’Œäººå‘˜å®‰æ’
2. æ–°å¢ç­æ¬¡é…ç½®æ—¶ï¼Œå¯ä»¥ç›´æ¥æ·»åŠ æ’ç­æ—¥æœŸå’Œäººå‘˜åˆ†é…
3. ç¼–è¾‘æ—¶å¯ä»¥ç»Ÿä¸€ç®¡ç†ç­æ¬¡çš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯

**æ•°æ®å…³è”é€»è¾‘ï¼š**
- ç­æ¬¡æ’ç­è¡¨å’Œäººå‘˜æ’ç­è¡¨éƒ½ç›´æ¥å…³è”ç­æ¬¡é…ç½®è¡¨
- é€šè¿‡ `shift_config_id` + `schedule_date` å¯ä»¥å…³è”åŒä¸€å¤©çš„æ’ç­å’Œäººå‘˜ä¿¡æ¯
- ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼Œé¿å…å¤æ‚çš„ä¸‰å±‚å…³è”

### 2. è®¾å¤‡æ¡£æ¡ˆç®¡ç†æ¨¡å—

#### 2.1 è®¾å¤‡åŸºç¡€ä¿¡æ¯è¡¨ (coal_equipment_info)
```sql
CREATE TABLE coal_equipment_info (
    id BIGINT PRIMARY KEY IDENTITY(1,1),
    equipment_code NVARCHAR(50) NOT NULL,         -- è®¾å¤‡ç¼–å·
    equipment_name NVARCHAR(100) NOT NULL,        -- è®¾å¤‡åç§°
    equipment_type_id BIGINT NOT NULL,            -- è®¾å¤‡ç±»å‹ID
    system_id BIGINT NOT NULL,                    -- æ‰€å±ç³»ç»ŸID
    workshop_id BIGINT,                           -- æ‰€å±è½¦é—´ID
    
    -- è®¾å¤‡åŸºæœ¬ä¿¡æ¯
    model NVARCHAR(100),                          -- è®¾å¤‡å‹å·
    manufacturer NVARCHAR(100),                   -- åˆ¶é€ å‚å•†
    manufacture_date DATE,                        -- åˆ¶é€ æ—¥æœŸ
    install_date DATE,                            -- å®‰è£…æ—¥æœŸ
    commission_date DATE,                         -- æŠ•äº§æ—¥æœŸ
    
    -- æŠ€æœ¯å‚æ•°
    rated_power DECIMAL(10,2),                    -- é¢å®šåŠŸç‡(kW)
    rated_capacity DECIMAL(10,2),                 -- é¢å®šå¤„ç†èƒ½åŠ›(t/h)
    weight DECIMAL(10,2),                         -- è®¾å¤‡é‡é‡(t)
    dimensions NVARCHAR(100),                     -- å¤–å½¢å°ºå¯¸
    
    -- è®¾å¤‡çŠ¶æ€
    equipment_status TINYINT DEFAULT 1,           -- è®¾å¤‡çŠ¶æ€ï¼š1æ­£å¸¸ 2æ•…éšœ 3æ£€ä¿® 4åœç”¨
    health_level TINYINT DEFAULT 1,               -- å¥åº·ç­‰çº§ï¼š1ä¼˜è‰¯ 2è‰¯å¥½ 3æ³¨æ„ 4å¼‚å¸¸
    
    -- ä½ç½®ä¿¡æ¯
    location NVARCHAR(200),                       -- å®‰è£…ä½ç½®
    qr_code NVARCHAR(200),                        -- äºŒç»´ç 
    
    -- è´£ä»»äºº
    responsible_person_id BIGINT,                 -- è´£ä»»äººID
    maintenance_person_id BIGINT,                 -- ç»´æŠ¤äººID
    
    -- åŸºç¡€å­—æ®µ
    creator NVARCHAR(64) DEFAULT '',
    create_time DATETIME DEFAULT GETDATE(),
    updater NVARCHAR(64) DEFAULT '',
    update_time DATETIME DEFAULT GETDATE(),
    deleted BIT DEFAULT 0,
    tenant_id BIGINT DEFAULT 0
);
```

---

*... (rest of the document remains the same)* ...
