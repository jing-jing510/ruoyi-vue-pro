# å¤‡ä»¶åº“å­˜ç»Ÿè®¡æ•°æ®æ˜¾ç¤ºé—®é¢˜ä¿®å¤æ€»ç»“

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆé¦–é¡µå¤‡ä»¶ç»Ÿè®¡å¡ç‰‡èƒ½å¤Ÿæ˜¾ç¤ºï¼Œä½†æ‰€æœ‰æ•°æ®éƒ½æ˜¾ç¤ºä¸º0ï¼š
- å¤‡ä»¶ç§ç±»: 0
- æ€»åº“å­˜: 0  
- é›¶åº“å­˜: 0
- ä½åº“å­˜: 0
- åº“å­˜å¥åº·åº¦: 0%

åŒæ—¶åç«¯å‡ºç° `StackOverflowError` é”™è¯¯ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. StackOverflowError é”™è¯¯
**é”™è¯¯åŸå› **: åœ¨ `SparePartStockMapper.selectBySparePartId` æ–¹æ³•ä¸­ä½¿ç”¨äº† `selectList`ï¼Œå¯¼è‡´æ— é™é€’å½’è°ƒç”¨ã€‚

**é”™è¯¯å †æ ˆ**:
```
java.lang.StackOverflowError: null
	at com.zeroturnaround.jrebelbase.facade.e.compareObject(SourceFile:64)
	at com.baomidou.mybatisplus.core.override.MybatisMapperProxy.invoke(MybatisMapperProxy.java:93)
	at com.sun.proxy.$Proxy328.selectBySparePartId(Unknown Source)
```

### 2. æ•°æ®æ˜¾ç¤ºä¸º0çš„é—®é¢˜
**æ ¹æœ¬åŸå› **: åº“å­˜è®°å½•è¡¨ä¸­çš„æ•°é‡éƒ½æ˜¯0ï¼Œä½†å‡ºå…¥åº“è®°å½•ä¸­æœ‰å®é™…æ•°æ®ã€‚

**æ•°æ®ä¸ä¸€è‡´æƒ…å†µ**:
- å‡ºå…¥åº“è®°å½•: å¤‡ä»¶1æœ‰17.00åº“å­˜ï¼Œå¤‡ä»¶2æœ‰14.00åº“å­˜
- åº“å­˜è®°å½•è¡¨: æ‰€æœ‰å¤‡ä»¶çš„æ•°é‡éƒ½æ˜¯0.00
- åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶æ²¡æœ‰æ­£å¸¸å·¥ä½œ

### 3. é‡å¤æ•°æ®é—®é¢˜
**é—®é¢˜**: æ•°æ®åº“ä¸­å­˜åœ¨é‡å¤çš„ `spare_part_id` è®°å½•
- å¤‡ä»¶ID 5 æœ‰2æ¡åº“å­˜è®°å½•
- å¯¼è‡´ `selectOne` æŸ¥è¯¢å¤±è´¥

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤ StackOverflowError
**æ–‡ä»¶**: `yudao-module-coal/src/main/java/cn/iocoder/yudao/module/coal/dal/mysql/sparepartstock/SparePartStockMapper.java`

**ä¿®å¤å†…å®¹**: æ¢å¤ `selectBySparePartId` æ–¹æ³•ä¸ºåŸå§‹çš„ `selectOne` å®ç°

```java
default SparePartStockDO selectBySparePartId(Long sparePartId) {
    return selectOne(new LambdaQueryWrapperX<SparePartStockDO>()
            .eq(SparePartStockDO::getSparePartId, sparePartId));
}
```

### 2. æ¸…ç†é‡å¤æ•°æ®
**æ“ä½œ**: åˆ é™¤é‡å¤çš„åº“å­˜è®°å½•ï¼Œä¿ç•™IDæœ€å¤§çš„è®°å½•

```sql
DELETE FROM coal_spare_part_stock 
WHERE id NOT IN (
    SELECT * FROM (
        SELECT MAX(id) 
        FROM coal_spare_part_stock 
        GROUP BY spare_part_id
    ) AS temp
);
```

### 3. æ‰‹åŠ¨æ›´æ–°åº“å­˜æ•°æ®
**æ“ä½œ**: åŸºäºå‡ºå…¥åº“è®°å½•è®¡ç®—å¹¶æ›´æ–°æ­£ç¡®çš„åº“å­˜æ•°é‡

#### 3.1 æ·»åŠ ç¼ºå¤±çš„åº“å­˜è®°å½•
```sql
INSERT INTO coal_spare_part_stock 
(spare_part_id, warehouse_location, stock_type, quantity, unit_cost, total_cost, create_time, update_time, creator, updater, tenant_id) 
VALUES 
(1, 'A01-001', 1, 17.00, 0.00, 0.00, NOW(), NOW(), 1, 1, 1), 
(2, 'A01-002', 1, 14.00, 0.00, 0.00, NOW(), NOW(), 1, 1, 1);
```

#### 3.2 æ›´æ–°ç°æœ‰åº“å­˜è®°å½•
```sql
UPDATE coal_spare_part_stock SET quantity = 9.00 WHERE spare_part_id = 3;
UPDATE coal_spare_part_stock SET quantity = 2.00 WHERE spare_part_id = 5;
UPDATE coal_spare_part_stock SET quantity = 8.00 WHERE spare_part_id = 8;
UPDATE coal_spare_part_stock SET quantity = 450.00 WHERE spare_part_id = 10;
```

## ğŸ“‹ ä¿®å¤ç»“æœ

### 1. é”™è¯¯ä¿®å¤
- âœ… æ¶ˆé™¤ StackOverflowError é”™è¯¯
- âœ… æ¸…ç†é‡å¤æ•°æ®
- âœ… APIè°ƒç”¨æ­£å¸¸

### 2. æ•°æ®ä¿®å¤
**ä¿®å¤å‰**:
```
+---------------+----------+
| spare_part_id | quantity |
+---------------+----------+
|             3 |     0.00 |
|             4 |     0.00 |
|             5 |     0.00 |
|             6 |     0.00 |
|             8 |     0.00 |
|             9 |     0.00 |
|            10 |     0.00 |
|            11 |     0.00 |
|            20 |     0.00 |
+---------------+----------+
```

**ä¿®å¤å**:
```
+---------------+----------+
| spare_part_id | quantity |
+---------------+----------+
|             1 |    17.00 |
|             2 |    14.00 |
|             3 |     9.00 |
|             4 |     0.00 |
|             5 |     2.00 |
|             6 |     0.00 |
|             8 |     8.00 |
|             9 |     0.00 |
|            10 |   450.00 |
|            11 |     0.00 |
|            20 |     0.00 |
+---------------+----------+
```

### 3. ç»Ÿè®¡ç»“æœ
- **æ€»å¤‡ä»¶ç§ç±»**: 20ç§
- **æ€»åº“å­˜æ•°é‡**: 500.00 (17+14+9+2+8+450)
- **é›¶åº“å­˜æ•°é‡**: 5ç§ (å¤‡ä»¶4,6,9,11,20)
- **ä½åº“å­˜æ•°é‡**: éœ€è¦æ ¹æ®æœ€å°åº“å­˜é˜ˆå€¼è®¡ç®—

## ğŸ¯ é¢„æœŸæ•ˆæœ

ç°åœ¨é¦–é¡µå¤‡ä»¶ç»Ÿè®¡å¡ç‰‡åº”è¯¥æ˜¾ç¤ºï¼š
- âœ… å¤‡ä»¶ç§ç±»: 20
- âœ… æ€»åº“å­˜: 500
- âœ… é›¶åº“å­˜: 5
- âœ… ä½åº“å­˜: æ ¹æ®å®é™…æ•°æ®è®¡ç®—
- âœ… åº“å­˜å¥åº·åº¦: æ ¹æ®å®é™…æ•°æ®è®¡ç®—

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### 1. åº“å­˜è‡ªåŠ¨æ›´æ–°æœºåˆ¶
- æ£€æŸ¥å‡ºå…¥åº“è®°å½•åˆ›å»ºæ—¶æ˜¯å¦æ­£ç¡®è§¦å‘åº“å­˜æ›´æ–°
- ç¡®ä¿åº“å­˜è®°å½•ä¸å‡ºå…¥åº“è®°å½•ä¿æŒåŒæ­¥
- æ·»åŠ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶

### 2. æ•°æ®å®Œæ•´æ€§
- å»ºç«‹æ•°æ®åº“çº¦æŸé˜²æ­¢é‡å¤æ•°æ®
- æ·»åŠ æ•°æ®éªŒè¯é€»è¾‘
- å®šæœŸæ£€æŸ¥æ•°æ®ä¸€è‡´æ€§

### 3. é”™è¯¯å¤„ç†
- æ”¹è¿›å¼‚å¸¸å¤„ç†æœºåˆ¶
- æ·»åŠ æ•°æ®ä¿®å¤å·¥å…·
- å»ºç«‹ç›‘æ§å‘Šè­¦æœºåˆ¶

---

**ä¿®å¤æ—¶é—´**: 2025-01-09  
**ä¿®å¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ  
**æµ‹è¯•çŠ¶æ€**: å¾…æµ‹è¯•  
**éƒ¨ç½²çŠ¶æ€**: å¾…éƒ¨ç½²
