# 备件预警首页卡片功能说明

## 功能概述

在首页新增了"备件预警待处理"卡片组件，用于显示待处理的备件预警信息，并提供一键发送站内信通知的功能。

## 组件特性

### 🎯 核心功能
- **实时显示**：显示所有未发送的备件预警记录
- **一键发送**：点击"发送通知"按钮直接发送站内信
- **自动刷新**：每30秒自动刷新预警列表
- **状态管理**：显示发送状态，防止重复发送

### 📊 显示信息
- **预警级别**：高/中/低（不同颜色标签）
- **预警标题**：预警的具体标题
- **备件名称**：相关备件信息
- **预警信息**：详细的预警描述
- **库存信息**：当前库存和阈值对比
- **创建时间**：预警创建时间

### 🎨 界面设计
- **卡片式布局**：美观的卡片设计，与首页风格一致
- **响应式设计**：支持移动端和桌面端
- **状态指示**：加载状态、空数据状态、错误状态
- **交互反馈**：按钮加载状态、成功/失败提示

## 组件结构

### 文件位置
```
yudao-ui/yudao-ui-admin-vue3/src/components/SparePartAlertCard.vue
```

### 主要功能模块

#### 1. 数据获取
```typescript
// 获取待处理预警列表
const getPendingAlerts = async () => {
  const response = await SparePartAlertApi.getSparePartAlertPage({
    pageNo: 1,
    pageSize: 10,
    isSent: false // 只获取未发送的预警
  })
}
```

#### 2. 发送通知
```typescript
// 发送预警通知
const handleSendAlert = async (alert: any) => {
  // 1. 检查接收人
  // 2. 确认发送
  // 3. 调用API发送
  // 4. 更新状态
  // 5. 刷新列表
}
```

#### 3. 自动刷新
```typescript
// 启动自动刷新
const startAutoRefresh = () => {
  refreshTimer.value = setInterval(() => {
    getPendingAlerts()
  }, props.refreshInterval) // 默认30秒
}
```

## 首页集成

### 集成位置
在首页的统计卡片区域，位于：
- 备件库存统计卡片
- 备件使用频率分析卡片
- **备件预警待处理卡片** ← 新增

### 集成代码
```vue
<!-- 备件预警待处理卡片 -->
<SparePartAlertCard :auto-refresh="true" />
```

## 使用说明

### 1. 查看预警
- 进入首页，在统计卡片区域可以看到"备件预警待处理"卡片
- 卡片显示所有未发送的预警记录（最多显示5条）
- 每条预警显示关键信息：级别、标题、备件名称、库存信息等

### 2. 发送通知
- 点击预警记录右侧的"发送通知"按钮
- 系统会检查预警是否有设置接收人
- 确认发送后，系统会调用站内信API发送通知
- 发送成功后，预警状态会更新为"已发送"

### 3. 查看更多
- 如果预警数量超过5条，会显示"查看全部 X 条预警"按钮
- 点击可跳转到完整的预警管理页面

## 技术实现

### API调用
- **获取预警列表**：`SparePartAlertApi.getSparePartAlertPage()`
- **发送通知**：`SparePartAlertApi.sendNotification()`

### 状态管理
- **loading**：加载状态
- **pendingAlerts**：待处理预警列表
- **sendingIds**：正在发送的预警ID列表（防止重复发送）

### 错误处理
- API调用失败时显示错误提示
- 网络异常时保持界面稳定
- 发送失败时提供重试机制

## 配置选项

### Props参数
```typescript
interface Props {
  autoRefresh?: boolean        // 是否自动刷新，默认true
  refreshInterval?: number     // 刷新间隔（毫秒），默认30000
}
```

### 使用示例
```vue
<!-- 默认配置（30秒自动刷新） -->
<SparePartAlertCard :auto-refresh="true" />

<!-- 自定义刷新间隔（60秒） -->
<SparePartAlertCard :auto-refresh="true" :refresh-interval="60000" />

<!-- 禁用自动刷新 -->
<SparePartAlertCard :auto-refresh="false" />
```

## 样式特性

### 响应式设计
- **桌面端**：横向布局，信息展示完整
- **移动端**：纵向布局，适配小屏幕

### 视觉设计
- **预警级别标签**：高（红色）、中（橙色）、低（蓝色）
- **状态指示**：加载动画、空数据图标
- **交互反馈**：按钮悬停效果、点击状态

## 注意事项

### 1. 权限要求
- 需要备件预警查询权限：`coal:spare-part-alert:query`
- 需要发送通知权限：`coal:spare-part-alert:send`

### 2. 数据依赖
- 依赖备件预警记录数据
- 依赖站内信模板配置
- 依赖用户权限设置

### 3. 性能考虑
- 自动刷新间隔可配置，避免频繁请求
- 最多显示5条预警，避免界面过长
- 使用防抖机制，避免重复操作

## 扩展功能

### 未来可扩展的功能
1. **批量发送**：支持选择多个预警批量发送
2. **筛选功能**：按预警级别、备件类型筛选
3. **实时推送**：使用WebSocket实现实时更新
4. **统计信息**：显示预警统计数据和趋势
5. **快捷操作**：支持快速标记已读、删除等操作

## 文件清单

### 新增文件
- `yudao-ui/yudao-ui-admin-vue3/src/components/SparePartAlertCard.vue`
- `learn/备件预警首页卡片功能说明.md`

### 修改文件
- `yudao-ui/yudao-ui-admin-vue3/src/views/Home/Index.vue`

## 总结

备件预警首页卡片组件成功集成到首页，提供了：

✅ **实时监控**：首页即可查看待处理预警  
✅ **便捷操作**：一键发送站内信通知  
✅ **美观界面**：与首页风格完美融合  
✅ **响应式设计**：支持各种设备访问  
✅ **自动刷新**：保持数据实时性  

这个组件大大提升了备件预警管理的效率和用户体验！
