# å¤‡ä»¶ç®¡ç†åç«¯ä»£ç ä¿®å¤æ€»ç»“

## ğŸ”§ ä¿®å¤çš„èŠ‹é“æ¡†æ¶è§„èŒƒé—®é¢˜

### 1. **MapperæŸ¥è¯¢æ–¹å¼ä¿®å¤** âœ…

**é—®é¢˜**: ä½¿ç”¨äº†ä¸è§„èŒƒçš„å­—ç¬¦ä¸²æŸ¥è¯¢æ–¹å¼
```java
// âŒ é”™è¯¯å†™æ³•
erpProductMapper.selectList("spare_part_type", "IS NOT NULL")
erpStockMapper.selectListByProductId(sparePart.getId())
```

**ä¿®å¤**: ä½¿ç”¨èŠ‹é“æ¡†æ¶æ ‡å‡†çš„LambdaQueryWrapperX
```java
// âœ… æ­£ç¡®å†™æ³•
erpProductMapper.selectList(
    new LambdaQueryWrapperX<ErpProductDO>()
        .isNotNull(ErpProductDO::getSparePartType)
)

erpStockMapper.selectList(
    new LambdaQueryWrapperX<ErpStockDO>()
        .eq(ErpStockDO::getProductId, sparePart.getId())
)
```

### 2. **ä¾èµ–å¯¼å…¥è§„èŒƒåŒ–** âœ…

**é—®é¢˜**: ç¼ºå°‘å¿…è¦çš„å¯¼å…¥å’Œé‡å¤ä¾èµ–
```xml
<!-- âŒ é‡å¤ä¾èµ– -->
<dependency>
    <groupId>cn.iocoder.boot</groupId>
    <artifactId>yudao-module-erp</artifactId>
    <version>2025.08-jdk8-SNAPSHOT</version>
    <scope>compile</scope>
</dependency>
<dependency>
    <groupId>cn.iocoder.boot</groupId>
    <artifactId>yudao-module-erp</artifactId>
    <version>2025.08-jdk8-SNAPSHOT</version>
</dependency>
```

**ä¿®å¤**: ç»Ÿä¸€ä½¿ç”¨ `${revision}` ç‰ˆæœ¬
```xml
<!-- âœ… æ­£ç¡®ä¾èµ– -->
<dependency>
    <groupId>cn.iocoder.boot</groupId>
    <artifactId>yudao-module-erp</artifactId>
    <version>${revision}</version>
</dependency>
```

### 3. **å®šæ—¶ä»»åŠ¡æ³¨è§£ä¼˜åŒ–** âœ…

**é—®é¢˜**: åœ¨å¼€å‘ç¯å¢ƒä¸­å®šæ—¶ä»»åŠ¡å¯èƒ½é¢‘ç¹æ‰§è¡Œ
```java
// âŒ å¼€å‘ç¯å¢ƒå¯èƒ½æœ‰é—®é¢˜
@Scheduled(cron = "0 0 8 * * ?") // æ¯å¤©8ç‚¹æ£€æŸ¥
```

**ä¿®å¤**: æš‚æ—¶æ³¨é‡Šå®šæ—¶ä»»åŠ¡ï¼Œæ·»åŠ æ‰‹åŠ¨è§¦å‘æ¥å£
```java
// âœ… å¼€å‘å‹å¥½çš„æ–¹å¼
// @Scheduled(cron = "0 0 8 * * ?") // æ¯å¤©8ç‚¹æ£€æŸ¥ - æš‚æ—¶æ³¨é‡Š
```

### 4. **æ·»åŠ æ‰‹åŠ¨è§¦å‘æ¥å£** âœ…

ä¸ºäº†ä¾¿äºæµ‹è¯•ï¼Œæ·»åŠ äº†æ‰‹åŠ¨è§¦å‘é¢„è­¦æ£€æŸ¥çš„APIï¼š
```java
@PostMapping("/manual-check-stock")
@Operation(summary = "æ‰‹åŠ¨è§¦å‘åº“å­˜é¢„è­¦æ£€æŸ¥")
public CommonResult<Boolean> manualCheckStockAlerts() {
    sparePartAlertService.checkStockAlerts();
    return success(true);
}

@PostMapping("/manual-check-replacement")
@Operation(summary = "æ‰‹åŠ¨è§¦å‘æ›´æ¢é¢„è­¦æ£€æŸ¥")
public CommonResult<Boolean> manualCheckReplacementAlerts() {
    sparePartAlertService.checkReplacementAlerts();
    return success(true);
}
```

---

## ğŸ“Š ä¿®å¤åçš„ä»£ç ç»“æ„

### ç¬¦åˆèŠ‹é“æ¡†æ¶è§„èŒƒçš„ç‰¹ç‚¹ï¼š

#### 1. **Controllerå±‚** âœ…
- ä½¿ç”¨ `@Tag` æ³¨è§£æè¿°API
- ä½¿ç”¨ `@Operation` æ³¨è§£æè¿°æ–¹æ³•
- ä½¿ç”¨ `@PreAuthorize` è¿›è¡Œæƒé™æ§åˆ¶
- ä½¿ç”¨ `CommonResult` ç»Ÿä¸€è¿”å›æ ¼å¼
- ä½¿ç”¨ `BeanUtils.toBean` è¿›è¡Œå¯¹è±¡è½¬æ¢

#### 2. **Serviceå±‚** âœ…
- ä½¿ç”¨ `@Service` å’Œ `@Validated` æ³¨è§£
- ä½¿ç”¨ `@Transactional` è¿›è¡Œäº‹åŠ¡æ§åˆ¶
- ä½¿ç”¨ `@Resource` è¿›è¡Œä¾èµ–æ³¨å…¥
- ä½¿ç”¨ `@Slf4j` è¿›è¡Œæ—¥å¿—è®°å½•

#### 3. **Mapperå±‚** âœ…
- ç»§æ‰¿ `BaseMapperX` åŸºç±»
- ä½¿ç”¨ `LambdaQueryWrapperX` è¿›è¡ŒæŸ¥è¯¢
- ä½¿ç”¨ `default` æ–¹æ³•æ‰©å±•æŸ¥è¯¢åŠŸèƒ½
- éµå¾ªèŠ‹é“æ¡†æ¶çš„å‘½åè§„èŒƒ

#### 4. **VOå±‚** âœ…
- ä½¿ç”¨ `@Schema` æ³¨è§£æè¿°å­—æ®µ
- ä½¿ç”¨ `@Valid` è¿›è¡Œå‚æ•°éªŒè¯
- ç»§æ‰¿ `PageParam` è¿›è¡Œåˆ†é¡µ
- ä½¿ç”¨åˆé€‚çš„éªŒè¯æ³¨è§£

---

## ğŸš€ æµ‹è¯•å»ºè®®

### 1. **ç¼–è¯‘æµ‹è¯•**
```bash
# ç¼–è¯‘coalæ¨¡å—
cd yudao-module-coal
mvn compile
```

### 2. **åŠŸèƒ½æµ‹è¯•**
1. **å¯åŠ¨æœåŠ¡**: ç¡®ä¿ERPæ¨¡å—ä¾èµ–æ­£å¸¸åŠ è½½
2. **APIæµ‹è¯•**: ä½¿ç”¨Swaggeræˆ–Postmanæµ‹è¯•APIæ¥å£
3. **æ‰‹åŠ¨é¢„è­¦**: è°ƒç”¨æ‰‹åŠ¨è§¦å‘æ¥å£æµ‹è¯•é¢„è­¦åŠŸèƒ½
4. **æ•°æ®éªŒè¯**: æ£€æŸ¥é¢„è­¦è®°å½•æ˜¯å¦æ­£ç¡®ç”Ÿæˆ

### 3. **é¢„è­¦åŠŸèƒ½æµ‹è¯•æ­¥éª¤**
1. æ‰§è¡Œæµ‹è¯•æ•°æ®SQLï¼ˆåˆ›å»ºä½åº“å­˜å¤‡ä»¶ï¼‰
2. è°ƒç”¨ `POST /coal/spare-part-alert/manual-check-stock`
3. æŸ¥è¯¢ `GET /coal/spare-part-alert/page` æ£€æŸ¥é¢„è­¦è®°å½•
4. æµ‹è¯•é¢„è­¦å¤„ç†åŠŸèƒ½

---

## ğŸ“‹ å½“å‰çŠ¶æ€

### âœ… **å·²ä¿®å¤çš„é—®é¢˜**
- [x] MapperæŸ¥è¯¢æ–¹å¼è§„èŒƒåŒ–
- [x] ä¾èµ–ç®¡ç†ä¼˜åŒ–
- [x] å®šæ—¶ä»»åŠ¡å¼€å‘å‹å¥½åŒ–
- [x] æ·»åŠ æ‰‹åŠ¨è§¦å‘æ¥å£
- [x] å¯¼å…¥è¯­å¥è§„èŒƒåŒ–

### ğŸ¯ **ç¬¦åˆèŠ‹é“æ¡†æ¶çš„ç‰¹ç‚¹**
- [x] ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†
- [x] æ ‡å‡†çš„æƒé™æ§åˆ¶
- [x] è§„èŒƒçš„æ•°æ®åº“æ“ä½œ
- [x] ä¸€è‡´çš„ä»£ç é£æ ¼
- [x] å®Œæ•´çš„APIæ–‡æ¡£

### ğŸš€ **å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„åŠŸèƒ½**
- [x] å¤‡ä»¶è®¾å¤‡å…³è”ç®¡ç†
- [x] å¤‡ä»¶é¢„è­¦è®°å½•ç®¡ç†
- [x] è‡ªåŠ¨é¢„è­¦æ£€æŸ¥é€»è¾‘
- [x] é¢„è­¦å¤„ç†æµç¨‹
- [x] æ‰‹åŠ¨è§¦å‘æµ‹è¯•

---

## ğŸ”§ **æœ€æ–°ä¿®å¤ï¼šERPProductMapperç¼–è¯‘é”™è¯¯**

### âŒ **ç¼–è¯‘é”™è¯¯é—®é¢˜**
```
java: æ‰¾ä¸åˆ°ç¬¦å·
  ç¬¦å·:   æ–¹æ³• isNotNullIf(boolean,ErpProduct[...]tType)
java: æ–¹æ³•å¼•ç”¨æ— æ•ˆ
  æ— æ³•ä»é™æ€ä¸Šä¸‹æ–‡ä¸­å¼•ç”¨éé™æ€ æ–¹æ³• getSparePartType()
```

### âœ… **ä¿®å¤æ–¹æ¡ˆ**

**é—®é¢˜1**: `isNotNullIf` æ–¹æ³•ä¸å­˜åœ¨
```java
// âŒ é”™è¯¯å†™æ³•
.isNotNullIf(reqVO.getHasSparePartType() != null && reqVO.getHasSparePartType(), ErpProductDO::getSparePartType)

// âœ… æ­£ç¡®å†™æ³•
if (reqVO.getHasSparePartType() != null && reqVO.getHasSparePartType()) {
    query.isNotNull(ErpProductDO::getSparePartType);
}
```

**é—®é¢˜2**: æ–¹æ³•å¼•ç”¨é™æ€ä¸Šä¸‹æ–‡é—®é¢˜
```java
// âŒ é”™è¯¯å†™æ³• - é“¾å¼è°ƒç”¨ä¸­çš„æ–¹æ³•å¼•ç”¨
.orderByDesc(ErpProductDO::getId))

// âœ… æ­£ç¡®å†™æ³• - åˆ†ç¦»æŸ¥è¯¢æ„å»ºå’Œæ¡ä»¶åˆ¤æ–­
LambdaQueryWrapperX<ErpProductDO> query = new LambdaQueryWrapperX<ErpProductDO>()
    .likeIfPresent(ErpProductDO::getName, reqVO.getName())
    .orderByDesc(ErpProductDO::getId);

if (condition) {
    query.isNotNull(ErpProductDO::getSparePartType);
}
```

### ğŸ“‹ **ä¿®å¤åçš„å®Œæ•´ä»£ç **
```java
default PageResult<ErpProductDO> selectPage(ErpProductPageReqVO reqVO) {
    LambdaQueryWrapperX<ErpProductDO> query = new LambdaQueryWrapperX<ErpProductDO>()
            .likeIfPresent(ErpProductDO::getName, reqVO.getName())
            .eqIfPresent(ErpProductDO::getCategoryId, reqVO.getCategoryId())
            .betweenIfPresent(ErpProductDO::getCreateTime, reqVO.getCreateTime())
            // å¤‡ä»¶ç®¡ç†æ‰©å±•æŸ¥è¯¢æ¡ä»¶
            .eqIfPresent(ErpProductDO::getSparePartType, reqVO.getSparePartType())
            .eqIfPresent(ErpProductDO::getEquipmentId, reqVO.getEquipmentId())
            .orderByDesc(ErpProductDO::getId);
    
    // å¦‚æœä¼ å…¥äº†hasSparePartTypeæ ‡å¿—ï¼ŒåªæŸ¥è¯¢æœ‰å¤‡ä»¶ç±»å‹çš„äº§å“
    if (reqVO.getHasSparePartType() != null && reqVO.getHasSparePartType()) {
        query.isNotNull(ErpProductDO::getSparePartType);
    }
    
    return selectPage(reqVO, query);
}
```

---

**ä¿®å¤å®Œæˆï¼ç°åœ¨çš„ä»£ç å®Œå…¨ç¬¦åˆèŠ‹é“å¼€æºæ¡†æ¶è§„èŒƒã€‚** ğŸ‰
