# 备件使用记录路由跳转问题修复总结

## 问题描述

从检修单页面点击"备件使用记录"按钮跳转时，URL参数正确传递了（如：`workOrderId=13&equipmentId=3`），但页面没有正确跳转或过滤显示对应的记录。

## 问题原因

**路由路径不匹配**: 跳转时使用的路径与菜单配置中的路径不一致。

### 1. 菜单配置中的路径
```sql
SELECT id, name, path, component FROM system_menu WHERE name LIKE '%备件使用记录%';
```
结果：
- ID: 5155
- 名称: 备件使用记录管理  
- 路径: `spare-part-usage-record`
- 组件: `coal/sparepartusagerecord/index`

### 2. 跳转时使用的路径
```typescript
// 错误的路径
path: '/coal/sparepartusagerecord'
```

### 3. 正确的路径
```typescript
// 正确的路径（与菜单配置一致）
path: '/coal/spare-part-usage-record'
```

## 修复内容

### 修正检修单页面的跳转路径

**修复前**:
```typescript
router.push({
  path: '/coal/sparepartusagerecord',  // 错误路径
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})
```

**修复后**:
```typescript
router.push({
  path: '/coal/spare-part-usage-record',  // 正确路径
  query: {
    workOrderId: maintenanceOrder.id,
    equipmentId: maintenanceOrder.equipmentId
  }
})
```

## 芋道框架路由约定

根据芋道框架的路由文档：

### 1. 路由配置规则
- 路由路径必须与菜单管理中的 `path` 字段一致
- 组件路径与菜单管理中的 `component` 字段一致
- 动态路由通过菜单管理进行配置

### 2. 路由跳转方式
```typescript
// 简单跳转
this.$router.push({ path: "/system/user" });

// 跳转页面并设置请求参数，使用 `query` 属性
this.$router.push({ path: "/system/user", query: {id: "1", name: "芋道"} });
```

### 3. 菜单管理配置
- 目录：作为菜单的分类
- 菜单：具体的功能页面
- 按钮：页面内的操作权限

## 完整的数据流程

### 1. 菜单配置
```
系统管理 -> 菜单管理
├── 备件使用记录管理 (spare-part-usage-record)
│   ├── 备件使用记录查询
│   ├── 备件使用记录创建  
│   ├── 备件使用记录更新
│   ├── 备件使用记录删除
│   └── 备件使用记录导出
```

### 2. 路由跳转流程
1. 检修单页面点击"备件使用记录"按钮
2. 调用 `handleManageSpareParts` 函数
3. 使用 `router.push` 跳转到 `/coal/spare-part-usage-record`
4. 传递 `workOrderId` 和 `equipmentId` 查询参数

### 3. 页面接收参数
1. 备件使用记录页面在 `onMounted` 中接收URL参数
2. 将参数设置到 `queryParams.workOrderId` 和 `queryParams.equipmentId`
3. 调用 `getList()` 函数进行查询

### 4. 后端查询过滤
1. 前端调用 `SparePartUsageRecordApi.getSparePartUsageRecordPage(queryParams)`
2. 后端根据 `workOrderId` 和 `equipmentId` 进行过滤查询
3. 返回过滤后的备件使用记录列表

## 预期结果

修复后，当从检修单ID=13跳转到备件使用记录页面时：

1. **URL**: `http://localhost/coal/spare-part-usage-record?workOrderId=13&equipmentId=3`
2. **页面跳转**: 正确跳转到备件使用记录页面
3. **参数传递**: 正确传递 `workOrderId=13` 和 `equipmentId=3`
4. **数据过滤**: 显示与检修单ID=13和设备ID=3相关的备件使用记录
5. **设备名称显示**: 关联设备列显示"跳汰机"而不是"设备ID: 3"

## 测试步骤

1. 刷新检修单页面
2. 点击任意检修单的"备件使用记录"按钮
3. 验证是否正确跳转到备件使用记录页面
4. 验证URL是否包含正确的查询参数
5. 验证页面是否根据参数过滤显示相关记录
6. 验证设备名称是否正确显示

## 教训

1. **路由路径一致性**: 跳转路径必须与菜单配置中的路径完全一致
2. **菜单管理重要性**: 动态路由的配置都在菜单管理中，需要先检查菜单配置
3. **芋道框架约定**: 必须遵循框架的路由约定和命名规范
4. **完整测试**: 功能开发完成后需要进行端到端的完整测试

## 相关文件

- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/maintenanceorder/index.vue` - 检修单页面跳转逻辑
- `yudao-ui/yudao-ui-admin-vue3/src/views/coal/sparepartusagerecord/index.vue` - 备件使用记录页面
- `yudao-module-coal/src/main/java/cn/iocoder/yudao/module/coal/dal/mysql/sparepartusagerecord/SparePartUsageRecordMapper.java` - 后端查询逻辑
